import{_ as k,q as O,ag as p,x as y,A as j,h as c,B as w,k as l,I as V,J as P,L as T,j as f,w as m,V as x,n as u,P as v,D as d,p as C,ah as D}from"./index-Hyq34tSM.js";import{g as F}from"./graphql-D8b4q-7X.js";import{i as _,a as b}from"./initialOptions-BLDeg43d.js";import{V as A}from"./vue3-apexcharts.common-T8JN_pRh.js";import{V as S}from"./VPagination-D6i7DgtD.js";import{d as G}from"./debounce-BEi8cUqw.js";const h=new Map([["total",{start:"submittedTime",end:"finishedTime"}],["run",{start:"startedTime",end:"finishedTime"}],["queue",{start:"submittedTime",end:"startedTime"}]]),g=["#008FFB","#00E396","#775DD0","#FEB019","#FF4560"],q={name:"GanttChart",watch:{tasksPerPage:function(){this.page=1}},components:{VueApexCharts:A},props:{jobs:{type:Object,required:!0},timingOption:{type:String,default:"total"},tasksPerPage:{type:Number,default:10},animate:{type:Boolean,default:!0}},setup(){return{reducedAnimation:O()}},data(){return{page:1,sortBy:"name",sortDesc:!1}},methods:{compare(o,e){const s=o[this.sortBy]<e[this.sortBy]?-1:1;return this.sortDesc?-s:s}},computed:{displayedJobs(){const o=Object.keys(this.jobs),e=Math.max(0,this.tasksPerPage*(this.page-1)),s=Math.min(o.length,e+this.tasksPerPage);return Object.values(this.jobs).slice(e,s).flatMap(t=>t)},series(){let o=[];if(this.jobs.length!==0){const{start:e,end:s}=h.get(this.timingOption),t=new Map;let a=0;o=this.displayedJobs.map(n=>{const{cycle:r}=new p(n.id);let i=t.get(r);return i||(i=g[a++%g.length],t.set(r,i)),{x:n.name,y:[new Date(n[e]).getTime(),new Date(n[s]).getTime()],fillColor:i}})}return[{data:o}]},numPages(){return this.jobs.length!==0?Math.ceil(Object.keys(this.jobs).length/this.tasksPerPage):1},chartOptions(){const{displayedJobs:o}=this,{start:e,end:s}=h.get(this.timingOption);return{chart:{defaultLocale:"en",locales:[{name:"en",options:{toolbar:{exportToSVG:"Download SVG",exportToPNG:"Download PNG",menu:"Download",selection:"Selection",selectionZoom:"Selection Zoom",zoomIn:"Zoom In",zoomOut:"Zoom Out",pan:"Panning",reset:"Reset Zoom"}}}],animations:{enabled:this.animate&&!this.reducedAnimation,easing:"easeinout",speed:300,animateGradually:{enabled:!0,delay:150},dynamicAnimation:{enabled:!0,speed:350}},fontFamily:"inherit",toolbar:{tools:{download:`<svg class="w-100 h-100"><path d="${y}"></path></svg>`,selection:!0,zoom:!0,zoomin:!0,zoomout:!0,pan:!0,reset:!0}}},tooltip:{custom({dataPointIndex:t}){const a=o[t],{relativeID:n}=new p(a.id);return'<div class="apexcharts-tooltip-candlestick"><div>Job: <span class="value">'+n+'</span></div><div>Start: <span class="value">'+a[e]+'</span></div><div>Finish: <span class="value">'+a[s]+"</span></div></div>"}},plotOptions:{bar:{horizontal:!0}},xaxis:{labels:{formatter:function(t,a,n){return new Date(t).toUTCString().slice(17,-3)}},title:{text:"Time (UTC)"}},yaxis:{labels:{maxWidth:280,offsetX:-10}}}}}};function B(o,e,s,t,a,n){const r=j("VueApexCharts");return c(),w(V,null,[l(r,{type:"rangeBar",options:n.chartOptions,series:n.series,width:"100%",height:"auto",class:"d-flex justify-center"},null,8,["options","series"]),l(S,{modelValue:a.page,"onUpdate:modelValue":e[0]||(e[0]=i=>a.page=i),length:n.numPages,"total-visible":7,density:"comfortable"},null,8,["modelValue","length"])],64)}const I=k(q,[["render",B]]);function U(o,e){const{name:s,platformOption:t}=e;return Object.fromEntries(Object.entries(o).filter(([a,n])=>(!s.length||s.includes(a))&&(t===-1||n.some(({platform:r})=>r===t))))}function M(o){const e=[{value:-1,title:"All"}],s=[];for(const t of Object.values(o))for(let a=0;a<t.length;a++)s.includes(t[a].platform)||(s.push(t[a].platform),e.push({value:t[a].platform,title:t[a].platform}));return e}const J=["name","id","submittedTime","startedTime","finishedTime","platform"],z=P`
query ganttQuery ($workflows: [ID]) {
  jobs(live: false, workflows: $workflows) {
    ${J.join(`
`)}
  }
}
`;class E extends T{constructor(){super(),this.jobs={}}add(e){this.uniqueTasks=Array.from(new Set(e.jobs.map(t=>t.name)));const s=Object.fromEntries(this.uniqueTasks.map(t=>[t,[]]));for(let t=0;t<e.jobs.length;t++)s[e.jobs[t].name].push(e.jobs[t]);Object.assign(this.jobs,s)}onAdded(e,s,t){this.add(e)}onUpdated(e,s,t){this.add(e)}}const N={name:"Gantt",mixins:[F],components:{GanttChart:I},props:{initialOptions:_},setup(o,{emit:e}){const s=b("tasksPerPage",{props:o,emit:e},10),t=b("jobsFilter",{props:o,emit:e},{name:[],timingOption:"totalTimes",platformOption:-1});return{tasksPerPage:s,jobsFilter:t}},beforeMount(){this.jobsQuery()},data(){return{callback:new E,timingOptions:[{value:"totalTimes",title:"Total times"},{value:"runTimes",title:"Run times"},{value:"queueTimes",title:"Queue times"}]}},computed:{workflowIDs(){return[this.workflowId]},filteredJobs(){return U(this.callback.jobs,this.jobsFilter)},platformOptions(){return M(this.callback.jobs)},timingOption(){return this.jobsFilter.timingOption.replace(/Times/,"")}},methods:{jobsQuery:G(async function(){const o=await this.$workflowService.query2(z,{workflows:this.workflowIDs});this.callback.onAdded(o.data)},200)},taskChoices:[10,25,50,100]},Q={class:"c-gantt"};function R(o,e,s,t,a,n){const r=j("GanttChart");return c(),w("div",Q,[Object.keys(a.callback.jobs).length?(c(),f(x,{key:1,fluid:"",class:"pa-2"},{default:m(()=>[l(C,{"no-gutters":""},{default:m(()=>[l(u,{cols:"12",md:"4",class:"pr-md-2 mb-2"},{default:m(()=>[l(v,{id:"c-gantt-filter-job-name",multiple:"",chips:"","closable-chips":"",clearable:"",placeholder:"Search",items:a.callback.uniqueTasks,modelValue:t.jobsFilter.name,"onUpdate:modelValue":e[0]||(e[0]=i=>t.jobsFilter.name=i),label:"Select tasks",ref:"selectTasks"},null,8,["items","modelValue"])]),_:1}),l(u,{cols:"12",md:"4",class:"mb-2"},{default:m(()=>[l(d,{id:"c-gantt-filter-job-timings",items:a.timingOptions,prefix:"Displaying:",modelValue:t.jobsFilter.timingOption,"onUpdate:modelValue":e[1]||(e[1]=i=>t.jobsFilter.timingOption=i)},null,8,["items","modelValue"])]),_:1}),l(u,{cols:"12",md:"4",class:"pl-md-2 mb-2"},{default:m(()=>[l(d,{id:"c-gantt-filter-job-platforms",items:n.platformOptions,prefix:"Platform:",modelValue:t.jobsFilter.platformOption,"onUpdate:modelValue":e[2]||(e[2]=i=>t.jobsFilter.platformOption=i)},null,8,["items","modelValue"])]),_:1}),l(u,{cols:"12",md:"4",class:"pr-md-2 mb-2"},{default:m(()=>[l(d,{id:"c-gantt-tasks-per-page",items:o.$options.taskChoices,prefix:"Tasks Per Page",modelValue:t.tasksPerPage,"onUpdate:modelValue":e[3]||(e[3]=i=>t.tasksPerPage=i)},null,8,["items","modelValue"])]),_:1})]),_:1}),l(r,{jobs:n.filteredJobs,"timing-option":n.timingOption,"tasks-per-page":t.tasksPerPage},null,8,["jobs","timing-option","tasks-per-page"])]),_:1})):(c(),f(D,{key:0,type:"table",class:"align-content-start"}))])}const K=k(N,[["render",R]]);export{E as GanttCallback,K as default};
