import{_ as D,aB as O,O as R,aV as B,aW as $,aX as A,aY as p,aZ as E,r as u,P as L,o as c,c as v,w as l,a as n,g as J,U as M,h as I,V as S,L as o,Q as y,t as r,aQ as U,a_ as q,I as z,k as g,d as Q,R as W,s as G,j as K,q as X,u as Y,S as Z,a$ as H}from"./index-4d6c7840.js";import{g as j}from"./graphql-c1d511dc.js";function w(e,t){return e=(e??"")===""?1/0:new Date(e).getTime(),t=(t??"")===""?1/0:new Date(t).getTime(),e===t?0:e-t}const ee={name:"TableComponent",props:{tasks:{type:Array,required:!0},filterable:{type:Boolean,default:!0}},components:{Task:O,Job:R,TaskFilter:B},data(){return{itemsPerPage:50,sortBy:[{key:"task.tokens.cycle",order:JSON.parse(localStorage.cyclePointsOrderDesc??!0)?"desc":"asc"}],tasksFilter:{}}},computed:{filteredTasks(){return this.tasks.filter(({task:e})=>$(e,this.tasksFilter.id,this.tasksFilter.states))}},methods:{dtMean:A},headers:[{title:"Task",key:"task.name",sortable:!0,sort:p},{title:"Jobs",key:"data-table-expand",sortable:!1},{title:"Cycle Point",key:"task.tokens.cycle",sortable:!0,sort:(e,t)=>p(String(e??""),String(t??""))},{title:"Platform",key:"latestJob.node.platform",sortable:!0,sort:(e,t)=>p(e??"",t??"")},{title:"Job Runner",key:"latestJob.node.jobRunnerName",sortable:!0,sort:(e,t)=>p(e??"",t??"")},{title:"Job ID",key:"latestJob.node.jobId",sortable:!0,sort:(e,t)=>p(e??"",t??"")},{title:"Submit",key:"latestJob.node.submittedTime",sortable:!0,sort:(e,t)=>w(e??"",t??"")},{title:"Start",key:"latestJob.node.startedTime",sortable:!0,sort:(e,t)=>w(e??"",t??"")},{title:"Finish",key:"latestJob.node.finishedTime",sortable:!0,sort:(e,t)=>w(e??"",t??"")},{title:"Run Time",key:"task.node.task.meanElapsedTime",sortable:!0,sort:(e,t)=>parseInt(e??0)-parseInt(t??0)}],icons:{mdiChevronDown:E},itemsPerPageOptions:[{value:10,title:"10"},{value:20,title:"20"},{value:50,title:"50"},{value:100,title:"100"},{value:200,title:"200"},{value:-1,title:"All"}]},te={class:"d-flex align-content-center flex-nowrap"},se={class:"mr-1"},ae={class:"mr-1"},oe={colspan:3},le={class:"d-flex align-content-center flex-nowrap"},ne={class:"d-flex mr-1"},re={class:"mx-1"},ie=o("td",null,null,-1);function de(e,t,k,m,i,f){const _=u("TaskFilter"),V=u("Task"),T=u("Job"),F=u("v-data-table-footer"),N=u("v-data-table"),b=L("cylc-object");return c(),v(S,{fluid:"",class:"c-table ma-0 pa-2 h-100 flex-column d-flex"},{default:l(()=>[n(I,{"no-gutters":"",class:"d-flex flex-wrap flex-grow-0"},{default:l(()=>[k.filterable?(c(),v(J,{key:0,class:""},{default:l(()=>[n(_,{modelValue:i.tasksFilter,"onUpdate:modelValue":t[0]||(t[0]=s=>i.tasksFilter=s)},null,8,["modelValue"])]),_:1})):M("",!0)]),_:1}),n(I,{"no-gutters":"",class:"flex-grow-1 position-relative"},{default:l(()=>[n(J,{cols:"12",class:"mh-100 position-relative"},{default:l(()=>[n(S,{fluid:"",class:"ma-0 pa-0 w-100 h-100 left-0 top-0 position-absolute pt-2"},{default:l(()=>[n(N,{headers:e.$options.headers,items:f.filteredTasks,"multi-sort":"","sort-by":i.sortBy,"show-expand":"",density:"compact","items-per-page":i.itemsPerPage,"onUpdate:itemsPerPage":t[1]||(t[1]=s=>i.itemsPerPage=s)},{"item.task.name":l(({item:s})=>{var a,d,h,x,P,C;return[o("div",te,[o("div",se,[y(n(V,{task:s.value.task.node,startTime:(d=(a=s.value.latestJob)==null?void 0:a.node)==null?void 0:d.startedTime},null,8,["task","startTime"]),[[b,s.value.task]])]),o("div",ae,[y(n(T,{status:(x=(h=s.value.latestJob)==null?void 0:h.node)==null?void 0:x.state,"previous-state":(C=(P=s.value.previousJob)==null?void 0:P.node)==null?void 0:C.state},null,8,["status","previous-state"]),[[b,s.value.task]])]),o("div",null,r(s.value.task.name),1)])]}),"item.task.node.task.meanElapsedTime":l(({item:s})=>[o("td",null,r(f.dtMean(s.value.task)),1)]),"item.data-table-expand":l(({item:s,toggleExpand:a,isExpanded:d})=>[n(U,{onClick:h=>a(s),icon:"",variant:"text",size:"small",style:q({visibility:(s.value.task.children||[]).length?null:"hidden",transform:d(s)?"rotate(180deg)":null})},{default:l(()=>[n(z,{icon:e.$options.icons.mdiChevronDown,size:"large"},null,8,["icon"])]),_:2},1032,["onClick","style"])]),"expanded-row":l(({item:s})=>[(c(!0),g(W,null,Q(s.value.task.children,(a,d)=>(c(),g("tr",{key:a.id,class:"expanded-row bg-grey-lighten-5"},[o("td",oe,[o("div",le,[o("div",ne,[y((c(),v(T,{key:`${a.id}-summary-${d}`,status:a.node.state,style:{"margin-left":"1.3em"}},null,8,["status"])),[[b,a]]),o("span",re,"#"+r(a.node.submitNum),1)])])]),o("td",null,r(a.node.platform),1),o("td",null,r(a.node.jobRunnerName),1),o("td",null,r(a.node.jobId),1),o("td",null,r(a.node.submittedTime),1),o("td",null,r(a.node.startedTime),1),o("td",null,r(a.node.finishedTime),1),ie]))),128))]),bottom:l(()=>[n(F,{itemsPerPageOptions:e.$options.itemsPerPageOptions},null,8,["itemsPerPageOptions"])]),_:1},8,["headers","items","sort-by","items-per-page"])]),_:1})]),_:1})]),_:1})]),_:1})}const ue=D(ee,[["render",de]]),ce={name:"Table",mixins:[j,G],components:{TableComponent:ue},head(){return{title:K("App.workflow",{name:this.workflowName})}},computed:{...X("workflows",["cylcTree"]),...Y("workflows",["getNodes"]),workflowIDs(){return[this.workflowId]},workflows(){return this.getNodes("workflow",this.workflowIDs)},tasks(){const e=[];for(const t of this.workflows)for(const k of t.children)for(const m of k.children)e.push({task:m,latestJob:m.children[0],previousJob:m.children[1]});return e},query(){return new Z(H,this.variables,"workflow",[],!0,!0)}}},me={class:"h-100"};function pe(e,t,k,m,i,f){const _=u("TableComponent");return c(),g("div",me,[n(_,{tasks:f.tasks,ref:"table0",key:"table0"},null,8,["tasks"])])}const _e=D(ce,[["render",pe]]);export{_e as default};
