import{_ as T,f as m,r as f,o as w,c as _,w as n,a as i,V as y,b as O,d as V,e as P,t as Q,g as u,h,i as x,j as $,m as A,l as g,k as C,n as D,p as c}from"./index-4d6c7840.js";import{g as R}from"./graphql-c1d511dc.js";import{V as q}from"./ViewToolbar-27e5dc1f.js";const F={name:"AnalysisTableComponent",props:{tasks:{type:Array,required:!0},timingOption:{type:String,required:!0}},data(){return{itemsPerPage:50,sortBy:[{key:"name",order:"asc"}],headers:[{title:"Task",key:"name"},{title:"Platform",key:"platform"},{title:"Count",key:"count"}]}},computed:{shownHeaders(){let e;if(this.timingOption==="totalTimes")e="Total";else if(this.timingOption==="runTimes")e="Run";else if(this.timingOption==="queueTimes")e="Queue";else return this.headers;const t=[{title:`Mean T-${e}`,key:`mean${e}Time`,formatter:m,allowZeros:!1},{title:`Std Dev T-${e}`,key:`stdDev${e}Time`,formatter:m,allowZeros:!0},{title:`Min T-${e}`,key:`min${e}Time`,formatter:m,allowZeros:!1},{title:`Q1 T-${e}`,key:`${e.toLowerCase()}Quartiles.0`,formatter:m,allowZeros:!1},{title:`Median T-${e}`,key:`${e.toLowerCase()}Quartiles.1`,formatter:m,allowZeros:!1},{title:`Q3 T-${e}`,key:`${e.toLowerCase()}Quartiles.2`,formatter:m,allowZeros:!1},{title:`Max T-${e}`,key:`max${e}Time`,formatter:m,allowZeros:!1}];return this.headers.concat(t)}},methods:{formatCell(e,t){const s=t.key.match(/^(.+)\.(\d+)$/),l=(s==null?void 0:s[1])??t.key;let a=e.value[l];if(s){const o=s[2];a=a[o]}return t.formatter?t.formatter(a,t.allowZeros):a}},itemsPerPageOptions:[{value:10,title:"10"},{value:20,title:"20"},{value:50,title:"50"},{value:100,title:"100"},{value:200,title:"200"},{value:-1,title:"All"}]};function Z(e,t,s,l,a,o){const p=f("v-data-table-footer"),d=f("v-data-table");return w(),_(h,{"no-gutters":"",class:"c-table flex-grow-1 position-relative"},{default:n(()=>[i(u,{cols:"12",class:"mh-100 position-relative"},{default:n(()=>[i(y,{fluid:"",class:"pa-0"},{default:n(()=>[i(d,{headers:o.shownHeaders,items:s.tasks,"sort-by":a.sortBy,density:"compact","items-per-page":a.itemsPerPage,"onUpdate:itemsPerPage":t[0]||(t[0]=r=>a.itemsPerPage=r)},O({bottom:n(()=>[i(p,{itemsPerPageOptions:e.$options.itemsPerPageOptions},null,8,["itemsPerPageOptions"])]),_:2},[V(o.shownHeaders,r=>({name:`item.${r.key}`,fn:n(({item:v})=>[P(Q(o.formatCell(v,r)),1)])}))]),1032,["headers","items","sort-by","items-per-page"])]),_:1})]),_:1})]),_:1})}const M=T(F,[["render",Z]]);function S(e,t){var l,a,o;let s=!0;return(l=t.name)!=null&&l.trim()&&s&&(s=e.name.includes(t.name)),(o=(a=t.platformOption).trim)!=null&&o.call(a)&&s&&(s=e.platform===t.platformOption),s}function U(e){const t=[{value:-1,title:"All"}],s=[];for(const l of e)s.includes(l.platform)||(s.push(l.platform),t.push({value:l.platform,title:l.platform}));return t}const b=["name","platform","count","meanTotalTime","stdDevTotalTime","minTotalTime","totalQuartiles","maxTotalTime","meanRunTime","stdDevRunTime","minRunTime","runQuartiles","maxRunTime","meanQueueTime","stdDevQueueTime","minQueueTime","queueQuartiles","maxQueueTime"],B=x`
query analysisQuery ($workflows: [ID]) {
  tasks(live: false, workflows: $workflows) {
    ${b.join(`
`)}
  }
}
`;class k{constructor(t){this.tasks=t}add(t){this.tasks.push(...t.tasks.map(s=>g.pick(s,b)))}onAdded(t,s,l){this.add(t)}onUpdated(t,s,l){this.add(t)}before(){}after(){}onPruned(){}commit(){}tearDown(){}}const I={name:"Analysis",mixins:[R],components:{ViewToolbar:q,AnalysisTable:M},head(){return{title:$("App.workflow",{name:this.workflowName})}},beforeMount(){this.historicalQuery(),this.controlGroups=[{title:"Analysis",controls:[{title:"Refresh data",icon:A,action:"callback",callback:this.historicalQuery}]}]},data(){const e=[];return{callback:new k(e),tasks:e,tasksFilter:{name:"",timingOption:"totalTimes",platformOption:-1}}},computed:{workflowIDs(){return[this.workflowId]},filteredTasks(){return this.tasks.filter(e=>S(e,this.tasksFilter))},platformOptions(){return U(this.tasks)}},methods:{historicalQuery:g.debounce(async function(){this.tasks=[],this.callback=new k(this.tasks);const e=await this.$workflowService.query2(B,{workflows:this.workflowIDs});this.callback.onAdded(e.data)},200)},timingOptions:[{value:"totalTimes",title:"Total times"},{value:"runTimes",title:"Run times"},{value:"queueTimes",title:"Queue times"}]},H={class:"c-analysis"};function L(e,t,s,l,a,o){const p=f("ViewToolbar"),d=f("AnalysisTable");return w(),C("div",H,[i(y,{fluid:"",class:"pa-2"},{default:n(()=>[i(h,{"no-gutters":""},{default:n(()=>[i(u,{cols:"12",md:"4",class:"pr-md-2 mb-2 mb-md-0"},{default:n(()=>[i(D,{id:"c-analysis-filter-task-name",clearable:"","hide-details":"",placeholder:"Filter by task name",modelValue:a.tasksFilter.name,"onUpdate:modelValue":t[0]||(t[0]=r=>a.tasksFilter.name=r),modelModifiers:{trim:!0},ref:"filterNameInput"},null,8,["modelValue"])]),_:1}),i(u,{cols:"12",md:"4",class:"mb-2 mb-md-0"},{default:n(()=>[i(c,{id:"c-analysis-filter-task-timings",items:e.$options.timingOptions,"hide-details":"",prefix:"Displaying:",modelValue:a.tasksFilter.timingOption,"onUpdate:modelValue":t[1]||(t[1]=r=>a.tasksFilter.timingOption=r)},null,8,["items","modelValue"])]),_:1}),i(u,{cols:"12",md:"4",class:"pl-md-2 mb-2 mb-md-0"},{default:n(()=>[i(c,{id:"c-analysis-filter-task-platforms",items:o.platformOptions,"hide-details":"",prefix:"Platform:",modelValue:a.tasksFilter.platformOption,"onUpdate:modelValue":t[2]||(t[2]=r=>a.tasksFilter.platformOption=r)},null,8,["items","modelValue"])]),_:1})]),_:1}),i(p,{groups:e.controlGroups},null,8,["groups"]),i(d,{tasks:o.filteredTasks,timingOption:a.tasksFilter.timingOption},null,8,["tasks","timingOption"])]),_:1})])}const G=T(I,[["render",L]]);export{G as default};
