import{ak as lt,cE as Pt,dk as qt,dl as X,ao as Bt,e as te,o as $,dm as Vt,T as $t,cu as Kt,dn as Ut,am as jt,dp as Yt,dq as Nt,ar as nt,x as Ie,z as Re,F as Ke,r as Rt,w as B,dr as Xt,_ as Ht,ds as Gt,c1 as Zt,dt as Qt,a2 as Jt,du as ei,ba as ti,dv as ii,dw as ni,dx as si,dy as ri,a5 as st,a7 as oi,cq as ai,dz as Ve,ac as be,dA as li,u as di,ae as hi,I as ci,dB as ui,dC as Ot,dD as fi,C as dt,bm as mi,y as Se,g as N,B as oe,cV as pi,D as De,l as ae,t as le,dE as gi,aA as _i,bl as bi,dF as rt,b3 as St,b5 as ot,A as yi,dG as wi,dH as vi,a8 as xi,a9 as Mi,aa as Ci,M as Si,L as ki,dI as Ii,dJ as zi,dK as Ai,bh as Ei,dL as Ti,cs as Di,dM as Li}from"./index-EpcknQ5m.js";import{g as Wt}from"./graphql-n5gzreXW.js";const Bi={__name:"Widget",props:{id:{type:String,required:!0}},setup(n){const e=n,t=lt(Date.now());return Pt("animResetTime",qt(t)),X.on(`lumino:show:${e.id}`,()=>{t.value=Date.now()}),Bt(()=>{X.off(`lumino:show:${e.id}`)}),(i,s)=>($(),te($t,{to:`#${n.id}`},[Vt(i.$slots,"default")],8,["to"]))}};var E;(function(n){function e(w,v,_=0,b=-1){let k=w.length;if(k===0)return-1;_<0?_=Math.max(0,_+k):_=Math.min(_,k-1),b<0?b=Math.max(0,b+k):b=Math.min(b,k-1);let A;b<_?A=b+1+(k-_):A=b-_+1;for(let D=0;D<A;++D){let L=(_+D)%k;if(w[L]===v)return L}return-1}n.firstIndexOf=e;function t(w,v,_=-1,b=0){let k=w.length;if(k===0)return-1;_<0?_=Math.max(0,_+k):_=Math.min(_,k-1),b<0?b=Math.max(0,b+k):b=Math.min(b,k-1);let A;_<b?A=_+1+(k-b):A=_-b+1;for(let D=0;D<A;++D){let L=(_-D+k)%k;if(w[L]===v)return L}return-1}n.lastIndexOf=t;function i(w,v,_=0,b=-1){let k=w.length;if(k===0)return-1;_<0?_=Math.max(0,_+k):_=Math.min(_,k-1),b<0?b=Math.max(0,b+k):b=Math.min(b,k-1);let A;b<_?A=b+1+(k-_):A=b-_+1;for(let D=0;D<A;++D){let L=(_+D)%k;if(v(w[L],L))return L}return-1}n.findFirstIndex=i;function s(w,v,_=-1,b=0){let k=w.length;if(k===0)return-1;_<0?_=Math.max(0,_+k):_=Math.min(_,k-1),b<0?b=Math.max(0,b+k):b=Math.min(b,k-1);let A;_<b?A=_+1+(k-b):A=_-b+1;for(let D=0;D<A;++D){let L=(_-D+k)%k;if(v(w[L],L))return L}return-1}n.findLastIndex=s;function r(w,v,_=0,b=-1){let k=i(w,v,_,b);return k!==-1?w[k]:void 0}n.findFirstValue=r;function l(w,v,_=-1,b=0){let k=s(w,v,_,b);return k!==-1?w[k]:void 0}n.findLastValue=l;function o(w,v,_,b=0,k=-1){let A=w.length;if(A===0)return 0;b<0?b=Math.max(0,b+A):b=Math.min(b,A-1),k<0?k=Math.max(0,k+A):k=Math.min(k,A-1);let D=b,L=k-b+1;for(;L>0;){let W=L>>1,Q=D+W;_(w[Q],v)<0?(D=Q+1,L-=W+1):L=W}return D}n.lowerBound=o;function a(w,v,_,b=0,k=-1){let A=w.length;if(A===0)return 0;b<0?b=Math.max(0,b+A):b=Math.min(b,A-1),k<0?k=Math.max(0,k+A):k=Math.min(k,A-1);let D=b,L=k-b+1;for(;L>0;){let W=L>>1,Q=D+W;_(w[Q],v)>0?L=W:(D=Q+1,L-=W+1)}return D}n.upperBound=a;function c(w,v,_){if(w===v)return!0;if(w.length!==v.length)return!1;for(let b=0,k=w.length;b<k;++b)if(_?!_(w[b],v[b]):w[b]!==v[b])return!1;return!0}n.shallowEqual=c;function h(w,v={}){let{start:_,stop:b,step:k}=v;if(k===void 0&&(k=1),k===0)throw new Error("Slice `step` cannot be zero.");let A=w.length;_===void 0?_=k<0?A-1:0:_<0?_=Math.max(_+A,k<0?-1:0):_>=A&&(_=k<0?A-1:A),b===void 0?b=k<0?-1:A:b<0?b=Math.max(b+A,k<0?-1:0):b>=A&&(b=k<0?A-1:A);let D;k<0&&b>=_||k>0&&_>=b?D=0:k<0?D=Math.floor((b-_+1)/k+1):D=Math.floor((b-_-1)/k+1);let L=[];for(let W=0;W<D;++W)L[W]=w[_+W*k];return L}n.slice=h;function m(w,v,_){let b=w.length;if(b<=1||(v<0?v=Math.max(0,v+b):v=Math.min(v,b-1),_<0?_=Math.max(0,_+b):_=Math.min(_,b-1),v===_))return;let k=w[v],A=v<_?1:-1;for(let D=v;D!==_;D+=A)w[D]=w[D+A];w[_]=k}n.move=m;function f(w,v=0,_=-1){let b=w.length;if(!(b<=1))for(v<0?v=Math.max(0,v+b):v=Math.min(v,b-1),_<0?_=Math.max(0,_+b):_=Math.min(_,b-1);v<_;){let k=w[v],A=w[_];w[v++]=A,w[_--]=k}}n.reverse=f;function d(w,v,_=0,b=-1){let k=w.length;if(k<=1||(_<0?_=Math.max(0,_+k):_=Math.min(_,k-1),b<0?b=Math.max(0,b+k):b=Math.min(b,k-1),_>=b))return;let A=b-_+1;if(v>0?v=v%A:v<0&&(v=(v%A+A)%A),v===0)return;let D=_+v;f(w,_,D-1),f(w,D,b),f(w,_,b)}n.rotate=d;function u(w,v,_=0,b=-1){let k=w.length;if(k===0)return;_<0?_=Math.max(0,_+k):_=Math.min(_,k-1),b<0?b=Math.max(0,b+k):b=Math.min(b,k-1);let A;b<_?A=b+1+(k-_):A=b-_+1;for(let D=0;D<A;++D)w[(_+D)%k]=v}n.fill=u;function p(w,v,_){let b=w.length;v<0?v=Math.max(0,v+b):v=Math.min(v,b);for(let k=b;k>v;--k)w[k]=w[k-1];w[v]=_}n.insert=p;function g(w,v){let _=w.length;if(v<0&&(v+=_),v<0||v>=_)return;let b=w[v];for(let k=v+1;k<_;++k)w[k-1]=w[k];return w.length=_-1,b}n.removeAt=g;function C(w,v,_=0,b=-1){let k=e(w,v,_,b);return k!==-1&&g(w,k),k}n.removeFirstOf=C;function M(w,v,_=-1,b=0){let k=t(w,v,_,b);return k!==-1&&g(w,k),k}n.removeLastOf=M;function y(w,v,_=0,b=-1){let k=w.length;if(k===0)return 0;_<0?_=Math.max(0,_+k):_=Math.min(_,k-1),b<0?b=Math.max(0,b+k):b=Math.min(b,k-1);let A=0;for(let D=0;D<k;++D)_<=b&&D>=_&&D<=b&&w[D]===v||b<_&&(D<=b||D>=_)&&w[D]===v?A++:A>0&&(w[D-A]=w[D]);return A>0&&(w.length=k-A),A}n.removeAllOf=y;function x(w,v,_=0,b=-1){let k,A=i(w,v,_,b);return A!==-1&&(k=g(w,A)),{index:A,value:k}}n.removeFirstWhere=x;function S(w,v,_=-1,b=0){let k,A=s(w,v,_,b);return A!==-1&&(k=g(w,A)),{index:A,value:k}}n.removeLastWhere=S;function I(w,v,_=0,b=-1){let k=w.length;if(k===0)return 0;_<0?_=Math.max(0,_+k):_=Math.min(_,k-1),b<0?b=Math.max(0,b+k):b=Math.min(b,k-1);let A=0;for(let D=0;D<k;++D)_<=b&&D>=_&&D<=b&&v(w[D],D)||b<_&&(D<=b||D>=_)&&v(w[D],D)?A++:A>0&&(w[D-A]=w[D]);return A>0&&(w.length=k-A),A}n.removeAllWhere=I})(E||(E={}));function*Le(){}function ht(n,e){let t=0;for(const i of n)if(e(i,t++))return i}function Ni(n,e){let t=0;for(const i of n)if(e(i,t++)===!1)return!1;return!0}function Ri(n,e){let t=0;for(const i of n)if(e(i,t++))return!0;return!1}var kt;(function(n){function e(t,i,s){return s===0?1/0:t>i&&s>0||t<i&&s<0?0:Math.ceil((i-t)/s)}n.rangeLength=e})(kt||(kt={}));function*Hi(n){if(typeof n.retro=="function")yield*n.retro();else for(let e=n.length-1;e>-1;e--)yield n[e]}function Oi(n){let e=[],t=new Set,i=new Map;for(const l of n)s(l);for(const[l]of i)r(l);return e;function s(l){let[o,a]=l,c=i.get(a);c?c.push(o):i.set(a,[o])}function r(l){if(t.has(l))return;t.add(l);let o=i.get(l);if(o)for(const a of o)r(a);e.push(l)}}var He;(function(n){function e(l,o,a=0){let c=new Array(o.length);for(let h=0,m=a,f=o.length;h<f;++h,++m){if(m=l.indexOf(o[h],m),m===-1)return null;c[h]=m}return c}n.findIndices=e;function t(l,o,a=0){let c=e(l,o,a);if(!c)return null;let h=0;for(let m=0,f=c.length;m<f;++m){let d=c[m]-a;h+=d*d}return{score:h,indices:c}}n.matchSumOfSquares=t;function i(l,o,a=0){let c=e(l,o,a);if(!c)return null;let h=0,m=a-1;for(let f=0,d=c.length;f<d;++f){let u=c[f];h+=u-m-1,m=u}return{score:h,indices:c}}n.matchSumOfDeltas=i;function s(l,o,a){let c=[],h=0,m=0,f=o.length;for(;h<f;){let d=o[h],u=o[h];for(;++h<f&&o[h]===u+1;)u++;m<d&&c.push(l.slice(m,d)),d<u+1&&c.push(a(l.slice(d,u+1))),m=u+1}return m<l.length&&c.push(l.slice(m)),c}n.highlight=s;function r(l,o){return l<o?-1:l>o?1:0}n.cmp=r})(He||(He={}));var P;(function(n){n.emptyObject=Object.freeze({}),n.emptyArray=Object.freeze([]);function e(h){return h===null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"}n.isPrimitive=e;function t(h){return Array.isArray(h)}n.isArray=t;function i(h){return!e(h)&&!t(h)}n.isObject=i;function s(h,m){if(h===m)return!0;if(e(h)||e(m))return!1;let f=t(h),d=t(m);return f!==d?!1:f&&d?l(h,m):o(h,m)}n.deepEqual=s;function r(h){return e(h)?h:t(h)?a(h):c(h)}n.deepCopy=r;function l(h,m){if(h===m)return!0;if(h.length!==m.length)return!1;for(let f=0,d=h.length;f<d;++f)if(!s(h[f],m[f]))return!1;return!0}function o(h,m){if(h===m)return!0;for(let f in h)if(h[f]!==void 0&&!(f in m))return!1;for(let f in m)if(m[f]!==void 0&&!(f in h))return!1;for(let f in h){let d=h[f],u=m[f];if(!(d===void 0&&u===void 0)&&(d===void 0||u===void 0||!s(d,u)))return!1}return!0}function a(h){let m=new Array(h.length);for(let f=0,d=h.length;f<d;++f)m[f]=r(h[f]);return m}function c(h){let m={};for(let f in h){let d=h[f];d!==void 0&&(m[f]=r(d))}return m}})(P||(P={}));class Wi{constructor(){this._types=[],this._values=[]}types(){return this._types.slice()}hasData(e){return this._types.indexOf(e)!==-1}getData(e){let t=this._types.indexOf(e);return t!==-1?this._values[t]:void 0}setData(e,t){this.clearData(e),this._types.push(e),this._values.push(t)}clearData(e){let t=this._types.indexOf(e);t!==-1&&(this._types.splice(t,1),this._values.splice(t,1))}clear(){this._types.length=0,this._values.length=0}}var It;(function(n){class e{constructor(o){var a,c,h,m;this._activated=!1,this._promise=null,this._service=null,this.id=o.id,this.description=(a=o.description)!==null&&a!==void 0?a:"",this.activate=o.activate,this.deactivate=(c=o.deactivate)!==null&&c!==void 0?c:null,this.provides=(h=o.provides)!==null&&h!==void 0?h:null,this.autoStart=(m=o.autoStart)!==null&&m!==void 0?m:!1,this.requires=o.requires?o.requires.slice():[],this.optional=o.optional?o.optional.slice():[]}get activated(){return this._activated}set activated(o){this._activated=o}get service(){return this._service}set service(o){this._service=o}get promise(){return this._promise}set promise(o){this._promise=o}}function t(l){return new e(l)}n.createPluginData=t;function i(l,o,a){const c=[...l.requires,...l.optional],h=f=>{if(f===l.provides)return!0;const d=a.get(f);if(!d)return!1;const u=o.get(d),p=[...u.requires,...u.optional];return p.length===0?!1:(m.push(d),p.some(h)?!0:(m.pop(),!1))};if(!l.provides||c.length===0)return;const m=[l.id];if(c.some(h))throw new ReferenceError(`Cycle detected: ${m.join(" -> ")}.`)}n.ensureNoCycle=i;function s(l,o,a){const c=new Array,h=p=>{const g=o.get(p),C=[...g.requires,...g.optional];c.push(...C.reduce((M,y)=>{const x=a.get(y);return x&&M.push([p,x]),M},[]))};for(const p of o.keys())h(p);const m=c.filter(p=>p[1]===l);let f=0;for(;m.length>f;){const p=m.length,g=new Set(m.map(C=>C[0]));for(const C of g)c.filter(M=>M[1]===C).forEach(M=>{m.includes(M)||m.push(M)});f=p}const d=Oi(m),u=d.findIndex(p=>p===l);return u===-1?[l]:d.slice(0,u+1)}n.findDependents=s;function r(l,o){const a=new Set;for(const c of l.keys())l.get(c).autoStart===!0&&a.add(c);if(o.startPlugins)for(const c of o.startPlugins)a.add(c);if(o.ignorePlugins)for(const c of o.ignorePlugins)a.delete(c);return Array.from(a)}n.collectStartupPlugins=r})(It||(It={}));function Fi(n){let e=0;for(let t=0,i=n.length;t<i;++t)t%4===0&&(e=Math.random()*4294967295>>>0),n[t]=e&255,e>>>=8}var ct;(function(n){n.getRandomValues=(()=>{const e=typeof window<"u"&&(window.crypto||window.msCrypto)||null;return e&&typeof e.getRandomValues=="function"?function(i){return e.getRandomValues(i)}:Fi})()})(ct||(ct={}));function Pi(n){const e=new Uint8Array(16),t=new Array(256);for(let i=0;i<16;++i)t[i]="0"+i.toString(16);for(let i=16;i<256;++i)t[i]=i.toString(16);return function(){return n(e),e[6]=64|e[6]&15,e[8]=128|e[8]&63,t[e[0]]+t[e[1]]+t[e[2]]+t[e[3]]+"-"+t[e[4]]+t[e[5]]+"-"+t[e[6]]+t[e[7]]+"-"+t[e[8]]+t[e[9]]+"-"+t[e[10]]+t[e[11]]+t[e[12]]+t[e[13]]+t[e[14]]+t[e[15]]}}var ut;(function(n){n.uuid4=Pi(ct.getRandomValues)})(ut||(ut={}));var zt;(function(n){function e(t){const i=document.body,s=r=>{r.preventDefault(),r.stopPropagation(),r.clipboardData.setData("text",t),i.removeEventListener("copy",s,!0)};i.addEventListener("copy",s,!0),document.execCommand("copy")}n.copyText=e})(zt||(zt={}));var H;(function(n){function e(r){let l=window.getComputedStyle(r),o=parseFloat(l.borderTopWidth)||0,a=parseFloat(l.borderLeftWidth)||0,c=parseFloat(l.borderRightWidth)||0,h=parseFloat(l.borderBottomWidth)||0,m=parseFloat(l.paddingTop)||0,f=parseFloat(l.paddingLeft)||0,d=parseFloat(l.paddingRight)||0,u=parseFloat(l.paddingBottom)||0,p=a+f+d+c,g=o+m+u+h;return{borderTop:o,borderLeft:a,borderRight:c,borderBottom:h,paddingTop:m,paddingLeft:f,paddingRight:d,paddingBottom:u,horizontalSum:p,verticalSum:g}}n.boxSizing=e;function t(r){let l=window.getComputedStyle(r),o=parseFloat(l.minWidth)||0,a=parseFloat(l.minHeight)||0,c=parseFloat(l.maxWidth)||1/0,h=parseFloat(l.maxHeight)||1/0;return c=Math.max(o,c),h=Math.max(a,h),{minWidth:o,minHeight:a,maxWidth:c,maxHeight:h}}n.sizeLimits=t;function i(r,l,o){let a=r.getBoundingClientRect();return l>=a.left&&l<a.right&&o>=a.top&&o<a.bottom}n.hitTest=i;function s(r,l){let o=r.getBoundingClientRect(),a=l.getBoundingClientRect();if(!(a.top<=o.top&&a.bottom>=o.bottom)){if(a.top<o.top&&a.height<=o.height){r.scrollTop-=o.top-a.top;return}if(a.bottom>o.bottom&&a.height>=o.height){r.scrollTop-=o.top-a.top;return}if(a.top<o.top&&a.height>o.height){r.scrollTop-=o.bottom-a.bottom;return}if(a.bottom>o.bottom&&a.height<o.height){r.scrollTop-=o.bottom-a.bottom;return}}}n.scrollIntoViewIfNeeded=s})(H||(H={}));var Y;(function(n){n.IS_MAC=!!navigator.platform.match(/Mac/i),n.IS_WIN=!!navigator.platform.match(/Win/i),n.IS_IE=/Trident/.test(navigator.userAgent),n.IS_EDGE=/Edge/.test(navigator.userAgent);function e(t){return n.IS_MAC?t.metaKey:t.ctrlKey}n.accelKey=e})(Y||(Y={}));var ue;(function(n){function e(s){if(s in ne.specificityCache)return ne.specificityCache[s];let r=ne.calculateSingle(s);return ne.specificityCache[s]=r}n.calculateSpecificity=e;function t(s){if(s in ne.validityCache)return ne.validityCache[s];let r=!0;try{ne.testElem.querySelector(s)}catch{r=!1}return ne.validityCache[s]=r}n.isValid=t;function i(s,r){return ne.protoMatchFunc.call(s,r)}n.matches=i})(ue||(ue={}));var ne;(function(n){n.specificityCache=Object.create(null),n.validityCache=Object.create(null),n.testElem=document.createElement("div"),n.protoMatchFunc=(()=>{let h=Element.prototype;return h.matches||h.matchesSelector||h.mozMatchesSelector||h.msMatchesSelector||h.oMatchesSelector||h.webkitMatchesSelector||function(m){let f=this,d=f.ownerDocument?f.ownerDocument.querySelectorAll(m):[];return Array.prototype.indexOf.call(d,f)!==-1}})();function e(h){h=h.split(",",1)[0];let m=0,f=0,d=0;function u(p){let g=h.match(p);return g===null?!1:(h=h.slice(g[0].length),!0)}for(h=h.replace(c," $1 ");h.length>0;){if(u(t)){m++;continue}if(u(i)){f++;continue}if(u(s)){f++;continue}if(u(l)){d++;continue}if(u(o)){f++;continue}if(u(r)){d++;continue}if(!u(a))return 0}return m=Math.min(m,255),f=Math.min(f,255),d=Math.min(d,255),m<<16|f<<8|d}n.calculateSingle=e;const t=/^#[^\s\+>~#\.\[:]+/,i=/^\.[^\s\+>~#\.\[:]+/,s=/^\[[^\]]+\]/,r=/^[^\s\+>~#\.\[:]+/,l=/^(::[^\s\+>~#\.\[:]+|:first-line|:first-letter|:before|:after)/,o=/^:[^\s\+>~#\.\[:]+/,a=/^[\s\+>~\*]+/,c=/:not\(([^\)]+)\)/g})(ne||(ne={}));class ft{constructor(){this._first=null,this._last=null,this._size=0}get isEmpty(){return this._size===0}get size(){return this._size}get length(){return this._size}get first(){return this._first?this._first.value:void 0}get last(){return this._last?this._last.value:void 0}get firstNode(){return this._first}get lastNode(){return this._last}*[Symbol.iterator](){let e=this._first;for(;e;)yield e.value,e=e.next}*retro(){let e=this._last;for(;e;)yield e.value,e=e.prev}*nodes(){let e=this._first;for(;e;)yield e,e=e.next}*retroNodes(){let e=this._last;for(;e;)yield e,e=e.prev}assign(e){this.clear();for(const t of e)this.addLast(t)}push(e){this.addLast(e)}pop(){return this.removeLast()}shift(e){this.addFirst(e)}unshift(){return this.removeFirst()}addFirst(e){let t=new de.LinkedListNode(this,e);return this._first?(t.next=this._first,this._first.prev=t,this._first=t):(this._first=t,this._last=t),this._size++,t}addLast(e){let t=new de.LinkedListNode(this,e);return this._last?(t.prev=this._last,this._last.next=t,this._last=t):(this._first=t,this._last=t),this._size++,t}insertBefore(e,t){if(!t||t===this._first)return this.addFirst(e);if(!(t instanceof de.LinkedListNode)||t.list!==this)throw new Error("Reference node is not owned by the list.");let i=new de.LinkedListNode(this,e),s=t,r=s.prev;return i.next=s,i.prev=r,s.prev=i,r.next=i,this._size++,i}insertAfter(e,t){if(!t||t===this._last)return this.addLast(e);if(!(t instanceof de.LinkedListNode)||t.list!==this)throw new Error("Reference node is not owned by the list.");let i=new de.LinkedListNode(this,e),s=t,r=s.next;return i.next=r,i.prev=s,s.next=i,r.prev=i,this._size++,i}removeFirst(){let e=this._first;if(e)return e===this._last?(this._first=null,this._last=null):(this._first=e.next,this._first.prev=null),e.list=null,e.next=null,e.prev=null,this._size--,e.value}removeLast(){let e=this._last;if(e)return e===this._first?(this._first=null,this._last=null):(this._last=e.prev,this._last.next=null),e.list=null,e.next=null,e.prev=null,this._size--,e.value}removeNode(e){if(!(e instanceof de.LinkedListNode)||e.list!==this)throw new Error("Node is not owned by the list.");let t=e;t===this._first&&t===this._last?(this._first=null,this._last=null):t===this._first?(this._first=t.next,this._first.prev=null):t===this._last?(this._last=t.prev,this._last.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.list=null,t.next=null,t.prev=null,this._size--}clear(){let e=this._first;for(;e;){let t=e.next;e.list=null,e.prev=null,e.next=null,e=t}this._first=null,this._last=null,this._size=0}}(function(n){function e(t){let i=new n;return i.assign(t),i}n.from=e})(ft||(ft={}));var de;(function(n){class e{constructor(i,s){this.list=null,this.next=null,this.prev=null,this.list=i,this.value=s}}n.LinkedListNode=e})(de||(de={}));class J{constructor(e){this.type=e}get isConflatable(){return!1}conflate(e){return!1}}class Ne extends J{get isConflatable(){return!0}conflate(e){return!0}}var T;(function(n){let e=null;const t=(v=>_=>{let b=!1;return v.then(()=>!b&&_()),()=>{b=!0}})(Promise.resolve());function i(v,_){let b=f.get(v);if(!b||b.length===0){C(v,_);return}Ni(Hi(b),A=>A?g(A,v,_):!0)&&C(v,_)}n.sendMessage=i;function s(v,_){if(!_.isConflatable){M(v,_);return}Ri(m,k=>k.handler!==v||!k.msg||k.msg.type!==_.type||!k.msg.isConflatable?!1:k.msg.conflate(_))||M(v,_)}n.postMessage=s;function r(v,_){let b=f.get(v);b&&b.indexOf(_)!==-1||(b?b.push(_):f.set(v,[_]))}n.installMessageHook=r;function l(v,_){let b=f.get(v);if(!b)return;let k=b.indexOf(_);k!==-1&&(b[k]=null,x(b))}n.removeMessageHook=l;function o(v){let _=f.get(v);_&&_.length>0&&(E.fill(_,null),x(_));for(const b of m)b.handler===v&&(b.handler=null,b.msg=null)}n.clearData=o;function a(){p||e===null||(e(),e=null,p=!0,y(),p=!1)}n.flush=a;function c(){return u}n.getExceptionHandler=c;function h(v){let _=u;return u=v,_}n.setExceptionHandler=h;const m=new ft,f=new WeakMap,d=new Set;let u=v=>{console.error(v)},p=!1;function g(v,_,b){let k=!0;try{typeof v=="function"?k=v(_,b):k=v.messageHook(_,b)}catch(A){u(A)}return k}function C(v,_){try{v.processMessage(_)}catch(b){u(b)}}function M(v,_){m.addLast({handler:v,msg:_}),e===null&&(e=t(y))}function y(){if(e=null,m.isEmpty)return;let v={handler:null,msg:null};for(m.addLast(v);;){let _=m.removeFirst();if(_===v)return;_.handler&&_.msg&&i(_.handler,_.msg)}}function x(v){d.size===0&&t(S),d.add(v)}function S(){d.forEach(I),d.clear()}function I(v){E.removeAllWhere(v,w)}function w(v){return v===null}})(T||(T={}));class ie{constructor(e){this._pid=we.nextPID(),this.name=e.name,this._create=e.create,this._coerce=e.coerce||null,this._compare=e.compare||null,this._changed=e.changed||null}get(e){let t,i=we.ensureMap(e);return this._pid in i?t=i[this._pid]:t=i[this._pid]=this._createValue(e),t}set(e,t){let i,s=we.ensureMap(e);this._pid in s?i=s[this._pid]:i=s[this._pid]=this._createValue(e);let r=this._coerceValue(e,t);this._maybeNotify(e,i,s[this._pid]=r)}coerce(e){let t,i=we.ensureMap(e);this._pid in i?t=i[this._pid]:t=i[this._pid]=this._createValue(e);let s=this._coerceValue(e,t);this._maybeNotify(e,t,i[this._pid]=s)}_createValue(e){let t=this._create;return t(e)}_coerceValue(e,t){let i=this._coerce;return i?i(e,t):t}_compareValue(e,t){let i=this._compare;return i?i(e,t):e===t}_maybeNotify(e,t,i){let s=this._changed;s&&!this._compareValue(t,i)&&s(e,t,i)}}(function(n){function e(t){we.ownerData.delete(t)}n.clearData=e})(ie||(ie={}));var we;(function(n){n.ownerData=new WeakMap,n.nextPID=(()=>{let t=0;return()=>`pid-${`${Math.random()}`.slice(2)}-${t++}`})();function e(t){let i=n.ownerData.get(t);return i||(i=Object.create(null),n.ownerData.set(t,i),i)}n.ensureMap=e})(we||(we={}));class O{constructor(e){this.sender=e}connect(e,t){return G.connect(this,e,t)}disconnect(e,t){return G.disconnect(this,e,t)}emit(e){G.emit(this,e)}}(function(n){function e(a,c){G.disconnectBetween(a,c)}n.disconnectBetween=e;function t(a){G.disconnectSender(a)}n.disconnectSender=t;function i(a){G.disconnectReceiver(a)}n.disconnectReceiver=i;function s(a){G.disconnectAll(a)}n.disconnectAll=s;function r(a){G.disconnectAll(a)}n.clearData=r;function l(){return G.exceptionHandler}n.getExceptionHandler=l;function o(a){let c=G.exceptionHandler;return G.exceptionHandler=a,c}n.setExceptionHandler=o})(O||(O={}));var G;(function(n){n.exceptionHandler=M=>{console.error(M)};function e(M,y,x){x=x||void 0;let S=a.get(M.sender);if(S||(S=[],a.set(M.sender,S)),f(S,M,y,x))return!1;let I=x||y,w=c.get(I);w||(w=[],c.set(I,w));let v={signal:M,slot:y,thisArg:x};return S.push(v),w.push(v),!0}n.connect=e;function t(M,y,x){x=x||void 0;let S=a.get(M.sender);if(!S||S.length===0)return!1;let I=f(S,M,y,x);if(!I)return!1;let w=x||y,v=c.get(w);return I.signal=null,u(S),u(v),!0}n.disconnect=t;function i(M,y){let x=a.get(M);if(!x||x.length===0)return;let S=c.get(y);if(!(!S||S.length===0)){for(const I of S)I.signal&&I.signal.sender===M&&(I.signal=null);u(x),u(S)}}n.disconnectBetween=i;function s(M){let y=a.get(M);if(!(!y||y.length===0)){for(const x of y){if(!x.signal)continue;let S=x.thisArg||x.slot;x.signal=null,u(c.get(S))}u(y)}}n.disconnectSender=s;function r(M){let y=c.get(M);if(!(!y||y.length===0)){for(const x of y){if(!x.signal)continue;let S=x.signal.sender;x.signal=null,u(a.get(S))}u(y)}}n.disconnectReceiver=r;function l(M){s(M),r(M)}n.disconnectAll=l;function o(M,y){let x=a.get(M.sender);if(!(!x||x.length===0))for(let S=0,I=x.length;S<I;++S){let w=x[S];w.signal===M&&d(w,y)}}n.emit=o;const a=new WeakMap,c=new WeakMap,h=new Set,m=typeof requestAnimationFrame=="function"?requestAnimationFrame:setImmediate;function f(M,y,x,S){return ht(M,I=>I.signal===y&&I.slot===x&&I.thisArg===S)}function d(M,y){let{signal:x,slot:S,thisArg:I}=M;try{S.call(I,x.sender,y)}catch(w){n.exceptionHandler(w)}}function u(M){h.size===0&&m(p),h.add(M)}function p(){h.forEach(g),h.clear()}function g(M){E.removeAllWhere(M,C)}function C(M){return M.signal===null}})(G||(G={}));class mt{constructor(e){this._fn=e}get isDisposed(){return!this._fn}dispose(){if(!this._fn)return;let e=this._fn;this._fn=null,e()}}class pt{constructor(){this._isDisposed=!1,this._items=new Set}get isDisposed(){return this._isDisposed}dispose(){this._isDisposed||(this._isDisposed=!0,this._items.forEach(e=>{e.dispose()}),this._items.clear())}contains(e){return this._items.has(e)}add(e){this._items.add(e)}remove(e){this._items.delete(e)}clear(){this._items.clear()}}(function(n){function e(t){let i=new n;for(const s of t)i.add(s);return i}n.from=e})(pt||(pt={}));class At extends pt{constructor(){super(...arguments),this._disposed=new O(this)}get disposed(){return this._disposed}dispose(){this.isDisposed||(super.dispose(),this._disposed.emit(void 0),O.clearData(this))}}(function(n){function e(t){let i=new n;for(const s of t)i.add(s);return i}n.from=e})(At||(At={}));class K{constructor(e){this._onScrollFrame=()=>{if(!this._scrollTarget)return;let{element:t,edge:i,distance:s}=this._scrollTarget,r=U.SCROLL_EDGE_SIZE-s,l=Math.pow(r/U.SCROLL_EDGE_SIZE,2),o=Math.max(1,Math.round(l*U.SCROLL_EDGE_SIZE));switch(i){case"top":t.scrollTop-=o;break;case"left":t.scrollLeft-=o;break;case"right":t.scrollLeft+=o;break;case"bottom":t.scrollTop+=o;break}requestAnimationFrame(this._onScrollFrame)},this._disposed=!1,this._dropAction="none",this._override=null,this._currentTarget=null,this._currentElement=null,this._promise=null,this._scrollTarget=null,this._resolve=null,this.document=e.document||document,this.mimeData=e.mimeData,this.dragImage=e.dragImage||null,this.proposedAction=e.proposedAction||"copy",this.supportedActions=e.supportedActions||"all",this.source=e.source||null}dispose(){if(!this._disposed){if(this._disposed=!0,this._currentTarget){let e=new PointerEvent("pointerup",{bubbles:!0,cancelable:!0,clientX:-1,clientY:-1});U.dispatchDragLeave(this,this._currentTarget,null,e)}this._finalize("none")}}get isDisposed(){return this._disposed}start(e,t){if(this._disposed)return Promise.resolve("none");if(this._promise)return this._promise;this._addListeners(),this._attachDragImage(e,t),this._promise=new Promise(s=>{this._resolve=s});let i=new PointerEvent("pointermove",{bubbles:!0,cancelable:!0,clientX:e,clientY:t});return document.dispatchEvent(i),this._promise}handleEvent(e){switch(e.type){case"pointermove":this._evtPointerMove(e);break;case"pointerup":this._evtPointerUp(e);break;case"keydown":this._evtKeyDown(e);break;default:e.preventDefault(),e.stopPropagation();break}}moveDragImage(e,t){if(!this.dragImage)return;let i=this.dragImage.style;i.transform=`translate(${e}px, ${t}px)`}_evtPointerMove(e){e.preventDefault(),e.stopPropagation(),this._updateCurrentTarget(e),this._updateDragScroll(e),this.moveDragImage(e.clientX,e.clientY)}_evtPointerUp(e){if(e.preventDefault(),e.stopPropagation(),e.button!==0)return;if(this._updateCurrentTarget(e),!this._currentTarget){this._finalize("none");return}if(this._dropAction==="none"){U.dispatchDragLeave(this,this._currentTarget,null,e),this._finalize("none");return}let t=U.dispatchDrop(this,this._currentTarget,e);this._finalize(t)}_evtKeyDown(e){e.preventDefault(),e.stopPropagation(),e.keyCode===27&&this.dispose()}_addListeners(){document.addEventListener("pointerdown",this,!0),document.addEventListener("pointermove",this,!0),document.addEventListener("pointerup",this,!0),document.addEventListener("pointerenter",this,!0),document.addEventListener("pointerleave",this,!0),document.addEventListener("pointerover",this,!0),document.addEventListener("pointerout",this,!0),document.addEventListener("keydown",this,!0),document.addEventListener("keyup",this,!0),document.addEventListener("keypress",this,!0),document.addEventListener("contextmenu",this,!0)}_removeListeners(){document.removeEventListener("pointerdown",this,!0),document.removeEventListener("pointermove",this,!0),document.removeEventListener("pointerup",this,!0),document.removeEventListener("pointerenter",this,!0),document.removeEventListener("pointerleave",this,!0),document.removeEventListener("pointerover",this,!0),document.removeEventListener("pointerout",this,!0),document.removeEventListener("keydown",this,!0),document.removeEventListener("keyup",this,!0),document.removeEventListener("keypress",this,!0),document.removeEventListener("contextmenu",this,!0)}_updateDragScroll(e){let t=U.findScrollTarget(e);!this._scrollTarget&&!t||(this._scrollTarget||setTimeout(this._onScrollFrame,500),this._scrollTarget=t)}_updateCurrentTarget(e){let t=this._currentTarget,i=this._currentTarget,s=this._currentElement,r=U.findElementBehindBackdrop(e,this.document);this._currentElement=r,r!==s&&r!==i&&U.dispatchDragExit(this,i,r,e),r!==s&&r!==i&&(i=U.dispatchDragEnter(this,r,i,e)),i!==t&&(this._currentTarget=i,U.dispatchDragLeave(this,t,i,e));let l=U.dispatchDragOver(this,i,e);this._setDropAction(l)}_attachDragImage(e,t){if(!this.dragImage)return;this.dragImage.classList.add("lm-mod-drag-image");let i=this.dragImage.style;i.pointerEvents="none",i.position="fixed",i.transform=`translate(${e}px, ${t}px)`,(this.document instanceof Document?this.document.body:this.document.firstElementChild).appendChild(this.dragImage)}_detachDragImage(){if(!this.dragImage)return;let e=this.dragImage.parentNode;e&&e.removeChild(this.dragImage)}_setDropAction(e){if(e=U.validateAction(e,this.supportedActions),!(this._override&&this._dropAction===e))switch(e){case"none":this._dropAction=e,this._override=K.overrideCursor("no-drop",this.document);break;case"copy":this._dropAction=e,this._override=K.overrideCursor("copy",this.document);break;case"link":this._dropAction=e,this._override=K.overrideCursor("alias",this.document);break;case"move":this._dropAction=e,this._override=K.overrideCursor("move",this.document);break}}_finalize(e){let t=this._resolve;this._removeListeners(),this._detachDragImage(),this._override&&(this._override.dispose(),this._override=null),this.mimeData.clear(),this._disposed=!0,this._dropAction="none",this._currentTarget=null,this._currentElement=null,this._scrollTarget=null,this._promise=null,this._resolve=null,t&&t(e)}}(function(n){class e extends DragEvent{constructor(s,r){super(r.type,{bubbles:!0,cancelable:!0,altKey:s.altKey,button:s.button,clientX:s.clientX,clientY:s.clientY,ctrlKey:s.ctrlKey,detail:0,metaKey:s.metaKey,relatedTarget:r.related,screenX:s.screenX,screenY:s.screenY,shiftKey:s.shiftKey,view:window});const{drag:l}=r;this.dropAction="none",this.mimeData=l.mimeData,this.proposedAction=l.proposedAction,this.supportedActions=l.supportedActions,this.source=l.source}}n.Event=e;function t(i,s=document){return U.overrideCursor(i,s)}n.overrideCursor=t})(K||(K={}));var U;(function(n){n.SCROLL_EDGE_SIZE=20;function e(x,S){return m[x]&f[S]?x:"none"}n.validateAction=e;function t(x,S=document){if(x){if(i&&x==i.event)return i.element;n.cursorBackdrop.style.zIndex="-1000";const I=S.elementFromPoint(x.clientX,x.clientY);return n.cursorBackdrop.style.zIndex="",i={event:x,element:I},I}else{const I=n.cursorBackdrop.style.transform;if(s&&I===s.transform)return s.element;const w=n.cursorBackdrop.getBoundingClientRect();n.cursorBackdrop.style.zIndex="-1000";const v=S.elementFromPoint(w.left+w.width/2,w.top+w.height/2);return n.cursorBackdrop.style.zIndex="",s={transform:I,element:v},v}}n.findElementBehindBackdrop=t;let i=null,s=null;function r(x){let S=x.clientX,I=x.clientY,w=t(x);for(;w;w=w.parentElement){if(!w.hasAttribute("data-lm-dragscroll"))continue;let v=0,_=0;w===document.body&&(v=window.pageXOffset,_=window.pageYOffset);let b=w.getBoundingClientRect(),k=b.top+_,A=b.left+v,D=A+b.width,L=k+b.height;if(S<A||S>=D||I<k||I>=L)continue;let W=S-A+1,Q=I-k+1,Mt=D-S,Ct=L-I,et=Math.min(W,Q,Mt,Ct);if(et>n.SCROLL_EDGE_SIZE)continue;let Ce;switch(et){case Ct:Ce="bottom";break;case Q:Ce="top";break;case Mt:Ce="right";break;case W:Ce="left";break;default:throw"unreachable"}let tt=w.scrollWidth-w.clientWidth,it=w.scrollHeight-w.clientHeight,Te;switch(Ce){case"top":Te=it>0&&w.scrollTop>0;break;case"left":Te=tt>0&&w.scrollLeft>0;break;case"right":Te=tt>0&&w.scrollLeft<tt;break;case"bottom":Te=it>0&&w.scrollTop<it;break;default:throw"unreachable"}if(Te)return{element:w,edge:Ce,distance:et}}return null}n.findScrollTarget=r;function l(x,S,I,w){if(!S)return null;let v=new K.Event(w,{drag:x,related:I,type:"lm-dragenter"});if(!S.dispatchEvent(v))return S;const b=x.document instanceof Document?x.document.body:x.document.firstElementChild;return S===b?I:(v=new K.Event(w,{drag:x,related:I,type:"lm-dragenter"}),b.dispatchEvent(v),b)}n.dispatchDragEnter=l;function o(x,S,I,w){if(!S)return;let v=new K.Event(w,{drag:x,related:I,type:"lm-dragexit"});S.dispatchEvent(v)}n.dispatchDragExit=o;function a(x,S,I,w){if(!S)return;let v=new K.Event(w,{drag:x,related:I,type:"lm-dragleave"});S.dispatchEvent(v)}n.dispatchDragLeave=a;function c(x,S,I){if(!S)return"none";let w=new K.Event(I,{drag:x,related:null,type:"lm-dragover"});return S.dispatchEvent(w)?"none":w.dropAction}n.dispatchDragOver=c;function h(x,S,I){if(!S)return"none";let w=new K.Event(I,{drag:x,related:null,type:"lm-drop"});return S.dispatchEvent(w)?"none":w.dropAction}n.dispatchDrop=h;const m={none:0,copy:1,link:2,move:4},f={none:m.none,copy:m.copy,link:m.link,move:m.move,"copy-link":m.copy|m.link,"copy-move":m.copy|m.move,"link-move":m.link|m.move,all:m.copy|m.link|m.move};function d(x,S=document){let I=++y;const w=S instanceof Document?S.body:S.firstElementChild;return n.cursorBackdrop.isConnected||(n.cursorBackdrop.style.transform="scale(0)",w.appendChild(n.cursorBackdrop),g(),document.addEventListener("pointermove",u,{capture:!0,passive:!0}),n.cursorBackdrop.addEventListener("scroll",p,{capture:!0,passive:!0})),n.cursorBackdrop.style.cursor=x,new mt(()=>{I===y&&n.cursorBackdrop.isConnected&&(document.removeEventListener("pointermove",u,!0),n.cursorBackdrop.removeEventListener("scroll",p,!0),w.removeChild(n.cursorBackdrop))})}n.overrideCursor=d;function u(x){n.cursorBackdrop&&(n.cursorBackdrop.style.transform=`translate(${x.clientX}px, ${x.clientY}px)`)}function p(x){if(!n.cursorBackdrop)return;let S=t();if(!S)return;const I=S.closest("[data-lm-dragscroll]");I&&(I.scrollTop+=n.cursorBackdrop.scrollTop-C,I.scrollLeft+=n.cursorBackdrop.scrollLeft-C,g())}function g(){n.cursorBackdrop.scrollTop=C,n.cursorBackdrop.scrollLeft=C}const C=500;function M(){const x=document.createElement("div");return x.classList.add("lm-cursor-backdrop"),x}let y=0;n.cursorBackdrop=M()})(U||(U={}));function Ue(){return gt.keyboardLayout}class ze{constructor(e,t,i=[]){this.name=e,this._codes=t,this._keys=ze.extractKeys(t),this._modifierKeys=ze.convertToKeySet(i)}keys(){return Object.keys(this._keys)}isValidKey(e){return e in this._keys}isModifierKey(e){return e in this._modifierKeys}keyForKeydownEvent(e){return this._codes[e.keyCode]||""}}(function(n){function e(i){let s=Object.create(null);for(let r in i)s[i[r]]=!0;return s}n.extractKeys=e;function t(i){let s=Object(null);for(let r=0,l=i.length;r<l;++r)s[i[r]]=!0;return s}n.convertToKeySet=t})(ze||(ze={}));const qi=new ze("en-us",{8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",27:"Escape",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",91:"Meta",93:"ContextMenu",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",224:"Meta"},["Shift","Ctrl","Alt","Meta"]);var gt;(function(n){n.keyboardLayout=qi})(gt||(gt={}));class me{constructor(){this._timerID=0,this._timerModifierID=0,this._replaying=!1,this._keystrokes=[],this._keydownEvents=[],this._keyBindings=[],this._exactKeyMatch=null,this._commands=new Map,this._commandChanged=new O(this),this._commandExecuted=new O(this),this._keyBindingChanged=new O(this),this._holdKeyBindingPromises=new Map}get commandChanged(){return this._commandChanged}get commandExecuted(){return this._commandExecuted}get keyBindingChanged(){return this._keyBindingChanged}get keyBindings(){return this._keyBindings}listCommands(){return Array.from(this._commands.keys())}hasCommand(e){return this._commands.has(e)}addCommand(e,t){if(this._commands.has(e))throw new Error(`Command '${e}' already registered.`);return this._commands.set(e,se.createCommand(t)),this._commandChanged.emit({id:e,type:"added"}),new mt(()=>{this._commands.delete(e),this._commandChanged.emit({id:e,type:"removed"})})}notifyCommandChanged(e){if(e!==void 0&&!this._commands.has(e))throw new Error(`Command '${e}' is not registered.`);this._commandChanged.emit({id:e,type:e?"changed":"many-changed"})}describedBy(e,t=P.emptyObject){var i;let s=this._commands.get(e);return Promise.resolve((i=s?.describedBy.call(void 0,t))!==null&&i!==void 0?i:{args:null})}label(e,t=P.emptyObject){var i;let s=this._commands.get(e);return(i=s?.label.call(void 0,t))!==null&&i!==void 0?i:""}mnemonic(e,t=P.emptyObject){let i=this._commands.get(e);return i?i.mnemonic.call(void 0,t):-1}icon(e,t=P.emptyObject){var i;return(i=this._commands.get(e))===null||i===void 0?void 0:i.icon.call(void 0,t)}iconClass(e,t=P.emptyObject){let i=this._commands.get(e);return i?i.iconClass.call(void 0,t):""}iconLabel(e,t=P.emptyObject){let i=this._commands.get(e);return i?i.iconLabel.call(void 0,t):""}caption(e,t=P.emptyObject){let i=this._commands.get(e);return i?i.caption.call(void 0,t):""}usage(e,t=P.emptyObject){let i=this._commands.get(e);return i?i.usage.call(void 0,t):""}className(e,t=P.emptyObject){let i=this._commands.get(e);return i?i.className.call(void 0,t):""}dataset(e,t=P.emptyObject){let i=this._commands.get(e);return i?i.dataset.call(void 0,t):{}}isEnabled(e,t=P.emptyObject){let i=this._commands.get(e);return i?i.isEnabled.call(void 0,t):!1}isToggled(e,t=P.emptyObject){let i=this._commands.get(e);return i?i.isToggled.call(void 0,t):!1}isToggleable(e,t=P.emptyObject){let i=this._commands.get(e);return i?i.isToggleable:!1}isVisible(e,t=P.emptyObject){let i=this._commands.get(e);return i?i.isVisible.call(void 0,t):!1}execute(e,t=P.emptyObject){let i=this._commands.get(e);if(!i)return Promise.reject(new Error(`Command '${e}' not registered.`));let s;try{s=i.execute.call(void 0,t)}catch(l){s=Promise.reject(l)}let r=Promise.resolve(s);return this._commandExecuted.emit({id:e,args:t,result:r}),r}addKeyBinding(e){let t=se.createKeyBinding(e);return this._keyBindings.push(t),this._keyBindingChanged.emit({binding:t,type:"added"}),new mt(()=>{E.removeFirstOf(this._keyBindings,t),this._keyBindingChanged.emit({binding:t,type:"removed"})})}processKeydownEvent(e){if(e.defaultPrevented||this._replaying)return;const t=me.keystrokeForKeydownEvent(e);if(!t){this._replayKeydownEvents(),this._clearPendingState();return}if(me.isModifierKeyPressed(e)){let{exact:l}=se.matchKeyBinding(this._keyBindings,[t],e);l?(e.preventDefault(),e.stopPropagation(),this._startModifierTimer(l)):this._clearModifierTimer();return}this._keystrokes.push(t);const{exact:i,partial:s}=se.matchKeyBinding(this._keyBindings,this._keystrokes,e),r=s.length!==0;if(!i&&!r){this._replayKeydownEvents(),this._clearPendingState();return}if((i?.preventDefault||s.some(l=>l.preventDefault))&&(e.preventDefault(),e.stopPropagation()),this._keydownEvents.push(e),i&&!r){this._executeKeyBinding(i),this._clearPendingState();return}i&&(this._exactKeyMatch=i),this._startTimer()}holdKeyBindingExecution(e,t){this._holdKeyBindingPromises.set(e,t)}processKeyupEvent(e){this._clearModifierTimer()}_startModifierTimer(e){this._clearModifierTimer(),this._timerModifierID=window.setTimeout(()=>{this._executeKeyBinding(e)},se.modifierkeyTimeOut)}_clearModifierTimer(){this._timerModifierID!==0&&(clearTimeout(this._timerModifierID),this._timerModifierID=0)}_startTimer(){this._clearTimer(),this._timerID=window.setTimeout(()=>{this._onPendingTimeout()},se.CHORD_TIMEOUT)}_clearTimer(){this._timerID!==0&&(clearTimeout(this._timerID),this._timerID=0)}_replayKeydownEvents(){this._keydownEvents.length!==0&&(this._replaying=!0,this._keydownEvents.forEach(se.replayKeyEvent),this._replaying=!1)}async _executeKeyBinding(e){if(this._holdKeyBindingPromises.size!==0){const r=[...this._keydownEvents],l=(await Promise.race([Promise.all(r.map(async o=>{var a;return(a=this._holdKeyBindingPromises.get(o))!==null&&a!==void 0?a:Promise.resolve(!0)})),new Promise(o=>{setTimeout(()=>o([!1]),se.KEYBINDING_HOLD_TIMEOUT)})])).every(Boolean);if(this._holdKeyBindingPromises.clear(),!l)return}let{command:t,args:i}=e,s={_luminoEvent:{type:"keybinding",keys:e.keys},...i};if(!this.hasCommand(t)||!this.isEnabled(t,s)){let r=this.hasCommand(t)?"enabled":"registered",o=`Cannot execute key binding '${e.keys.join(", ")}':`,a=`command '${t}' is not ${r}.`;console.warn(`${o} ${a}`);return}await this.execute(t,s)}_clearPendingState(){this._clearTimer(),this._clearModifierTimer(),this._exactKeyMatch=null,this._keystrokes.length=0,this._keydownEvents.length=0}_onPendingTimeout(){this._timerID=0,this._exactKeyMatch?this._executeKeyBinding(this._exactKeyMatch):this._replayKeydownEvents(),this._clearPendingState()}}(function(n){function e(o){let a="",c=!1,h=!1,m=!1,f=!1;for(let d of o.split(/\s+/))d==="Accel"?Y.IS_MAC?h=!0:m=!0:d==="Alt"?c=!0:d==="Cmd"?h=!0:d==="Ctrl"?m=!0:d==="Shift"?f=!0:d.length>0&&(a=d);return{cmd:h,ctrl:m,alt:c,shift:f,key:a}}n.parseKeystroke=e;function t(o){let a="",c=e(o);return c.ctrl&&(a+="Ctrl "),c.alt&&(a+="Alt "),c.shift&&(a+="Shift "),c.cmd&&Y.IS_MAC&&(a+="Cmd "),c.key?a+c.key:a.trim()}n.normalizeKeystroke=t;function i(o){let a;return Y.IS_WIN?a=o.winKeys||o.keys:Y.IS_MAC?a=o.macKeys||o.keys:a=o.linuxKeys||o.keys,a.map(t)}n.normalizeKeys=i;function s(o){return typeof o=="string"?a(o):o.map(a).join(", ");function a(c){let h=[],m=Y.IS_MAC?" ":"+",f=e(c);return f.ctrl&&h.push("Ctrl"),f.alt&&h.push("Alt"),f.shift&&h.push("Shift"),Y.IS_MAC&&f.cmd&&h.push("Cmd"),h.push(f.key),h.map(se.formatKey).join(m)}}n.formatKeystroke=s;function r(o){let a=Ue(),c=a.keyForKeydownEvent(o);return a.isModifierKey(c)}n.isModifierKeyPressed=r;function l(o){let a=Ue(),c=a.keyForKeydownEvent(o),h=[];return o.ctrlKey&&h.push("Ctrl"),o.altKey&&h.push("Alt"),o.shiftKey&&h.push("Shift"),o.metaKey&&Y.IS_MAC&&h.push("Cmd"),a.isModifierKey(c)||h.push(c),h.join(" ")}n.keystrokeForKeydownEvent=l})(me||(me={}));var se;(function(n){n.CHORD_TIMEOUT=1e3,n.KEYBINDING_HOLD_TIMEOUT=1e3,n.modifierkeyTimeOut=500;function e(y){return{execute:y.execute,describedBy:u(typeof y.describedBy=="function"?y.describedBy:{args:null,...y.describedBy},()=>({args:null})),label:u(y.label,a),mnemonic:u(y.mnemonic,c),icon:u(y.icon,d),iconClass:u(y.iconClass,a),iconLabel:u(y.iconLabel,a),caption:u(y.caption,a),usage:u(y.usage,a),className:u(y.className,a),dataset:u(y.dataset,f),isEnabled:y.isEnabled||h,isToggled:y.isToggled||m,isToggleable:y.isToggleable||!!y.isToggled,isVisible:y.isVisible||h}}n.createCommand=e;function t(y){var x;return{keys:me.normalizeKeys(y),selector:p(y),command:y.command,args:y.args||P.emptyObject,preventDefault:(x=y.preventDefault)!==null&&x!==void 0?x:!0}}n.createKeyBinding=t;function i(y,x,S){let I=null,w=[],v=1/0,_=0;for(let b=0,k=y.length;b<k;++b){let A=y[b],D=g(A.keys,x);if(D===0)continue;if(D===2){C(A.selector,S)!==-1&&w.push(A);continue}let L=C(A.selector,S);if(L===-1||L>v)continue;let W=ue.calculateSpecificity(A.selector);(!I||L<v||W>=_)&&(I=A,v=L,_=W)}return{exact:I,partial:w}}n.matchKeyBinding=i;function s(y){y.target.dispatchEvent(M(y))}n.replayKeyEvent=s;function r(y){return Y.IS_MAC?l.hasOwnProperty(y)?l[y]:y:o.hasOwnProperty(y)?o[y]:y}n.formatKey=r;const l={Backspace:"⌫",Tab:"⇥",Enter:"⏎",Shift:"⇧",Ctrl:"⌃",Alt:"⌥",Escape:"⎋",PageUp:"⇞",PageDown:"⇟",End:"↘",Home:"↖",ArrowLeft:"←",ArrowUp:"↑",ArrowRight:"→",ArrowDown:"↓",Delete:"⌦",Cmd:"⌘"},o={Escape:"Esc",PageUp:"Page Up",PageDown:"Page Down",ArrowLeft:"Left",ArrowUp:"Up",ArrowRight:"Right",ArrowDown:"Down",Delete:"Del"},a=()=>"",c=()=>-1,h=()=>!0,m=()=>!1,f=()=>({}),d=()=>{};function u(y,x){return y===void 0?x:typeof y=="function"?y:()=>y}function p(y){if(y.selector.indexOf(",")!==-1)throw new Error(`Selector cannot contain commas: ${y.selector}`);if(!ue.isValid(y.selector))throw new Error(`Invalid selector: ${y.selector}`);return y.selector}function g(y,x){if(y.length<x.length)return 0;for(let S=0,I=x.length;S<I;++S)if(y[S]!==x[S])return 0;return y.length>x.length?2:1}function C(y,x){let S=x.target,I=x.currentTarget;for(let w=0;S!==null;S=S.parentElement,++w){if(S.hasAttribute("data-lm-suppress-shortcuts"))return-1;if(ue.matches(S,y))return w;if(S===I)return-1}return-1}function M(y){let x=document.createEvent("Event"),S=y.bubbles||!0,I=y.cancelable||!0;return x.initEvent(y.type||"keydown",S,I),x.key=y.key||"",x.keyCode=y.keyCode||0,x.which=y.keyCode||0,x.ctrlKey=y.ctrlKey||!1,x.altKey=y.altKey||!1,x.shiftKey=y.shiftKey||!1,x.metaKey=y.metaKey||!1,x.view=y.view||window,x}})(se||(se={}));class $e{constructor(e){this.type="text",this.content=e}}class at{constructor(e,t,i,s){this.type="element",this.tag=e,this.attrs=t,this.children=i,this.renderer=s}}function R(n){let e={},t,i=[];for(let r=1,l=arguments.length;r<l;++r){let o=arguments[r];typeof o=="string"?i.push(new $e(o)):o instanceof $e||o instanceof at?i.push(o):o instanceof Array?s(i,o):(r===1||r===2)&&o&&typeof o=="object"&&("render"in o?t=o:e=o)}return new at(n,e,i,t);function s(r,l){for(let o of l)typeof o=="string"?r.push(new $e(o)):(o instanceof $e||o instanceof at)&&r.push(o)}}(function(n){n.a=n.bind(void 0,"a"),n.abbr=n.bind(void 0,"abbr"),n.address=n.bind(void 0,"address"),n.area=n.bind(void 0,"area"),n.article=n.bind(void 0,"article"),n.aside=n.bind(void 0,"aside"),n.audio=n.bind(void 0,"audio"),n.b=n.bind(void 0,"b"),n.bdi=n.bind(void 0,"bdi"),n.bdo=n.bind(void 0,"bdo"),n.blockquote=n.bind(void 0,"blockquote"),n.br=n.bind(void 0,"br"),n.button=n.bind(void 0,"button"),n.canvas=n.bind(void 0,"canvas"),n.caption=n.bind(void 0,"caption"),n.cite=n.bind(void 0,"cite"),n.code=n.bind(void 0,"code"),n.col=n.bind(void 0,"col"),n.colgroup=n.bind(void 0,"colgroup"),n.data=n.bind(void 0,"data"),n.datalist=n.bind(void 0,"datalist"),n.dd=n.bind(void 0,"dd"),n.del=n.bind(void 0,"del"),n.dfn=n.bind(void 0,"dfn"),n.div=n.bind(void 0,"div"),n.dl=n.bind(void 0,"dl"),n.dt=n.bind(void 0,"dt"),n.em=n.bind(void 0,"em"),n.embed=n.bind(void 0,"embed"),n.fieldset=n.bind(void 0,"fieldset"),n.figcaption=n.bind(void 0,"figcaption"),n.figure=n.bind(void 0,"figure"),n.footer=n.bind(void 0,"footer"),n.form=n.bind(void 0,"form"),n.h1=n.bind(void 0,"h1"),n.h2=n.bind(void 0,"h2"),n.h3=n.bind(void 0,"h3"),n.h4=n.bind(void 0,"h4"),n.h5=n.bind(void 0,"h5"),n.h6=n.bind(void 0,"h6"),n.header=n.bind(void 0,"header"),n.hr=n.bind(void 0,"hr"),n.i=n.bind(void 0,"i"),n.iframe=n.bind(void 0,"iframe"),n.img=n.bind(void 0,"img"),n.input=n.bind(void 0,"input"),n.ins=n.bind(void 0,"ins"),n.kbd=n.bind(void 0,"kbd"),n.label=n.bind(void 0,"label"),n.legend=n.bind(void 0,"legend"),n.li=n.bind(void 0,"li"),n.main=n.bind(void 0,"main"),n.map=n.bind(void 0,"map"),n.mark=n.bind(void 0,"mark"),n.meter=n.bind(void 0,"meter"),n.nav=n.bind(void 0,"nav"),n.noscript=n.bind(void 0,"noscript"),n.object=n.bind(void 0,"object"),n.ol=n.bind(void 0,"ol"),n.optgroup=n.bind(void 0,"optgroup"),n.option=n.bind(void 0,"option"),n.output=n.bind(void 0,"output"),n.p=n.bind(void 0,"p"),n.param=n.bind(void 0,"param"),n.pre=n.bind(void 0,"pre"),n.progress=n.bind(void 0,"progress"),n.q=n.bind(void 0,"q"),n.rp=n.bind(void 0,"rp"),n.rt=n.bind(void 0,"rt"),n.ruby=n.bind(void 0,"ruby"),n.s=n.bind(void 0,"s"),n.samp=n.bind(void 0,"samp"),n.section=n.bind(void 0,"section"),n.select=n.bind(void 0,"select"),n.small=n.bind(void 0,"small"),n.source=n.bind(void 0,"source"),n.span=n.bind(void 0,"span"),n.strong=n.bind(void 0,"strong"),n.sub=n.bind(void 0,"sub"),n.summary=n.bind(void 0,"summary"),n.sup=n.bind(void 0,"sup"),n.table=n.bind(void 0,"table"),n.tbody=n.bind(void 0,"tbody"),n.td=n.bind(void 0,"td"),n.textarea=n.bind(void 0,"textarea"),n.tfoot=n.bind(void 0,"tfoot"),n.th=n.bind(void 0,"th"),n.thead=n.bind(void 0,"thead"),n.time=n.bind(void 0,"time"),n.title=n.bind(void 0,"title"),n.tr=n.bind(void 0,"tr"),n.track=n.bind(void 0,"track"),n.u=n.bind(void 0,"u"),n.ul=n.bind(void 0,"ul"),n.var_=n.bind(void 0,"var"),n.video=n.bind(void 0,"video"),n.wbr=n.bind(void 0,"wbr")})(R||(R={}));var fe;(function(n){function e(i){return ye.createDOMNode(i)}n.realize=e;function t(i,s){let r=ye.hostMap.get(s)||[],l=ye.asContentArray(i);ye.hostMap.set(s,l),ye.updateContent(s,r,l)}n.render=t})(fe||(fe={}));var ye;(function(n){n.hostMap=new WeakMap;function e(d){return d?d instanceof Array?d:[d]:[]}n.asContentArray=e;function t(d){let u=arguments[1]||null;const p=arguments[2]||null;if(u)u.insertBefore(t(d),p);else{if(d.type==="text")return document.createTextNode(d.content);if(u=document.createElement(d.tag),l(u,d.attrs),d.renderer)return d.renderer.render(u,{attrs:d.attrs,children:d.children}),u;for(let g=0,C=d.children.length;g<C;++g)t(d.children[g],u)}return u}n.createDOMNode=t;function i(d,u,p){if(u===p)return;let g=f(d,u),C=u.slice(),M=d.firstChild,y=p.length;for(let x=0;x<y;++x){if(x>=C.length){t(p[x],d);continue}let S=C[x],I=p[x];if(S===I){M=M.nextSibling;continue}if(S.type==="text"&&I.type==="text"){M.textContent!==I.content&&(M.textContent=I.content),M=M.nextSibling;continue}if(S.type==="text"||I.type==="text"){E.insert(C,x,I),t(I,d,M);continue}if(!S.renderer!=!I.renderer){E.insert(C,x,I),t(I,d,M);continue}let w=I.attrs.key;if(w&&w in g){let _=g[w];_.vNode!==S&&(E.move(C,C.indexOf(_.vNode,x+1),x),d.insertBefore(_.element,M),S=_.vNode,M=_.element)}if(S===I){M=M.nextSibling;continue}let v=S.attrs.key;if(v&&v!==w){E.insert(C,x,I),t(I,d,M);continue}if(S.tag!==I.tag){E.insert(C,x,I),t(I,d,M);continue}o(M,S.attrs,I.attrs),I.renderer?I.renderer.render(M,{attrs:I.attrs,children:I.children}):i(M,S.children,I.children),M=M.nextSibling}s(d,C,y,!0)}n.updateContent=i;function s(d,u,p,g){for(let C=u.length-1;C>=p;--C){const M=u[C],y=g?d.lastChild:d.childNodes[C];M.type==="text"||(M.renderer&&M.renderer.unrender?M.renderer.unrender(y,{attrs:M.attrs,children:M.children}):s(y,M.children,0,!1)),g&&d.removeChild(y)}}const r={key:!0,className:!0,htmlFor:!0,dataset:!0,style:!0};function l(d,u){for(let p in u)p in r||(p.substr(0,2)==="on"?d[p]=u[p]:d.setAttribute(p,u[p]));u.className!==void 0&&d.setAttribute("class",u.className),u.htmlFor!==void 0&&d.setAttribute("for",u.htmlFor),u.dataset&&a(d,u.dataset),u.style&&h(d,u.style)}function o(d,u,p){if(u===p)return;let g;for(g in u)g in r||g in p||(g.substr(0,2)==="on"?d[g]=null:d.removeAttribute(g));for(g in p)g in r||u[g]===p[g]||(g.substr(0,2)==="on"?d[g]=p[g]:d.setAttribute(g,p[g]));u.className!==p.className&&(p.className!==void 0?d.setAttribute("class",p.className):d.removeAttribute("class")),u.htmlFor!==p.htmlFor&&(p.htmlFor!==void 0?d.setAttribute("for",p.htmlFor):d.removeAttribute("for")),u.dataset!==p.dataset&&c(d,u.dataset||{},p.dataset||{}),u.style!==p.style&&m(d,u.style||{},p.style||{})}function a(d,u){for(let p in u)d.setAttribute(`data-${p}`,u[p])}function c(d,u,p){for(let g in u)g in p||d.removeAttribute(`data-${g}`);for(let g in p)u[g]!==p[g]&&d.setAttribute(`data-${g}`,p[g])}function h(d,u){let p=d.style,g;for(g in u)p[g]=u[g]}function m(d,u,p){let g=d.style,C;for(C in u)C in p||(g[C]="");for(C in p)u[C]!==p[C]&&(g[C]=p[C])}function f(d,u){let p=d.firstChild,g=Object.create(null);for(let C of u)C.type==="element"&&C.attrs.key&&(g[C.attrs.key]={vNode:C,element:p}),p=p.nextSibling;return g}})(ye||(ye={}));class ge{constructor(){this.sizeHint=0,this.minSize=0,this.maxSize=1/0,this.stretch=1,this.size=0,this.done=!1}}var Z;(function(n){function e(r,l){let o=r.length;if(o===0)return l;let a=0,c=0,h=0,m=0,f=0;for(let p=0;p<o;++p){let g=r[p],C=g.minSize,M=g.maxSize,y=g.sizeHint;g.done=!1,g.size=Math.max(C,Math.min(y,M)),h+=g.size,a+=C,c+=M,g.stretch>0&&(m+=g.stretch,f++)}if(l===h)return 0;if(l<=a){for(let p=0;p<o;++p){let g=r[p];g.size=g.minSize}return l-a}if(l>=c){for(let p=0;p<o;++p){let g=r[p];g.size=g.maxSize}return l-c}let d=.01,u=o;if(l<h){let p=h-l;for(;f>0&&p>d;){let g=p,C=m;for(let M=0;M<o;++M){let y=r[M];if(y.done||y.stretch===0)continue;let x=y.stretch*g/C;y.size-x<=y.minSize?(p-=y.size-y.minSize,m-=y.stretch,y.size=y.minSize,y.done=!0,u--,f--):(p-=x,y.size-=x)}}for(;u>0&&p>d;){let g=p/u;for(let C=0;C<o;++C){let M=r[C];M.done||(M.size-g<=M.minSize?(p-=M.size-M.minSize,M.size=M.minSize,M.done=!0,u--):(p-=g,M.size-=g))}}}else{let p=l-h;for(;f>0&&p>d;){let g=p,C=m;for(let M=0;M<o;++M){let y=r[M];if(y.done||y.stretch===0)continue;let x=y.stretch*g/C;y.size+x>=y.maxSize?(p-=y.maxSize-y.size,m-=y.stretch,y.size=y.maxSize,y.done=!0,u--,f--):(p-=x,y.size+=x)}}for(;u>0&&p>d;){let g=p/u;for(let C=0;C<o;++C){let M=r[C];M.done||(M.size+g>=M.maxSize?(p-=M.maxSize-M.size,M.size=M.maxSize,M.done=!0,u--):(p-=g,M.size+=g))}}}return 0}n.calc=e;function t(r,l,o){r.length===0||o===0||(o>0?i(r,l,o):s(r,l,-o))}n.adjust=t;function i(r,l,o){let a=0;for(let f=0;f<=l;++f){let d=r[f];a+=d.maxSize-d.size}let c=0;for(let f=l+1,d=r.length;f<d;++f){let u=r[f];c+=u.size-u.minSize}o=Math.min(o,a,c);let h=o;for(let f=l;f>=0&&h>0;--f){let d=r[f],u=d.maxSize-d.size;u>=h?(d.sizeHint=d.size+h,h=0):(d.sizeHint=d.size+u,h-=u)}let m=o;for(let f=l+1,d=r.length;f<d&&m>0;++f){let u=r[f],p=u.size-u.minSize;p>=m?(u.sizeHint=u.size-m,m=0):(u.sizeHint=u.size-p,m-=p)}}function s(r,l,o){let a=0;for(let f=l+1,d=r.length;f<d;++f){let u=r[f];a+=u.maxSize-u.size}let c=0;for(let f=0;f<=l;++f){let d=r[f];c+=d.size-d.minSize}o=Math.min(o,a,c);let h=o;for(let f=l+1,d=r.length;f<d&&h>0;++f){let u=r[f],p=u.maxSize-u.size;p>=h?(u.sizeHint=u.size+h,h=0):(u.sizeHint=u.size+p,h-=p)}let m=o;for(let f=l;f>=0&&m>0;--f){let d=r[f],u=d.size-d.minSize;u>=m?(d.sizeHint=d.size-m,m=0):(d.sizeHint=d.size-u,m-=u)}}})(Z||(Z={}));class _t{constructor(e){this._label="",this._caption="",this._mnemonic=-1,this._icon=void 0,this._iconClass="",this._iconLabel="",this._className="",this._closable=!1,this._changed=new O(this),this._isDisposed=!1,this.owner=e.owner,e.label!==void 0&&(this._label=e.label),e.mnemonic!==void 0&&(this._mnemonic=e.mnemonic),e.icon!==void 0&&(this._icon=e.icon),e.iconClass!==void 0&&(this._iconClass=e.iconClass),e.iconLabel!==void 0&&(this._iconLabel=e.iconLabel),e.caption!==void 0&&(this._caption=e.caption),e.className!==void 0&&(this._className=e.className),e.closable!==void 0&&(this._closable=e.closable),this._dataset=e.dataset||{}}get changed(){return this._changed}get label(){return this._label}set label(e){this._label!==e&&(this._label=e,this._changed.emit(void 0))}get mnemonic(){return this._mnemonic}set mnemonic(e){this._mnemonic!==e&&(this._mnemonic=e,this._changed.emit(void 0))}get icon(){return this._icon}set icon(e){this._icon!==e&&(this._icon=e,this._changed.emit(void 0))}get iconClass(){return this._iconClass}set iconClass(e){this._iconClass!==e&&(this._iconClass=e,this._changed.emit(void 0))}get iconLabel(){return this._iconLabel}set iconLabel(e){this._iconLabel!==e&&(this._iconLabel=e,this._changed.emit(void 0))}get caption(){return this._caption}set caption(e){this._caption!==e&&(this._caption=e,this._changed.emit(void 0))}get className(){return this._className}set className(e){this._className!==e&&(this._className=e,this._changed.emit(void 0))}get closable(){return this._closable}set closable(e){this._closable!==e&&(this._closable=e,this._changed.emit(void 0))}get dataset(){return this._dataset}set dataset(e){this._dataset!==e&&(this._dataset=e,this._changed.emit(void 0))}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,O.clearData(this))}}class z{constructor(e={}){this._flags=0,this._layout=null,this._parent=null,this._disposed=new O(this),this._hiddenMode=z.HiddenMode.Display,this.node=je.createNode(e),this.addClass("lm-Widget")}dispose(){this.isDisposed||(this.setFlag(z.Flag.IsDisposed),this._disposed.emit(void 0),this.parent?this.parent=null:this.isAttached&&z.detach(this),this._layout&&(this._layout.dispose(),this._layout=null),this.title.dispose(),O.clearData(this),T.clearData(this),ie.clearData(this))}get disposed(){return this._disposed}get isDisposed(){return this.testFlag(z.Flag.IsDisposed)}get isAttached(){return this.testFlag(z.Flag.IsAttached)}get isHidden(){return this.testFlag(z.Flag.IsHidden)}get isVisible(){let e=this;do{if(e.isHidden||!e.isAttached)return!1;e=e.parent}while(e!=null);return!0}get title(){return je.titleProperty.get(this)}get id(){return this.node.id}set id(e){this.node.id=e}get dataset(){return this.node.dataset}get hiddenMode(){return this._hiddenMode}set hiddenMode(e){this._hiddenMode!==e&&(this.isHidden&&this._toggleHidden(!1),e==z.HiddenMode.Scale?this.node.style.willChange="transform":this.node.style.willChange="auto",this._hiddenMode=e,this.isHidden&&this._toggleHidden(!0))}get parent(){return this._parent}set parent(e){if(this._parent!==e){if(e&&this.contains(e))throw new Error("Invalid parent widget.");if(this._parent&&!this._parent.isDisposed){let t=new z.ChildMessage("child-removed",this);T.sendMessage(this._parent,t)}if(this._parent=e,this._parent&&!this._parent.isDisposed){let t=new z.ChildMessage("child-added",this);T.sendMessage(this._parent,t)}this.isDisposed||T.sendMessage(this,z.Msg.ParentChanged)}}get layout(){return this._layout}set layout(e){if(this._layout!==e){if(this.testFlag(z.Flag.DisallowLayout))throw new Error("Cannot set widget layout.");if(this._layout)throw new Error("Cannot change widget layout.");if(e.parent)throw new Error("Cannot change layout parent.");this._layout=e,e.parent=this}}*children(){this._layout&&(yield*this._layout)}contains(e){for(let t=e;t;t=t._parent)if(t===this)return!0;return!1}hasClass(e){return this.node.classList.contains(e)}addClass(e){this.node.classList.add(e)}removeClass(e){this.node.classList.remove(e)}toggleClass(e,t){return t===!0?(this.node.classList.add(e),!0):t===!1?(this.node.classList.remove(e),!1):this.node.classList.toggle(e)}update(){T.postMessage(this,z.Msg.UpdateRequest)}fit(){T.postMessage(this,z.Msg.FitRequest)}activate(){T.postMessage(this,z.Msg.ActivateRequest)}close(){T.sendMessage(this,z.Msg.CloseRequest)}show(){if(this.testFlag(z.Flag.IsHidden)&&(this.isAttached&&(!this.parent||this.parent.isVisible)&&T.sendMessage(this,z.Msg.BeforeShow),this.clearFlag(z.Flag.IsHidden),this._toggleHidden(!1),this.isAttached&&(!this.parent||this.parent.isVisible)&&T.sendMessage(this,z.Msg.AfterShow),this.parent)){let e=new z.ChildMessage("child-shown",this);T.sendMessage(this.parent,e)}}hide(){if(!this.testFlag(z.Flag.IsHidden)&&(this.isAttached&&(!this.parent||this.parent.isVisible)&&T.sendMessage(this,z.Msg.BeforeHide),this.setFlag(z.Flag.IsHidden),this._toggleHidden(!0),this.isAttached&&(!this.parent||this.parent.isVisible)&&T.sendMessage(this,z.Msg.AfterHide),this.parent)){let e=new z.ChildMessage("child-hidden",this);T.sendMessage(this.parent,e)}}setHidden(e){e?this.hide():this.show()}testFlag(e){return(this._flags&e)!==0}setFlag(e){this._flags|=e}clearFlag(e){this._flags&=~e}processMessage(e){switch(e.type){case"resize":this.notifyLayout(e),this.onResize(e);break;case"update-request":this.notifyLayout(e),this.onUpdateRequest(e);break;case"fit-request":this.notifyLayout(e),this.onFitRequest(e);break;case"before-show":this.notifyLayout(e),this.onBeforeShow(e);break;case"after-show":this.setFlag(z.Flag.IsVisible),this.notifyLayout(e),this.onAfterShow(e);break;case"before-hide":this.notifyLayout(e),this.onBeforeHide(e);break;case"after-hide":this.clearFlag(z.Flag.IsVisible),this.notifyLayout(e),this.onAfterHide(e);break;case"before-attach":this.notifyLayout(e),this.onBeforeAttach(e);break;case"after-attach":!this.isHidden&&(!this.parent||this.parent.isVisible)&&this.setFlag(z.Flag.IsVisible),this.setFlag(z.Flag.IsAttached),this.notifyLayout(e),this.onAfterAttach(e);break;case"before-detach":this.notifyLayout(e),this.onBeforeDetach(e);break;case"after-detach":this.clearFlag(z.Flag.IsVisible),this.clearFlag(z.Flag.IsAttached),this.notifyLayout(e),this.onAfterDetach(e);break;case"activate-request":this.notifyLayout(e),this.onActivateRequest(e);break;case"close-request":this.notifyLayout(e),this.onCloseRequest(e);break;case"child-added":this.notifyLayout(e),this.onChildAdded(e);break;case"child-removed":this.notifyLayout(e),this.onChildRemoved(e);break;default:this.notifyLayout(e);break}}notifyLayout(e){this._layout&&this._layout.processParentMessage(e)}onCloseRequest(e){this.parent?this.parent=null:this.isAttached&&z.detach(this)}onResize(e){}onUpdateRequest(e){}onFitRequest(e){}onActivateRequest(e){}onBeforeShow(e){}onAfterShow(e){}onBeforeHide(e){}onAfterHide(e){}onBeforeAttach(e){}onAfterAttach(e){}onBeforeDetach(e){}onAfterDetach(e){}onChildAdded(e){}onChildRemoved(e){}_toggleHidden(e){if(e)switch(this._hiddenMode){case z.HiddenMode.Display:this.addClass("lm-mod-hidden");break;case z.HiddenMode.Scale:this.node.style.transform="scale(0)",this.node.setAttribute("aria-hidden","true");break;case z.HiddenMode.ContentVisibility:this.node.style.contentVisibility="hidden",this.node.style.zIndex="-1";break}else switch(this._hiddenMode){case z.HiddenMode.Display:this.removeClass("lm-mod-hidden");break;case z.HiddenMode.Scale:this.node.style.transform="",this.node.removeAttribute("aria-hidden");break;case z.HiddenMode.ContentVisibility:this.node.style.contentVisibility="",this.node.style.zIndex="";break}}}(function(n){(function(r){r[r.Display=0]="Display",r[r.Scale=1]="Scale",r[r.ContentVisibility=2]="ContentVisibility"})(n.HiddenMode||(n.HiddenMode={})),function(r){r[r.IsDisposed=1]="IsDisposed",r[r.IsAttached=2]="IsAttached",r[r.IsHidden=4]="IsHidden",r[r.IsVisible=8]="IsVisible",r[r.DisallowLayout=16]="DisallowLayout"}(n.Flag||(n.Flag={})),function(r){r.BeforeShow=new J("before-show"),r.AfterShow=new J("after-show"),r.BeforeHide=new J("before-hide"),r.AfterHide=new J("after-hide"),r.BeforeAttach=new J("before-attach"),r.AfterAttach=new J("after-attach"),r.BeforeDetach=new J("before-detach"),r.AfterDetach=new J("after-detach"),r.ParentChanged=new J("parent-changed"),r.UpdateRequest=new Ne("update-request"),r.FitRequest=new Ne("fit-request"),r.ActivateRequest=new Ne("activate-request"),r.CloseRequest=new Ne("close-request")}(n.Msg||(n.Msg={}));class e extends J{constructor(l,o){super(l),this.child=o}}n.ChildMessage=e;class t extends J{constructor(l,o){super("resize"),this.width=l,this.height=o}}n.ResizeMessage=t,function(r){r.UnknownSize=new r(-1,-1)}(t=n.ResizeMessage||(n.ResizeMessage={}));function i(r,l,o=null){if(r.parent)throw new Error("Cannot attach a child widget.");if(r.isAttached||r.node.isConnected)throw new Error("Widget is already attached.");if(!l.isConnected)throw new Error("Host is not attached.");T.sendMessage(r,n.Msg.BeforeAttach),l.insertBefore(r.node,o),T.sendMessage(r,n.Msg.AfterAttach)}n.attach=i;function s(r){if(r.parent)throw new Error("Cannot detach a child widget.");if(!r.isAttached||!r.node.isConnected)throw new Error("Widget is not attached.");T.sendMessage(r,n.Msg.BeforeDetach),r.node.parentNode.removeChild(r.node),T.sendMessage(r,n.Msg.AfterDetach)}n.detach=s})(z||(z={}));var je;(function(n){n.titleProperty=new ie({name:"title",create:t=>new _t({owner:t})});function e(t){return t.node||document.createElement(t.tag||"div")}n.createNode=e})(je||(je={}));class Me{constructor(e={}){this._disposed=!1,this._parent=null,this._fitPolicy=e.fitPolicy||"set-min-size"}dispose(){this._parent=null,this._disposed=!0,O.clearData(this),ie.clearData(this)}get isDisposed(){return this._disposed}get parent(){return this._parent}set parent(e){if(this._parent!==e){if(this._parent)throw new Error("Cannot change parent widget.");if(e.layout!==this)throw new Error("Invalid parent widget.");this._parent=e,this.init()}}get fitPolicy(){return this._fitPolicy}set fitPolicy(e){if(this._fitPolicy!==e&&(this._fitPolicy=e,this._parent)){let t=this._parent.node.style;t.minWidth="",t.minHeight="",t.maxWidth="",t.maxHeight="",this._parent.fit()}}processParentMessage(e){switch(e.type){case"resize":this.onResize(e);break;case"update-request":this.onUpdateRequest(e);break;case"fit-request":this.onFitRequest(e);break;case"before-show":this.onBeforeShow(e);break;case"after-show":this.onAfterShow(e);break;case"before-hide":this.onBeforeHide(e);break;case"after-hide":this.onAfterHide(e);break;case"before-attach":this.onBeforeAttach(e);break;case"after-attach":this.onAfterAttach(e);break;case"before-detach":this.onBeforeDetach(e);break;case"after-detach":this.onAfterDetach(e);break;case"child-removed":this.onChildRemoved(e);break;case"child-shown":this.onChildShown(e);break;case"child-hidden":this.onChildHidden(e);break}}init(){for(const e of this)e.parent=this.parent}onResize(e){for(const t of this)T.sendMessage(t,z.ResizeMessage.UnknownSize)}onUpdateRequest(e){for(const t of this)T.sendMessage(t,z.ResizeMessage.UnknownSize)}onBeforeAttach(e){for(const t of this)T.sendMessage(t,e)}onAfterAttach(e){for(const t of this)T.sendMessage(t,e)}onBeforeDetach(e){for(const t of this)T.sendMessage(t,e)}onAfterDetach(e){for(const t of this)T.sendMessage(t,e)}onBeforeShow(e){for(const t of this)t.isHidden||T.sendMessage(t,e)}onAfterShow(e){for(const t of this)t.isHidden||T.sendMessage(t,e)}onBeforeHide(e){for(const t of this)t.isHidden||T.sendMessage(t,e)}onAfterHide(e){for(const t of this)t.isHidden||T.sendMessage(t,e)}onChildRemoved(e){this.removeWidget(e.child)}onFitRequest(e){}onChildShown(e){}onChildHidden(e){}}(function(n){function e(r){return ke.horizontalAlignmentProperty.get(r)}n.getHorizontalAlignment=e;function t(r,l){ke.horizontalAlignmentProperty.set(r,l)}n.setHorizontalAlignment=t;function i(r){return ke.verticalAlignmentProperty.get(r)}n.getVerticalAlignment=i;function s(r,l){ke.verticalAlignmentProperty.set(r,l)}n.setVerticalAlignment=s})(Me||(Me={}));class qe{constructor(e){this._top=NaN,this._left=NaN,this._width=NaN,this._height=NaN,this._minWidth=0,this._minHeight=0,this._maxWidth=1/0,this._maxHeight=1/0,this._disposed=!1,this.widget=e,this.widget.node.style.position="absolute",this.widget.node.style.contain="strict"}dispose(){if(this._disposed)return;this._disposed=!0;let e=this.widget.node.style;e.position="",e.top="",e.left="",e.width="",e.height="",e.contain=""}get minWidth(){return this._minWidth}get minHeight(){return this._minHeight}get maxWidth(){return this._maxWidth}get maxHeight(){return this._maxHeight}get isDisposed(){return this._disposed}get isHidden(){return this.widget.isHidden}get isVisible(){return this.widget.isVisible}get isAttached(){return this.widget.isAttached}fit(){let e=H.sizeLimits(this.widget.node);this._minWidth=e.minWidth,this._minHeight=e.minHeight,this._maxWidth=e.maxWidth,this._maxHeight=e.maxHeight}update(e,t,i,s){let r=Math.max(this._minWidth,Math.min(i,this._maxWidth)),l=Math.max(this._minHeight,Math.min(s,this._maxHeight));if(r<i)switch(Me.getHorizontalAlignment(this.widget)){case"left":break;case"center":e+=(i-r)/2;break;case"right":e+=i-r;break;default:throw"unreachable"}if(l<s)switch(Me.getVerticalAlignment(this.widget)){case"top":break;case"center":t+=(s-l)/2;break;case"bottom":t+=s-l;break;default:throw"unreachable"}let o=!1,a=this.widget.node.style;if(this._top!==t&&(this._top=t,a.top=`${t}px`),this._left!==e&&(this._left=e,a.left=`${e}px`),this._width!==r&&(o=!0,this._width=r,a.width=`${r}px`),this._height!==l&&(o=!0,this._height=l,a.height=`${l}px`),o){let c=new z.ResizeMessage(r,l);T.sendMessage(this.widget,c)}}}var ke;(function(n){n.horizontalAlignmentProperty=new ie({name:"horizontalAlignment",create:()=>"center",changed:e}),n.verticalAlignmentProperty=new ie({name:"verticalAlignment",create:()=>"top",changed:e});function e(t){t.parent&&t.parent.layout&&t.parent.update()}})(ke||(ke={}));class Je extends Me{constructor(){super(...arguments),this._widgets=[]}dispose(){for(;this._widgets.length>0;)this._widgets.pop().dispose();super.dispose()}get widgets(){return this._widgets}*[Symbol.iterator](){yield*this._widgets}addWidget(e){this.insertWidget(this._widgets.length,e)}insertWidget(e,t){t.parent=this.parent;let i=this._widgets.indexOf(t),s=Math.max(0,Math.min(e,this._widgets.length));if(i===-1){E.insert(this._widgets,s,t),this.parent&&this.attachWidget(s,t);return}s===this._widgets.length&&s--,i!==s&&(E.move(this._widgets,i,s),this.parent&&this.moveWidget(i,s,t))}removeWidget(e){this.removeWidgetAt(this._widgets.indexOf(e))}removeWidgetAt(e){let t=E.removeAt(this._widgets,e);t&&this.parent&&this.detachWidget(e,t)}init(){super.init();let e=0;for(const t of this)this.attachWidget(e++,t)}attachWidget(e,t){let i=this.parent.node.children[e];this.parent.isAttached&&T.sendMessage(t,z.Msg.BeforeAttach),this.parent.node.insertBefore(t.node,i),this.parent.isAttached&&T.sendMessage(t,z.Msg.AfterAttach)}moveWidget(e,t,i){this.parent.isAttached&&T.sendMessage(i,z.Msg.BeforeDetach),this.parent.node.removeChild(i.node),this.parent.isAttached&&T.sendMessage(i,z.Msg.AfterDetach);let s=this.parent.node.children[t];this.parent.isAttached&&T.sendMessage(i,z.Msg.BeforeAttach),this.parent.node.insertBefore(i.node,s),this.parent.isAttached&&T.sendMessage(i,z.Msg.AfterAttach)}detachWidget(e,t){this.parent.isAttached&&T.sendMessage(t,z.Msg.BeforeDetach),this.parent.node.removeChild(t.node),this.parent.isAttached&&T.sendMessage(t,z.Msg.AfterDetach)}}var Oe;(function(n){function e(t){return Math.max(0,Math.floor(t))}n.clampDimension=e})(Oe||(Oe={}));var We=Oe;class pe extends Je{constructor(e){super(),this.widgetOffset=0,this._fixed=0,this._spacing=4,this._dirty=!1,this._hasNormedSizes=!1,this._sizers=[],this._items=[],this._handles=[],this._box=null,this._alignment="start",this._orientation="horizontal",this.renderer=e.renderer,e.orientation!==void 0&&(this._orientation=e.orientation),e.alignment!==void 0&&(this._alignment=e.alignment),e.spacing!==void 0&&(this._spacing=Oe.clampDimension(e.spacing))}dispose(){for(const e of this._items)e.dispose();this._box=null,this._items.length=0,this._sizers.length=0,this._handles.length=0,super.dispose()}get orientation(){return this._orientation}set orientation(e){this._orientation!==e&&(this._orientation=e,this.parent&&(this.parent.dataset.orientation=e,this.parent.fit()))}get alignment(){return this._alignment}set alignment(e){this._alignment!==e&&(this._alignment=e,this.parent&&(this.parent.dataset.alignment=e,this.parent.update()))}get spacing(){return this._spacing}set spacing(e){e=Oe.clampDimension(e),this._spacing!==e&&(this._spacing=e,this.parent&&this.parent.fit())}get handles(){return this._handles}absoluteSizes(){return this._sizers.map(e=>e.size)}relativeSizes(){return ce.normalize(this._sizers.map(e=>e.size))}setRelativeSizes(e,t=!0){let i=this._sizers.length,s=e.slice(0,i);for(;s.length<i;)s.push(0);let r=ce.normalize(s);for(let l=0;l<i;++l){let o=this._sizers[l];o.sizeHint=r[l],o.size=r[l]}this._hasNormedSizes=!0,t&&this.parent&&this.parent.update()}moveHandle(e,t){let i=this._handles[e];if(!i||i.classList.contains("lm-mod-hidden"))return;let s;if(this._orientation==="horizontal"?s=t-i.offsetLeft:s=t-i.offsetTop,s!==0){for(let r of this._sizers)r.size>0&&(r.sizeHint=r.size);Z.adjust(this._sizers,e,s),this.parent&&this.parent.update()}}init(){this.parent.dataset.orientation=this.orientation,this.parent.dataset.alignment=this.alignment,super.init()}attachWidget(e,t){let i=new qe(t),s=ce.createHandle(this.renderer),r=ce.averageSize(this._sizers),l=ce.createSizer(r);E.insert(this._items,e,i),E.insert(this._sizers,e,l),E.insert(this._handles,e,s),this.parent.isAttached&&T.sendMessage(t,z.Msg.BeforeAttach),this.parent.node.appendChild(t.node),this.parent.node.appendChild(s),this.parent.isAttached&&T.sendMessage(t,z.Msg.AfterAttach),this.parent.fit()}moveWidget(e,t,i){E.move(this._items,e,t),E.move(this._sizers,e,t),E.move(this._handles,e,t),this.parent.fit()}detachWidget(e,t){let i=E.removeAt(this._items,e),s=E.removeAt(this._handles,e);E.removeAt(this._sizers,e),this.parent.isAttached&&T.sendMessage(t,z.Msg.BeforeDetach),this.parent.node.removeChild(t.node),this.parent.node.removeChild(s),this.parent.isAttached&&T.sendMessage(t,z.Msg.AfterDetach),i.dispose(),this.parent.fit()}onBeforeShow(e){super.onBeforeShow(e),this.parent.update()}onBeforeAttach(e){super.onBeforeAttach(e),this.parent.fit()}onChildShown(e){this.parent.fit()}onChildHidden(e){this.parent.fit()}onResize(e){this.parent.isVisible&&this._update(e.width,e.height)}onUpdateRequest(e){this.parent.isVisible&&this._update(-1,-1)}onFitRequest(e){this.parent.isAttached&&this._fit()}updateItemPosition(e,t,i,s,r,l,o){const a=this._items[e];if(a.isHidden)return;let c=this._handles[e].style;t?(i+=this.widgetOffset,a.update(i,s,o,r),i+=o,c.top=`${s}px`,c.left=`${i}px`,c.width=`${this._spacing}px`,c.height=`${r}px`):(s+=this.widgetOffset,a.update(i,s,l,o),s+=o,c.top=`${s}px`,c.left=`${i}px`,c.width=`${l}px`,c.height=`${this._spacing}px`)}_fit(){let e=0,t=-1;for(let a=0,c=this._items.length;a<c;++a)this._items[a].isHidden?this._handles[a].classList.add("lm-mod-hidden"):(this._handles[a].classList.remove("lm-mod-hidden"),t=a,e++);t!==-1&&this._handles[t].classList.add("lm-mod-hidden"),this._fixed=this._spacing*Math.max(0,e-1)+this.widgetOffset*this._items.length;let i=this._orientation==="horizontal",s=i?this._fixed:0,r=i?0:this._fixed;for(let a=0,c=this._items.length;a<c;++a){let h=this._items[a],m=this._sizers[a];if(m.size>0&&(m.sizeHint=m.size),h.isHidden){m.minSize=0,m.maxSize=0;continue}h.fit(),m.stretch=pe.getStretch(h.widget),i?(m.minSize=h.minWidth,m.maxSize=h.maxWidth,s+=h.minWidth,r=Math.max(r,h.minHeight)):(m.minSize=h.minHeight,m.maxSize=h.maxHeight,r+=h.minHeight,s=Math.max(s,h.minWidth))}let l=this._box=H.boxSizing(this.parent.node);s+=l.horizontalSum,r+=l.verticalSum;let o=this.parent.node.style;o.minWidth=`${s}px`,o.minHeight=`${r}px`,this._dirty=!0,this.parent.parent&&T.sendMessage(this.parent.parent,z.Msg.FitRequest),this._dirty&&T.sendMessage(this.parent,z.Msg.UpdateRequest)}_update(e,t){this._dirty=!1;let i=0;for(let m=0,f=this._items.length;m<f;++m)i+=+!this._items[m].isHidden;if(i===0&&this.widgetOffset===0)return;e<0&&(e=this.parent.node.offsetWidth),t<0&&(t=this.parent.node.offsetHeight),this._box||(this._box=H.boxSizing(this.parent.node));let s=this._box.paddingTop,r=this._box.paddingLeft,l=e-this._box.horizontalSum,o=t-this._box.verticalSum,a=0,c=0,h=this._orientation==="horizontal";if(i>0){let m;if(h?m=Math.max(0,l-this._fixed):m=Math.max(0,o-this._fixed),this._hasNormedSizes){for(let d of this._sizers)d.sizeHint*=m;this._hasNormedSizes=!1}let f=Z.calc(this._sizers,m);if(f>0)switch(this._alignment){case"start":break;case"center":a=0,c=f/2;break;case"end":a=0,c=f;break;case"justify":a=f/i,c=0;break;default:throw"unreachable"}}for(let m=0,f=this._items.length;m<f;++m){const u=this._items[m].isHidden?0:this._sizers[m].size+a;this.updateItemPosition(m,h,h?r+c:r,h?s:s+c,o,l,u);const p=this.widgetOffset+(this._handles[m].classList.contains("lm-mod-hidden")?0:this._spacing);h?r+=u+p:s+=u+p}}}(function(n){function e(i){return ce.stretchProperty.get(i)}n.getStretch=e;function t(i,s){ce.stretchProperty.set(i,s)}n.setStretch=t})(pe||(pe={}));var ce;(function(n){n.stretchProperty=new ie({name:"stretch",create:()=>0,coerce:(l,o)=>Math.max(0,Math.floor(o)),changed:r});function e(l){let o=new ge;return o.sizeHint=Math.floor(l),o}n.createSizer=e;function t(l){let o=l.createHandle();return o.style.position="absolute",o.style.contain="style",o}n.createHandle=t;function i(l){return l.reduce((o,a)=>o+a.size,0)/l.length||0}n.averageSize=i;function s(l){let o=l.length;if(o===0)return[];let a=l.reduce((c,h)=>c+Math.abs(h),0);return a===0?l.map(c=>1/o):l.map(c=>c/a)}n.normalize=s;function r(l){l.parent&&l.parent.layout instanceof pe&&l.parent.fit()}})(ce||(ce={}));class Vi extends pe{constructor(e){super({...e,orientation:e.orientation||"vertical"}),this._titles=[],this.titleSpace=e.titleSpace||22}get titleSpace(){return this.widgetOffset}set titleSpace(e){e=We.clampDimension(e),this.widgetOffset!==e&&(this.widgetOffset=e,this.parent&&this.parent.fit())}get titles(){return this._titles}dispose(){this.isDisposed||(this._titles.length=0,super.dispose())}updateTitle(e,t){const i=this._titles[e],s=i.classList.contains("lm-mod-expanded"),r=Ye.createTitle(this.renderer,t.title,s);this._titles[e]=r,this.parent.node.replaceChild(r,i)}insertWidget(e,t){t.id||(t.id=`id-${ut.uuid4()}`),super.insertWidget(e,t)}attachWidget(e,t){const i=Ye.createTitle(this.renderer,t.title);E.insert(this._titles,e,i),this.parent.node.appendChild(i),t.node.setAttribute("role","region"),t.node.setAttribute("aria-labelledby",i.id),super.attachWidget(e,t)}moveWidget(e,t,i){E.move(this._titles,e,t),super.moveWidget(e,t,i)}detachWidget(e,t){const i=E.removeAt(this._titles,e);this.parent.node.removeChild(i),super.detachWidget(e,t)}updateItemPosition(e,t,i,s,r,l,o){const a=this._titles[e].style;a.top=`${s}px`,a.left=`${i}px`,a.height=`${this.widgetOffset}px`,t?a.width=`${r}px`:a.width=`${l}px`,super.updateItemPosition(e,t,i,s,r,l,o)}}var Ye;(function(n){function e(t,i,s=!0){const r=t.createSectionTitle(i);return r.style.position="absolute",r.style.contain="strict",r.setAttribute("aria-label",`${i.label} Section`),r.setAttribute("aria-expanded",s?"true":"false"),r.setAttribute("aria-controls",i.owner.id),s&&r.classList.add("lm-mod-expanded"),r}n.createTitle=e})(Ye||(Ye={}));class Ft extends z{constructor(e={}){super(),this.addClass("lm-Panel"),this.layout=bt.createLayout(e)}get widgets(){return this.layout.widgets}addWidget(e){this.layout.addWidget(e)}insertWidget(e,t){this.layout.insertWidget(e,t)}}var bt;(function(n){function e(t){return t.layout||new Je}n.createLayout=e})(bt||(bt={}));class Fe extends Ft{constructor(e={}){super({layout:yt.createLayout(e)}),this._handleMoved=new O(this),this._pressData=null,this.addClass("lm-SplitPanel")}dispose(){this._releaseMouse(),super.dispose()}get orientation(){return this.layout.orientation}set orientation(e){this.layout.orientation=e}get alignment(){return this.layout.alignment}set alignment(e){this.layout.alignment=e}get spacing(){return this.layout.spacing}set spacing(e){this.layout.spacing=e}get renderer(){return this.layout.renderer}get handleMoved(){return this._handleMoved}get handles(){return this.layout.handles}relativeSizes(){return this.layout.relativeSizes()}setRelativeSizes(e,t=!0){this.layout.setRelativeSizes(e,t)}handleEvent(e){switch(e.type){case"pointerdown":this._evtPointerDown(e);break;case"pointermove":this._evtPointerMove(e);break;case"pointerup":this._evtPointerUp(e);break;case"keydown":this._evtKeyDown(e);break;case"contextmenu":e.preventDefault(),e.stopPropagation();break}}onBeforeAttach(e){this.node.addEventListener("pointerdown",this)}onAfterDetach(e){this.node.removeEventListener("pointerdown",this),this._releaseMouse()}onChildAdded(e){e.child.addClass("lm-SplitPanel-child"),this._releaseMouse()}onChildRemoved(e){e.child.removeClass("lm-SplitPanel-child"),this._releaseMouse()}_evtKeyDown(e){this._pressData&&(e.preventDefault(),e.stopPropagation()),e.keyCode===27&&this._releaseMouse()}_evtPointerDown(e){if(e.button!==0)return;let t=this.layout,i=E.findFirstIndex(t.handles,c=>c.contains(e.target));if(i===-1)return;e.preventDefault(),e.stopPropagation(),document.addEventListener("pointerup",this,!0),document.addEventListener("pointermove",this,!0),document.addEventListener("keydown",this,!0),document.addEventListener("contextmenu",this,!0);let s,r=t.handles[i],l=r.getBoundingClientRect();t.orientation==="horizontal"?s=e.clientX-l.left:s=e.clientY-l.top;let o=window.getComputedStyle(r),a=K.overrideCursor(o.cursor);this._pressData={index:i,delta:s,override:a}}_evtPointerMove(e){e.preventDefault(),e.stopPropagation();let t,i=this.layout,s=this.node.getBoundingClientRect();i.orientation==="horizontal"?t=e.clientX-s.left-this._pressData.delta:t=e.clientY-s.top-this._pressData.delta,i.moveHandle(this._pressData.index,t)}_evtPointerUp(e){e.button===0&&(e.preventDefault(),e.stopPropagation(),this._releaseMouse())}_releaseMouse(){this._pressData&&(this._pressData.override.dispose(),this._pressData=null,this._handleMoved.emit(),document.removeEventListener("keydown",this,!0),document.removeEventListener("pointerup",this,!0),document.removeEventListener("pointermove",this,!0),document.removeEventListener("contextmenu",this,!0))}}(function(n){class e{createHandle(){let r=document.createElement("div");return r.className="lm-SplitPanel-handle",r}}n.Renderer=e,n.defaultRenderer=new e;function t(s){return pe.getStretch(s)}n.getStretch=t;function i(s,r){pe.setStretch(s,r)}n.setStretch=i})(Fe||(Fe={}));var yt;(function(n){function e(t){return t.layout||new pe({renderer:t.renderer||Fe.defaultRenderer,orientation:t.orientation,alignment:t.alignment,spacing:t.spacing})}n.createLayout=e})(yt||(yt={}));class wt extends Fe{constructor(e={}){super({...e,layout:vt.createLayout(e)}),this._widgetSizesCache=new WeakMap,this._expansionToggled=new O(this),this.addClass("lm-AccordionPanel")}get renderer(){return this.layout.renderer}get titleSpace(){return this.layout.titleSpace}set titleSpace(e){this.layout.titleSpace=e}get titles(){return this.layout.titles}get expansionToggled(){return this._expansionToggled}addWidget(e){super.addWidget(e),e.title.changed.connect(this._onTitleChanged,this)}collapse(e){const t=this.layout.widgets[e];t&&!t.isHidden&&this._toggleExpansion(e)}expand(e){const t=this.layout.widgets[e];t&&t.isHidden&&this._toggleExpansion(e)}insertWidget(e,t){super.insertWidget(e,t),t.title.changed.connect(this._onTitleChanged,this)}handleEvent(e){switch(super.handleEvent(e),e.type){case"click":this._evtClick(e);break;case"keydown":this._eventKeyDown(e);break}}onBeforeAttach(e){this.node.addEventListener("click",this),this.node.addEventListener("keydown",this),super.onBeforeAttach(e)}onAfterDetach(e){super.onAfterDetach(e),this.node.removeEventListener("click",this),this.node.removeEventListener("keydown",this)}_onTitleChanged(e){const t=E.findFirstIndex(this.widgets,i=>i.contains(e.owner));t>=0&&(this.layout.updateTitle(t,e.owner),this.update())}_computeWidgetSize(e){const t=this.layout,i=t.widgets[e];if(!i)return;const s=i.isHidden,r=t.absoluteSizes(),l=(s?-1:1)*this.spacing,o=r.reduce((c,h)=>c+h);let a=[...r];if(s){const c=this._widgetSizesCache.get(i);if(!c)return;a[e]+=c;const h=a.map(m=>m-c>0).lastIndexOf(!0);h===-1?a.forEach((m,f)=>{f!==e&&(a[f]-=r[f]/o*(c-l))}):a[h]-=c-l}else{const c=r[e];this._widgetSizesCache.set(i,c),a[e]=0;const h=a.map(m=>m>0).lastIndexOf(!0);if(h===-1)return;a[h]=r[h]+c+l}return a.map(c=>c/(o+l))}_evtClick(e){const t=e.target;if(t){const i=E.findFirstIndex(this.titles,s=>s.contains(t));i>=0&&(e.preventDefault(),e.stopPropagation(),this._toggleExpansion(i))}}_eventKeyDown(e){if(e.defaultPrevented)return;const t=e.target;let i=!1;if(t){const s=E.findFirstIndex(this.titles,r=>r.contains(t));if(s>=0){const r=e.keyCode.toString();if(e.key.match(/Space|Enter/)||r.match(/13|32/))t.click(),i=!0;else if(this.orientation==="horizontal"?e.key.match(/ArrowLeft|ArrowRight/)||r.match(/37|39/):e.key.match(/ArrowUp|ArrowDown/)||r.match(/38|40/)){const l=e.key.match(/ArrowLeft|ArrowUp/)||r.match(/37|38/)?-1:1,o=this.titles.length,a=(s+o+l)%o;this.titles[a].focus(),i=!0}else e.key==="End"||r==="35"?(this.titles[this.titles.length-1].focus(),i=!0):(e.key==="Home"||r==="36")&&(this.titles[0].focus(),i=!0)}i&&e.preventDefault()}}_toggleExpansion(e){const t=this.titles[e],i=this.layout.widgets[e],s=this._computeWidgetSize(e);s&&this.setRelativeSizes(s,!1),i.isHidden?(t.classList.add("lm-mod-expanded"),t.setAttribute("aria-expanded","true"),i.show()):(t.classList.remove("lm-mod-expanded"),t.setAttribute("aria-expanded","false"),i.hide()),this._expansionToggled.emit(e)}}(function(n){class e extends Fe.Renderer{constructor(){super(),this.titleClassName="lm-AccordionPanel-title",this._titleID=0,this._titleKeys=new WeakMap,this._uuid=++e._nInstance}createCollapseIcon(i){return document.createElement("span")}createSectionTitle(i){const s=document.createElement("h3");s.setAttribute("tabindex","0"),s.id=this.createTitleKey(i),s.className=this.titleClassName;for(const o in i.dataset)s.dataset[o]=i.dataset[o];const r=s.appendChild(this.createCollapseIcon(i));r.className="lm-AccordionPanel-titleCollapser";const l=s.appendChild(document.createElement("span"));return l.className="lm-AccordionPanel-titleLabel",l.textContent=i.label,l.title=i.caption||i.label,s}createTitleKey(i){let s=this._titleKeys.get(i);return s===void 0&&(s=`title-key-${this._uuid}-${this._titleID++}`,this._titleKeys.set(i,s)),s}}e._nInstance=0,n.Renderer=e,n.defaultRenderer=new e})(wt||(wt={}));var vt;(function(n){function e(t){return t.layout||new Vi({renderer:t.renderer||wt.defaultRenderer,orientation:t.orientation,alignment:t.alignment,spacing:t.spacing,titleSpace:t.titleSpace})}n.createLayout=e})(vt||(vt={}));class re extends Je{constructor(e={}){super(),this._fixed=0,this._spacing=4,this._dirty=!1,this._sizers=[],this._items=[],this._box=null,this._alignment="start",this._direction="top-to-bottom",e.direction!==void 0&&(this._direction=e.direction),e.alignment!==void 0&&(this._alignment=e.alignment),e.spacing!==void 0&&(this._spacing=We.clampDimension(e.spacing))}dispose(){for(const e of this._items)e.dispose();this._box=null,this._items.length=0,this._sizers.length=0,super.dispose()}get direction(){return this._direction}set direction(e){this._direction!==e&&(this._direction=e,this.parent&&(this.parent.dataset.direction=e,this.parent.fit()))}get alignment(){return this._alignment}set alignment(e){this._alignment!==e&&(this._alignment=e,this.parent&&(this.parent.dataset.alignment=e,this.parent.update()))}get spacing(){return this._spacing}set spacing(e){e=We.clampDimension(e),this._spacing!==e&&(this._spacing=e,this.parent&&this.parent.fit())}init(){this.parent.dataset.direction=this.direction,this.parent.dataset.alignment=this.alignment,super.init()}attachWidget(e,t){E.insert(this._items,e,new qe(t)),E.insert(this._sizers,e,new ge),this.parent.isAttached&&T.sendMessage(t,z.Msg.BeforeAttach),this.parent.node.appendChild(t.node),this.parent.isAttached&&T.sendMessage(t,z.Msg.AfterAttach),this.parent.fit()}moveWidget(e,t,i){E.move(this._items,e,t),E.move(this._sizers,e,t),this.parent.update()}detachWidget(e,t){let i=E.removeAt(this._items,e);E.removeAt(this._sizers,e),this.parent.isAttached&&T.sendMessage(t,z.Msg.BeforeDetach),this.parent.node.removeChild(t.node),this.parent.isAttached&&T.sendMessage(t,z.Msg.AfterDetach),i.dispose(),this.parent.fit()}onBeforeShow(e){super.onBeforeShow(e),this.parent.update()}onBeforeAttach(e){super.onBeforeAttach(e),this.parent.fit()}onChildShown(e){this.parent.fit()}onChildHidden(e){this.parent.fit()}onResize(e){this.parent.isVisible&&this._update(e.width,e.height)}onUpdateRequest(e){this.parent.isVisible&&this._update(-1,-1)}onFitRequest(e){this.parent.isAttached&&this._fit()}_fit(){let e=0;for(let o=0,a=this._items.length;o<a;++o)e+=+!this._items[o].isHidden;this._fixed=this._spacing*Math.max(0,e-1);let t=ve.isHorizontal(this._direction),i=t?this._fixed:0,s=t?0:this._fixed;for(let o=0,a=this._items.length;o<a;++o){let c=this._items[o],h=this._sizers[o];if(c.isHidden){h.minSize=0,h.maxSize=0;continue}c.fit(),h.sizeHint=re.getSizeBasis(c.widget),h.stretch=re.getStretch(c.widget),t?(h.minSize=c.minWidth,h.maxSize=c.maxWidth,i+=c.minWidth,s=Math.max(s,c.minHeight)):(h.minSize=c.minHeight,h.maxSize=c.maxHeight,s+=c.minHeight,i=Math.max(i,c.minWidth))}let r=this._box=H.boxSizing(this.parent.node);i+=r.horizontalSum,s+=r.verticalSum;let l=this.parent.node.style;l.minWidth=`${i}px`,l.minHeight=`${s}px`,this._dirty=!0,this.parent.parent&&T.sendMessage(this.parent.parent,z.Msg.FitRequest),this._dirty&&T.sendMessage(this.parent,z.Msg.UpdateRequest)}_update(e,t){this._dirty=!1;let i=0;for(let m=0,f=this._items.length;m<f;++m)i+=+!this._items[m].isHidden;if(i===0)return;e<0&&(e=this.parent.node.offsetWidth),t<0&&(t=this.parent.node.offsetHeight),this._box||(this._box=H.boxSizing(this.parent.node));let s=this._box.paddingTop,r=this._box.paddingLeft,l=e-this._box.horizontalSum,o=t-this._box.verticalSum,a;switch(this._direction){case"left-to-right":a=Z.calc(this._sizers,Math.max(0,l-this._fixed));break;case"top-to-bottom":a=Z.calc(this._sizers,Math.max(0,o-this._fixed));break;case"right-to-left":a=Z.calc(this._sizers,Math.max(0,l-this._fixed)),r+=l;break;case"bottom-to-top":a=Z.calc(this._sizers,Math.max(0,o-this._fixed)),s+=o;break;default:throw"unreachable"}let c=0,h=0;if(a>0)switch(this._alignment){case"start":break;case"center":c=0,h=a/2;break;case"end":c=0,h=a;break;case"justify":c=a/i,h=0;break;default:throw"unreachable"}for(let m=0,f=this._items.length;m<f;++m){let d=this._items[m];if(d.isHidden)continue;let u=this._sizers[m].size;switch(this._direction){case"left-to-right":d.update(r+h,s,u+c,o),r+=u+c+this._spacing;break;case"top-to-bottom":d.update(r,s+h,l,u+c),s+=u+c+this._spacing;break;case"right-to-left":d.update(r-h-u-c,s,u+c,o),r-=u+c+this._spacing;break;case"bottom-to-top":d.update(r,s-h-u-c,l,u+c),s-=u+c+this._spacing;break;default:throw"unreachable"}}}}(function(n){function e(r){return ve.stretchProperty.get(r)}n.getStretch=e;function t(r,l){ve.stretchProperty.set(r,l)}n.setStretch=t;function i(r){return ve.sizeBasisProperty.get(r)}n.getSizeBasis=i;function s(r,l){ve.sizeBasisProperty.set(r,l)}n.setSizeBasis=s})(re||(re={}));var ve;(function(n){n.stretchProperty=new ie({name:"stretch",create:()=>0,coerce:(s,r)=>Math.max(0,Math.floor(r)),changed:i}),n.sizeBasisProperty=new ie({name:"sizeBasis",create:()=>0,coerce:(s,r)=>Math.max(0,Math.floor(r)),changed:i});function e(s){return s==="left-to-right"||s==="right-to-left"}n.isHorizontal=e;function t(s){return Math.max(0,Math.floor(s))}n.clampSpacing=t;function i(s){s.parent&&s.parent.layout instanceof re&&s.parent.fit()}})(ve||(ve={}));class Xe extends Ft{constructor(e={}){super({layout:xt.createLayout(e)}),this.addClass("lm-BoxPanel")}get direction(){return this.layout.direction}set direction(e){this.layout.direction=e}get alignment(){return this.layout.alignment}set alignment(e){this.layout.alignment=e}get spacing(){return this.layout.spacing}set spacing(e){this.layout.spacing=e}onChildAdded(e){e.child.addClass("lm-BoxPanel-child")}onChildRemoved(e){e.child.removeClass("lm-BoxPanel-child")}}(function(n){function e(r){return re.getStretch(r)}n.getStretch=e;function t(r,l){re.setStretch(r,l)}n.setStretch=t;function i(r){return re.getSizeBasis(r)}n.getSizeBasis=i;function s(r,l){re.setSizeBasis(r,l)}n.setSizeBasis=s})(Xe||(Xe={}));var xt;(function(n){function e(t){return t.layout||new re(t)}n.createLayout=e})(xt||(xt={}));class Ge extends z{constructor(e){super({node:he.createNode()}),this._activeIndex=-1,this._items=[],this._results=null,this.addClass("lm-CommandPalette"),this.setFlag(z.Flag.DisallowLayout),this.commands=e.commands,this.renderer=e.renderer||Ge.defaultRenderer,this.commands.commandChanged.connect(this._onGenericChange,this),this.commands.keyBindingChanged.connect(this._onGenericChange,this)}dispose(){this._items.length=0,this._results=null,super.dispose()}get searchNode(){return this.node.getElementsByClassName("lm-CommandPalette-search")[0]}get inputNode(){return this.node.getElementsByClassName("lm-CommandPalette-input")[0]}get contentNode(){return this.node.getElementsByClassName("lm-CommandPalette-content")[0]}get items(){return this._items}addItem(e){let t=he.createItem(this.commands,e);return this._items.push(t),this.refresh(),t}addItems(e){const t=e.map(i=>he.createItem(this.commands,i));return t.forEach(i=>this._items.push(i)),this.refresh(),t}removeItem(e){this.removeItemAt(this._items.indexOf(e))}removeItemAt(e){E.removeAt(this._items,e)&&this.refresh()}clearItems(){this._items.length!==0&&(this._items.length=0,this.refresh())}refresh(){if(this._results=null,this.inputNode.value!==""){let e=this.node.getElementsByClassName("lm-close-icon")[0];e.style.display="inherit"}else{let e=this.node.getElementsByClassName("lm-close-icon")[0];e.style.display="none"}this.update()}handleEvent(e){switch(e.type){case"click":this._evtClick(e);break;case"keydown":this._evtKeyDown(e);break;case"input":this.refresh();break;case"focus":case"blur":this._toggleFocused();break}}onBeforeAttach(e){this.node.addEventListener("click",this),this.node.addEventListener("keydown",this),this.node.addEventListener("input",this),this.node.addEventListener("focus",this,!0),this.node.addEventListener("blur",this,!0)}onAfterDetach(e){this.node.removeEventListener("click",this),this.node.removeEventListener("keydown",this),this.node.removeEventListener("input",this),this.node.removeEventListener("focus",this,!0),this.node.removeEventListener("blur",this,!0)}onAfterShow(e){this.update(),super.onAfterShow(e)}onActivateRequest(e){if(this.isAttached){let t=this.inputNode;t.focus(),t.select()}}onUpdateRequest(e){if(!this.isVisible){fe.render(null,this.contentNode);return}let t=this.inputNode.value,i=this.contentNode,s=this._results;if(s||(s=this._results=he.search(this._items,t),this._activeIndex=t?E.findFirstIndex(s,he.canActivate):-1),!t&&s.length===0){fe.render(null,i);return}if(t&&s.length===0){let a=this.renderer.renderEmptyMessage({query:t});fe.render(a,i);return}let r=this.renderer,l=this._activeIndex,o=new Array(s.length);for(let a=0,c=s.length;a<c;++a){let h=s[a];if(h.type==="header"){let m=h.indices,f=h.category;o[a]=r.renderHeader({category:f,indices:m})}else{let m=h.item,f=h.indices,d=a===l;o[a]=r.renderItem({item:m,indices:f,active:d})}}if(fe.render(o,i),l<0||l>=s.length)i.scrollTop=0;else{let a=i.children[l];H.scrollIntoViewIfNeeded(i,a)}}_evtClick(e){if(e.button!==0)return;if(e.target.classList.contains("lm-close-icon")){this.inputNode.value="",this.refresh();return}let t=E.findFirstIndex(this.contentNode.children,i=>i.contains(e.target));t!==-1&&(e.preventDefault(),e.stopPropagation(),this._execute(t))}_evtKeyDown(e){if(!(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey))switch(e.keyCode){case 13:e.preventDefault(),e.stopPropagation(),this._execute(this._activeIndex);break;case 38:e.preventDefault(),e.stopPropagation(),this._activatePreviousItem();break;case 40:e.preventDefault(),e.stopPropagation(),this._activateNextItem();break}}_activateNextItem(){if(!this._results||this._results.length===0)return;let e=this._activeIndex,t=this._results.length,i=e<t-1?e+1:0,s=i===0?t-1:i-1;this._activeIndex=E.findFirstIndex(this._results,he.canActivate,i,s),this.update()}_activatePreviousItem(){if(!this._results||this._results.length===0)return;let e=this._activeIndex,t=this._results.length,i=e<=0?t-1:e-1,s=i===t-1?0:i+1;this._activeIndex=E.findLastIndex(this._results,he.canActivate,i,s),this.update()}_execute(e){if(!this._results)return;let t=this._results[e];if(t){if(t.type==="header"){let i=this.inputNode;i.value=`${t.category.toLowerCase()} `,i.focus(),this.refresh();return}t.item.isEnabled&&(this.commands.execute(t.item.command,t.item.args),this.inputNode.value="",this.refresh())}}_toggleFocused(){let e=document.activeElement===this.inputNode;this.toggleClass("lm-mod-focused",e)}_onGenericChange(){this.refresh()}}(function(n){class e{renderHeader(i){let s=this.formatHeader(i);return R.li({className:"lm-CommandPalette-header"},s)}renderItem(i){let s=this.createItemClass(i),r=this.createItemDataset(i);return i.item.isToggleable?R.li({className:s,dataset:r,role:"menuitemcheckbox","aria-checked":`${i.item.isToggled}`},this.renderItemIcon(i),this.renderItemContent(i),this.renderItemShortcut(i)):R.li({className:s,dataset:r,role:"menuitem"},this.renderItemIcon(i),this.renderItemContent(i),this.renderItemShortcut(i))}renderEmptyMessage(i){let s=this.formatEmptyMessage(i);return R.li({className:"lm-CommandPalette-emptyMessage"},s)}renderItemIcon(i){let s=this.createIconClass(i);return R.div({className:s},i.item.icon,i.item.iconLabel)}renderItemContent(i){return R.div({className:"lm-CommandPalette-itemContent"},this.renderItemLabel(i),this.renderItemCaption(i))}renderItemLabel(i){let s=this.formatItemLabel(i);return R.div({className:"lm-CommandPalette-itemLabel"},s)}renderItemCaption(i){let s=this.formatItemCaption(i);return R.div({className:"lm-CommandPalette-itemCaption"},s)}renderItemShortcut(i){let s=this.formatItemShortcut(i);return R.div({className:"lm-CommandPalette-itemShortcut"},s)}createItemClass(i){let s="lm-CommandPalette-item";i.item.isEnabled||(s+=" lm-mod-disabled"),i.item.isToggled&&(s+=" lm-mod-toggled"),i.active&&(s+=" lm-mod-active");let r=i.item.className;return r&&(s+=` ${r}`),s}createItemDataset(i){return{...i.item.dataset,command:i.item.command}}createIconClass(i){let s="lm-CommandPalette-itemIcon",r=i.item.iconClass;return r?`${s} ${r}`:s}formatHeader(i){return!i.indices||i.indices.length===0?i.category:He.highlight(i.category,i.indices,R.mark)}formatEmptyMessage(i){return`No commands found that match '${i.query}'`}formatItemShortcut(i){let s=i.item.keyBinding;return s?me.formatKeystroke(s.keys):null}formatItemLabel(i){return!i.indices||i.indices.length===0?i.item.label:He.highlight(i.item.label,i.indices,R.mark)}formatItemCaption(i){return i.item.caption}}n.Renderer=e,n.defaultRenderer=new e})(Ge||(Ge={}));var he;(function(n){function e(){let f=document.createElement("div"),d=document.createElement("div"),u=document.createElement("div"),p=document.createElement("input"),g=document.createElement("ul"),C=document.createElement("button");return d.className="lm-CommandPalette-search",u.className="lm-CommandPalette-wrapper",p.className="lm-CommandPalette-input",C.className="lm-close-icon",g.className="lm-CommandPalette-content",g.setAttribute("role","menu"),p.spellcheck=!1,u.appendChild(p),u.appendChild(C),d.appendChild(u),f.appendChild(d),f.appendChild(g),f}n.createNode=e;function t(f,d){return new m(f,d)}n.createItem=t;function i(f,d){let u=o(f,d);return u.sort(c),h(u)}n.search=i;function s(f){return f.type==="item"&&f.item.isEnabled}n.canActivate=s;function r(f){return f.trim().replace(/\s+/g," ")}function l(f){return f.replace(/\s+/g,"").toLowerCase()}function o(f,d){d=l(d);let u=[];for(let p=0,g=f.length;p<g;++p){let C=f[p];if(!C.isVisible)continue;if(!d){u.push({matchType:3,categoryIndices:null,labelIndices:null,score:0,item:C});continue}let M=a(C,d);M&&(C.isEnabled||(M.score+=1e3),u.push(M))}return u}function a(f,d){let u=f.category.toLowerCase(),p=f.label.toLowerCase(),g=`${u} ${p}`,C=1/0,M=null,y=/\b\w/g;for(;;){let v=y.exec(g);if(!v)break;let _=He.matchSumOfDeltas(g,d,v.index);if(!_)break;_.score<=C&&(C=_.score,M=_.indices)}if(!M||C===1/0)return null;let x=u.length+1,S=E.lowerBound(M,x,(v,_)=>v-_),I=M.slice(0,S),w=M.slice(S);for(let v=0,_=w.length;v<_;++v)w[v]-=x;return I.length===0?{matchType:0,categoryIndices:null,labelIndices:w,score:C,item:f}:w.length===0?{matchType:1,categoryIndices:I,labelIndices:null,score:C,item:f}:{matchType:2,categoryIndices:I,labelIndices:w,score:C,item:f}}function c(f,d){let u=f.matchType-d.matchType;if(u!==0)return u;let p=f.score-d.score;if(p!==0)return p;let g=0,C=0;switch(f.matchType){case 0:g=f.labelIndices[0],C=d.labelIndices[0];break;case 1:case 2:g=f.categoryIndices[0],C=d.categoryIndices[0];break}if(g!==C)return g-C;let M=f.item.category.localeCompare(d.item.category);if(M!==0)return M;let y=f.item.rank,x=d.item.rank;return y!==x?y<x?-1:1:f.item.label.localeCompare(d.item.label)}function h(f){let d=[];for(let u=0,p=f.length;u<p;++u){let{item:g,categoryIndices:C,labelIndices:M}=f[u],y=g.category;(u===0||y!==f[u-1].item.category)&&d.push({type:"header",category:y,indices:C}),d.push({type:"item",item:g,indices:M})}return d}class m{constructor(d,u){this._commands=d,this.category=r(u.category),this.command=u.command,this.args=u.args||P.emptyObject,this.rank=u.rank!==void 0?u.rank:1/0}get label(){return this._commands.label(this.command,this.args)}get icon(){return this._commands.icon(this.command,this.args)}get iconClass(){return this._commands.iconClass(this.command,this.args)}get iconLabel(){return this._commands.iconLabel(this.command,this.args)}get caption(){return this._commands.caption(this.command,this.args)}get className(){return this._commands.className(this.command,this.args)}get dataset(){return this._commands.dataset(this.command,this.args)}get isEnabled(){return this._commands.isEnabled(this.command,this.args)}get isToggled(){return this._commands.isToggled(this.command,this.args)}get isToggleable(){return this._commands.isToggleable(this.command,this.args)}get isVisible(){return this._commands.isVisible(this.command,this.args)}get keyBinding(){let{command:d,args:u}=this;return E.findLastValue(this._commands.keyBindings,p=>p.command===d&&P.deepEqual(p.args,u))||null}}})(he||(he={}));class _e extends z{constructor(e){super({node:j.createNode()}),this._childIndex=-1,this._activeIndex=-1,this._openTimerID=0,this._closeTimerID=0,this._items=[],this._childMenu=null,this._parentMenu=null,this._aboutToClose=new O(this),this._menuRequested=new O(this),this.addClass("lm-Menu"),this.setFlag(z.Flag.DisallowLayout),this.commands=e.commands,this.renderer=e.renderer||_e.defaultRenderer}dispose(){this.close(),this._items.length=0,super.dispose()}get aboutToClose(){return this._aboutToClose}get menuRequested(){return this._menuRequested}get parentMenu(){return this._parentMenu}get childMenu(){return this._childMenu}get rootMenu(){let e=this;for(;e._parentMenu;)e=e._parentMenu;return e}get leafMenu(){let e=this;for(;e._childMenu;)e=e._childMenu;return e}get contentNode(){return this.node.getElementsByClassName("lm-Menu-content")[0]}get activeItem(){return this._items[this._activeIndex]||null}set activeItem(e){this.activeIndex=e?this._items.indexOf(e):-1}get activeIndex(){return this._activeIndex}set activeIndex(e){(e<0||e>=this._items.length)&&(e=-1),e!==-1&&!j.canActivate(this._items[e])&&(e=-1),this._activeIndex!==e&&(this._activeIndex=e,this._activeIndex>=0&&this.contentNode.childNodes[this._activeIndex]&&this.contentNode.childNodes[this._activeIndex].focus(),this.update())}get items(){return this._items}activateNextItem(){let e=this._items.length,t=this._activeIndex,i=t<e-1?t+1:0,s=i===0?e-1:i-1;this.activeIndex=E.findFirstIndex(this._items,j.canActivate,i,s)}activatePreviousItem(){let e=this._items.length,t=this._activeIndex,i=t<=0?e-1:t-1,s=i===e-1?0:i+1;this.activeIndex=E.findLastIndex(this._items,j.canActivate,i,s)}triggerActiveItem(){if(!this.isAttached)return;let e=this.activeItem;if(!e)return;if(this._cancelOpenTimer(),this._cancelCloseTimer(),e.type==="submenu"){this._openChildMenu(!0);return}this.rootMenu.close();let{command:t,args:i}=e;this.commands.isEnabled(t,i)?this.commands.execute(t,i):console.log(`Command '${t}' is disabled.`)}addItem(e){return this.insertItem(this._items.length,e)}insertItem(e,t){this.isAttached&&this.close(),this.activeIndex=-1;let i=Math.max(0,Math.min(e,this._items.length)),s=j.createItem(this,t);return E.insert(this._items,i,s),this.update(),s}removeItem(e){this.removeItemAt(this._items.indexOf(e))}removeItemAt(e){this.isAttached&&this.close(),this.activeIndex=-1,E.removeAt(this._items,e)&&this.update()}clearItems(){this.isAttached&&this.close(),this.activeIndex=-1,this._items.length!==0&&(this._items.length=0,this.update())}open(e,t,i={}){var s,r,l;if(this.isAttached)return;let o=i.forceX||!1,a=i.forceY||!1;const c=(s=i.host)!==null&&s!==void 0?s:null,h=(r=i.ref)!==null&&r!==void 0?r:null,m=(l=i.horizontalAlignment)!==null&&l!==void 0?l:document.documentElement.dir==="rtl"?"right":"left";j.openRootMenu(this,e,t,o,a,m,c,h),this.activate()}handleEvent(e){switch(e.type){case"keydown":this._evtKeyDown(e);break;case"mouseup":this._evtMouseUp(e);break;case"mousemove":this._evtMouseMove(e);break;case"mouseenter":this._evtMouseEnter(e);break;case"mouseleave":this._evtMouseLeave(e);break;case"mousedown":this._evtMouseDown(e);break;case"contextmenu":e.preventDefault(),e.stopPropagation();break}}onBeforeAttach(e){this.node.addEventListener("keydown",this),this.node.addEventListener("mouseup",this),this.node.addEventListener("mousemove",this),this.node.addEventListener("mouseenter",this),this.node.addEventListener("mouseleave",this),this.node.addEventListener("contextmenu",this),document.addEventListener("mousedown",this,!0)}onAfterDetach(e){this.node.removeEventListener("keydown",this),this.node.removeEventListener("mouseup",this),this.node.removeEventListener("mousemove",this),this.node.removeEventListener("mouseenter",this),this.node.removeEventListener("mouseleave",this),this.node.removeEventListener("contextmenu",this),document.removeEventListener("mousedown",this,!0)}onActivateRequest(e){this.isAttached&&this.node.focus()}onUpdateRequest(e){let t=this._items,i=this.renderer,s=this._activeIndex,r=j.computeCollapsed(t),l=new Array(t.length);for(let o=0,a=t.length;o<a;++o){let c=t[o],h=o===s,m=r[o];l[o]=i.renderItem({item:c,active:h,collapsed:m,onfocus:()=>{this.activeIndex=o}})}fe.render(l,this.contentNode)}onCloseRequest(e){this._cancelOpenTimer(),this._cancelCloseTimer(),this.activeIndex=-1;let t=this._childMenu;t&&(this._childIndex=-1,this._childMenu=null,t._parentMenu=null,t.close());let i=this._parentMenu;i&&(this._parentMenu=null,i._childIndex=-1,i._childMenu=null,i.activate()),this.isAttached&&this._aboutToClose.emit(void 0),super.onCloseRequest(e)}_evtKeyDown(e){e.preventDefault(),e.stopPropagation();let t=e.keyCode;if(t===13){this.triggerActiveItem();return}if(t===27){this.close();return}if(t===37){this._parentMenu?this.close():this._menuRequested.emit("previous");return}if(t===38){this.activatePreviousItem();return}if(t===39){let l=this.activeItem;l&&l.type==="submenu"?this.triggerActiveItem():this.rootMenu._menuRequested.emit("next");return}if(t===40){this.activateNextItem();return}let i=Ue().keyForKeydownEvent(e);if(!i)return;let s=this._activeIndex+1,r=j.findMnemonic(this._items,i,s);r.index!==-1&&!r.multiple?(this.activeIndex=r.index,this.triggerActiveItem()):r.index!==-1?this.activeIndex=r.index:r.auto!==-1&&(this.activeIndex=r.auto)}_evtMouseUp(e){e.button===0&&(e.preventDefault(),e.stopPropagation(),this.triggerActiveItem())}_evtMouseMove(e){let t=E.findFirstIndex(this.contentNode.children,s=>H.hitTest(s,e.clientX,e.clientY));if(t===this._activeIndex)return;if(this.activeIndex=t,t=this.activeIndex,t===this._childIndex){this._cancelOpenTimer(),this._cancelCloseTimer();return}this._childIndex!==-1&&this._startCloseTimer(),this._cancelOpenTimer();let i=this.activeItem;!i||i.type!=="submenu"||!i.submenu||this._startOpenTimer()}_evtMouseEnter(e){for(let t=this._parentMenu;t;t=t._parentMenu)t._cancelOpenTimer(),t._cancelCloseTimer(),t.activeIndex=t._childIndex}_evtMouseLeave(e){if(this._cancelOpenTimer(),!this._childMenu){this.activeIndex=-1;return}let{clientX:t,clientY:i}=e;if(H.hitTest(this._childMenu.node,t,i)){this._cancelCloseTimer();return}this.activeIndex=-1,this._startCloseTimer()}_evtMouseDown(e){this._parentMenu||(j.hitTestMenus(this,e.clientX,e.clientY)?(e.preventDefault(),e.stopPropagation()):this.close())}_openChildMenu(e=!1){let t=this.activeItem;if(!t||t.type!=="submenu"||!t.submenu){this._closeChildMenu();return}let i=t.submenu;if(i===this._childMenu)return;_e.saveWindowData(),this._closeChildMenu(),this._childMenu=i,this._childIndex=this._activeIndex,i._parentMenu=this,T.sendMessage(this,z.Msg.UpdateRequest);let s=this.contentNode.children[this._activeIndex];j.openSubmenu(i,s),e&&(i.activeIndex=-1,i.activateNextItem()),i.activate()}_closeChildMenu(){this._childMenu&&this._childMenu.close()}_startOpenTimer(){this._openTimerID===0&&(this._openTimerID=window.setTimeout(()=>{this._openTimerID=0,this._openChildMenu()},j.TIMER_DELAY))}_startCloseTimer(){this._closeTimerID===0&&(this._closeTimerID=window.setTimeout(()=>{this._closeTimerID=0,this._closeChildMenu()},j.TIMER_DELAY))}_cancelOpenTimer(){this._openTimerID!==0&&(clearTimeout(this._openTimerID),this._openTimerID=0)}_cancelCloseTimer(){this._closeTimerID!==0&&(clearTimeout(this._closeTimerID),this._closeTimerID=0)}static saveWindowData(){j.saveWindowData()}}(function(n){class e{renderItem(i){let s=this.createItemClass(i),r=this.createItemDataset(i),l=this.createItemARIA(i);return R.li({className:s,dataset:r,tabindex:"0",onfocus:i.onfocus,...l},this.renderIcon(i),this.renderLabel(i),this.renderShortcut(i),this.renderSubmenu(i))}renderIcon(i){let s=this.createIconClass(i);return R.div({className:s},i.item.icon,i.item.iconLabel)}renderLabel(i){let s=this.formatLabel(i);return R.div({className:"lm-Menu-itemLabel"},s)}renderShortcut(i){let s=this.formatShortcut(i);return R.div({className:"lm-Menu-itemShortcut"},s)}renderSubmenu(i){return R.div({className:"lm-Menu-itemSubmenuIcon"})}createItemClass(i){let s="lm-Menu-item";i.item.isEnabled||(s+=" lm-mod-disabled"),i.item.isToggled&&(s+=" lm-mod-toggled"),i.item.isVisible||(s+=" lm-mod-hidden"),i.active&&(s+=" lm-mod-active"),i.collapsed&&(s+=" lm-mod-collapsed");let r=i.item.className;return r&&(s+=` ${r}`),s}createItemDataset(i){let s,{type:r,command:l,dataset:o}=i.item;return r==="command"?s={...o,type:r,command:l}:s={...o,type:r},s}createIconClass(i){let s="lm-Menu-itemIcon",r=i.item.iconClass;return r?`${s} ${r}`:s}createItemARIA(i){let s={};switch(i.item.type){case"separator":s.role="presentation";break;case"submenu":s["aria-haspopup"]="true",i.item.isEnabled||(s["aria-disabled"]="true");break;default:i.item.isEnabled||(s["aria-disabled"]="true"),i.item.isToggled?(s.role="menuitemcheckbox",s["aria-checked"]="true"):s.role="menuitem"}return s}formatLabel(i){let{label:s,mnemonic:r}=i.item;if(r<0||r>=s.length)return s;let l=s.slice(0,r),o=s.slice(r+1),a=s[r],c=R.span({className:"lm-Menu-itemMnemonic"},a);return[l,c,o]}formatShortcut(i){let s=i.item.keyBinding;return s?me.formatKeystroke(s.keys):null}}n.Renderer=e,n.defaultRenderer=new e})(_e||(_e={}));var j;(function(n){n.TIMER_DELAY=300,n.SUBMENU_OVERLAP=3;let e=null,t=0;function i(){return t>0?(t--,e):h()}function s(){e=h(),t++}n.saveWindowData=s;function r(){let p=document.createElement("div"),g=document.createElement("ul");return g.className="lm-Menu-content",p.appendChild(g),g.setAttribute("role","menu"),p.tabIndex=0,p}n.createNode=r;function l(p){return p.type!=="separator"&&p.isEnabled&&p.isVisible}n.canActivate=l;function o(p,g){return new u(p.commands,g)}n.createItem=o;function a(p,g,C){for(let M=p;M;M=M.childMenu)if(H.hitTest(M.node,g,C))return!0;return!1}n.hitTestMenus=a;function c(p){let g=new Array(p.length);E.fill(g,!1);let C=0,M=p.length;for(;C<M;++C){let S=p[C];if(S.isVisible){if(S.type!=="separator")break;g[C]=!0}}let y=M-1;for(;y>=0;--y){let S=p[y];if(S.isVisible){if(S.type!=="separator")break;g[y]=!0}}let x=!1;for(;++C<y;){let S=p[C];S.isVisible&&(S.type!=="separator"?x=!1:x?g[C]=!0:x=!0)}return g}n.computeCollapsed=c;function h(){return{pageXOffset:window.pageXOffset,pageYOffset:window.pageYOffset,clientWidth:document.documentElement.clientWidth,clientHeight:document.documentElement.clientHeight}}function m(p,g,C,M,y,x,S,I){const w=i();let v=w.pageXOffset,_=w.pageYOffset,b=w.clientWidth,k=w.clientHeight;T.sendMessage(p,z.Msg.UpdateRequest);let A=k-(y?C:0),D=p.node,L=D.style;L.opacity="0",L.maxHeight=`${A}px`,z.attach(p,S||document.body,I);let{width:W,height:Q}=D.getBoundingClientRect();x==="right"&&(g-=W),!M&&g+W>v+b&&(g=v+b-W),!y&&C+Q>_+k&&(C>_+k?C=_+k-Q:C=C-Q),L.transform=`translate(${Math.max(0,g)}px, ${Math.max(0,C)}px`,L.opacity="1"}n.openRootMenu=m;function f(p,g){const C=i();let M=C.pageXOffset,y=C.pageYOffset,x=C.clientWidth,S=C.clientHeight;T.sendMessage(p,z.Msg.UpdateRequest);let I=S,w=p.node,v=w.style;v.opacity="0",v.maxHeight=`${I}px`,z.attach(p,document.body);let{width:_,height:b}=w.getBoundingClientRect(),k=H.boxSizing(p.node),A=g.getBoundingClientRect(),D=A.right-n.SUBMENU_OVERLAP;D+_>M+x&&(D=A.left+n.SUBMENU_OVERLAP-_);let L=A.top-k.borderTop-k.paddingTop;L+b>y+S&&(L=A.bottom+k.borderBottom+k.paddingBottom-b),v.transform=`translate(${Math.max(0,D)}px, ${Math.max(0,L)}px`,v.opacity="1"}n.openSubmenu=f;function d(p,g,C){let M=-1,y=-1,x=!1,S=g.toUpperCase();for(let I=0,w=p.length;I<w;++I){let v=(I+C)%w,_=p[v];if(!l(_))continue;let b=_.label;if(b.length===0)continue;let k=_.mnemonic;if(k>=0&&k<b.length){b[k].toUpperCase()===S&&(M===-1?M=v:x=!0);continue}y===-1&&b[0].toUpperCase()===S&&(y=v)}return{index:M,multiple:x,auto:y}}n.findMnemonic=d;class u{constructor(g,C){this._commands=g,this.type=C.type||"command",this.command=C.command||"",this.args=C.args||P.emptyObject,this.submenu=C.submenu||null}get label(){return this.type==="command"?this._commands.label(this.command,this.args):this.type==="submenu"&&this.submenu?this.submenu.title.label:""}get mnemonic(){return this.type==="command"?this._commands.mnemonic(this.command,this.args):this.type==="submenu"&&this.submenu?this.submenu.title.mnemonic:-1}get icon(){if(this.type==="command")return this._commands.icon(this.command,this.args);if(this.type==="submenu"&&this.submenu)return this.submenu.title.icon}get iconClass(){return this.type==="command"?this._commands.iconClass(this.command,this.args):this.type==="submenu"&&this.submenu?this.submenu.title.iconClass:""}get iconLabel(){return this.type==="command"?this._commands.iconLabel(this.command,this.args):this.type==="submenu"&&this.submenu?this.submenu.title.iconLabel:""}get caption(){return this.type==="command"?this._commands.caption(this.command,this.args):this.type==="submenu"&&this.submenu?this.submenu.title.caption:""}get className(){return this.type==="command"?this._commands.className(this.command,this.args):this.type==="submenu"&&this.submenu?this.submenu.title.className:""}get dataset(){return this.type==="command"?this._commands.dataset(this.command,this.args):this.type==="submenu"&&this.submenu?this.submenu.title.dataset:{}}get isEnabled(){return this.type==="command"?this._commands.isEnabled(this.command,this.args):this.type==="submenu"?this.submenu!==null:!0}get isToggled(){return this.type==="command"?this._commands.isToggled(this.command,this.args):!1}get isVisible(){return this.type==="command"?this._commands.isVisible(this.command,this.args):this.type==="submenu"?this.submenu!==null:!0}get keyBinding(){if(this.type==="command"){let{command:g,args:C}=this;return E.findLastValue(this._commands.keyBindings,M=>M.command===g&&P.deepEqual(M.args,C))||null}return null}}})(j||(j={}));var Et;(function(n){function e(l,o){let a=i(l.selector),c=l.rank!==void 0?l.rank:1/0;return{...l,selector:a,rank:c,id:o}}n.createItem=e;function t(l,o,a,c){let h=o.target;if(!h)return null;let m=o.currentTarget;if(!m||!m.contains(h)&&(h=document.elementFromPoint(o.clientX,o.clientY),!h||!m.contains(h)))return null;let f=[],d=l.slice();for(;h!==null;){let u=[];for(let p=0,g=d.length;p<g;++p){let C=d[p];C&&ue.matches(h,C.selector)&&(u.push(C),d[p]=null)}if(u.length!==0&&(a&&u.sort(c?r:s),f.push(...u)),h===m)break;h=h.parentElement}return a||f.sort(c?r:s),f}n.matchItems=t;function i(l){if(l.indexOf(",")!==-1)throw new Error(`Selector cannot contain commas: ${l}`);if(!ue.isValid(l))throw new Error(`Invalid selector: ${l}`);return l}function s(l,o){let a=l.rank,c=o.rank;return a!==c?a<c?-1:1:l.id-o.id}function r(l,o){let a=ue.calculateSpecificity(l.selector),c=ue.calculateSpecificity(o.selector);return a!==c?c-a:s(l,o)}})(Et||(Et={}));const $i=["ArrowLeft","ArrowUp","ArrowRight","ArrowDown","Home","End"];class Ae extends z{constructor(e={}){super({node:ee.createNode()}),this._currentIndex=-1,this._titles=[],this._titlesEditable=!1,this._previousTitle=null,this._dragData=null,this._addButtonEnabled=!1,this._tabMoved=new O(this),this._currentChanged=new O(this),this._addRequested=new O(this),this._tabCloseRequested=new O(this),this._tabDetachRequested=new O(this),this._tabActivateRequested=new O(this),this.addClass("lm-TabBar"),this.contentNode.setAttribute("role","tablist"),this.setFlag(z.Flag.DisallowLayout),this._document=e.document||document,this.tabsMovable=e.tabsMovable||!1,this.titlesEditable=e.titlesEditable||!1,this.allowDeselect=e.allowDeselect||!1,this.addButtonEnabled=e.addButtonEnabled||!1,this.insertBehavior=e.insertBehavior||"select-tab-if-needed",this.name=e.name||"",this.orientation=e.orientation||"horizontal",this.removeBehavior=e.removeBehavior||"select-tab-after",this.renderer=e.renderer||Ae.defaultRenderer}dispose(){this._releaseMouse(),this._titles.length=0,this._previousTitle=null,super.dispose()}get currentChanged(){return this._currentChanged}get tabMoved(){return this._tabMoved}get tabActivateRequested(){return this._tabActivateRequested}get addRequested(){return this._addRequested}get tabCloseRequested(){return this._tabCloseRequested}get tabDetachRequested(){return this._tabDetachRequested}get document(){return this._document}get titlesEditable(){return this._titlesEditable}set titlesEditable(e){this._titlesEditable=e}get currentTitle(){return this._titles[this._currentIndex]||null}set currentTitle(e){this.currentIndex=e?this._titles.indexOf(e):-1}get currentIndex(){return this._currentIndex}set currentIndex(e){if((e<0||e>=this._titles.length)&&(e=-1),this._currentIndex===e)return;let t=this._currentIndex,i=this._titles[t]||null,s=e,r=this._titles[s]||null;this._currentIndex=s,this._previousTitle=i,this.update(),this._currentChanged.emit({previousIndex:t,previousTitle:i,currentIndex:s,currentTitle:r})}get name(){return this._name}set name(e){this._name=e,e?this.contentNode.setAttribute("aria-label",e):this.contentNode.removeAttribute("aria-label")}get orientation(){return this._orientation}set orientation(e){this._orientation!==e&&(this._releaseMouse(),this._orientation=e,this.dataset.orientation=e,this.contentNode.setAttribute("aria-orientation",e))}get addButtonEnabled(){return this._addButtonEnabled}set addButtonEnabled(e){this._addButtonEnabled!==e&&(this._addButtonEnabled=e,e?this.addButtonNode.classList.remove("lm-mod-hidden"):this.addButtonNode.classList.add("lm-mod-hidden"))}get titles(){return this._titles}get contentNode(){return this.node.getElementsByClassName("lm-TabBar-content")[0]}get addButtonNode(){return this.node.getElementsByClassName("lm-TabBar-addButton")[0]}addTab(e){return this.insertTab(this._titles.length,e)}insertTab(e,t){this._releaseMouse();let i=ee.asTitle(t),s=this._titles.indexOf(i),r=Math.max(0,Math.min(e,this._titles.length));return s===-1?(E.insert(this._titles,r,i),i.changed.connect(this._onTitleChanged,this),this.update(),this._adjustCurrentForInsert(r,i),i):(r===this._titles.length&&r--,s===r||(E.move(this._titles,s,r),this.update(),this._adjustCurrentForMove(s,r)),i)}removeTab(e){this.removeTabAt(this._titles.indexOf(e))}removeTabAt(e){this._releaseMouse();let t=E.removeAt(this._titles,e);t&&(t.changed.disconnect(this._onTitleChanged,this),t===this._previousTitle&&(this._previousTitle=null),this.update(),this._adjustCurrentForRemove(e,t))}clearTabs(){if(this._titles.length===0)return;this._releaseMouse();for(let i of this._titles)i.changed.disconnect(this._onTitleChanged,this);let e=this.currentIndex,t=this.currentTitle;this._currentIndex=-1,this._previousTitle=null,this._titles.length=0,this.update(),e!==-1&&this._currentChanged.emit({previousIndex:e,previousTitle:t,currentIndex:-1,currentTitle:null})}releaseMouse(){this._releaseMouse()}handleEvent(e){switch(e.type){case"pointerdown":this._evtPointerDown(e);break;case"pointermove":this._evtPointerMove(e);break;case"pointerup":this._evtPointerUp(e);break;case"dblclick":this._evtDblClick(e);break;case"keydown":e.eventPhase===Event.CAPTURING_PHASE?this._evtKeyDownCapturing(e):this._evtKeyDown(e);break;case"contextmenu":e.preventDefault(),e.stopPropagation();break}}onBeforeAttach(e){this.node.addEventListener("pointerdown",this),this.node.addEventListener("dblclick",this),this.node.addEventListener("keydown",this)}onAfterDetach(e){this.node.removeEventListener("pointerdown",this),this.node.removeEventListener("dblclick",this),this.node.removeEventListener("keydown",this),this._releaseMouse()}onUpdateRequest(e){var t;let i=this._titles,s=this.renderer,r=this.currentTitle,l=new Array(i.length);const o=(t=this._getCurrentTabindex())!==null&&t!==void 0?t:this._currentIndex>-1?this._currentIndex:0;for(let a=0,c=i.length;a<c;++a){let h=i[a],m=h===r,f=m?c:c-a-1,d=o===a?0:-1;l[a]=s.renderTab({title:h,current:m,zIndex:f,tabIndex:d})}fe.render(l,this.contentNode)}_getCurrentTabindex(){let e=null;const t=this.contentNode.querySelector('li[tabindex="0"]');return t?e=[...this.contentNode.children].indexOf(t):this._addButtonEnabled&&this.addButtonNode.getAttribute("tabindex")==="0"&&(e=-1),e}_evtDblClick(e){if(!this.titlesEditable)return;let t=this.contentNode.children,i=E.findFirstIndex(t,l=>H.hitTest(l,e.clientX,e.clientY));if(i===-1)return;let s=this.titles[i],r=t[i].querySelector(".lm-TabBar-tabLabel");if(r&&r.contains(e.target)){let l=s.label||"",o=r.innerHTML;r.innerHTML="";let a=document.createElement("input");a.classList.add("lm-TabBar-tabInput"),a.value=l,r.appendChild(a);let c=()=>{a.removeEventListener("blur",c),r.innerHTML=o,this.node.addEventListener("keydown",this)};a.addEventListener("dblclick",h=>h.stopPropagation()),a.addEventListener("blur",c),a.addEventListener("keydown",h=>{h.key==="Enter"?(a.value!==""&&(s.label=s.caption=a.value),c()):h.key==="Escape"&&c()}),this.node.removeEventListener("keydown",this),a.select(),a.focus(),r.children.length>0&&r.children[0].focus()}}_evtKeyDownCapturing(e){e.eventPhase===Event.CAPTURING_PHASE&&(e.preventDefault(),e.stopPropagation(),e.key==="Escape"&&this._releaseMouse())}_evtKeyDown(e){var t,i,s;if(!(e.key==="Tab"||e.eventPhase===Event.CAPTURING_PHASE)){if(e.key==="Enter"||e.key==="Spacebar"||e.key===" "){const r=document.activeElement;if(this.addButtonEnabled&&this.addButtonNode.contains(r))e.preventDefault(),e.stopPropagation(),this._addRequested.emit();else{const l=E.findFirstIndex(this.contentNode.children,o=>o.contains(r));l>=0&&(e.preventDefault(),e.stopPropagation(),this.currentIndex=l)}}else if($i.includes(e.key)){const r=[...this.contentNode.children];if(this.addButtonEnabled&&r.push(this.addButtonNode),r.length<=1)return;e.preventDefault(),e.stopPropagation();let l=r.indexOf(document.activeElement);l===-1&&(l=this._currentIndex);let o;e.key==="ArrowRight"&&this._orientation==="horizontal"||e.key==="ArrowDown"&&this._orientation==="vertical"?o=(t=r[l+1])!==null&&t!==void 0?t:r[0]:e.key==="ArrowLeft"&&this._orientation==="horizontal"||e.key==="ArrowUp"&&this._orientation==="vertical"?o=(i=r[l-1])!==null&&i!==void 0?i:r[r.length-1]:e.key==="Home"?o=r[0]:e.key==="End"&&(o=r[r.length-1]),o&&((s=r[l])===null||s===void 0||s.setAttribute("tabindex","-1"),o?.setAttribute("tabindex","0"),o.focus())}}}_evtPointerDown(e){if(e.button!==0&&e.button!==1||this._dragData||e.target.classList.contains("lm-TabBar-tabInput"))return;let t=this.addButtonEnabled&&this.addButtonNode.contains(e.target),i=this.contentNode.children,s=E.findFirstIndex(i,l=>H.hitTest(l,e.clientX,e.clientY));if(s===-1&&!t||(e.preventDefault(),e.stopPropagation(),this._dragData={tab:i[s],index:s,pressX:e.clientX,pressY:e.clientY,tabPos:-1,tabSize:-1,tabPressPos:-1,targetIndex:-1,tabLayout:null,contentRect:null,override:null,dragActive:!1,dragAborted:!1,detachRequested:!1},this.document.addEventListener("pointerup",this,!0),e.button===1||t))return;let r=i[s].querySelector(this.renderer.closeIconSelector);r&&r.contains(e.target)||(this.tabsMovable&&(this.document.addEventListener("pointermove",this,!0),this.document.addEventListener("keydown",this,!0),this.document.addEventListener("contextmenu",this,!0)),this.allowDeselect&&this.currentIndex===s?this.currentIndex=-1:this.currentIndex=s,this.currentIndex!==-1&&this._tabActivateRequested.emit({index:this.currentIndex,title:this.currentTitle}))}_evtPointerMove(e){let t=this._dragData;if(!t)return;e.preventDefault(),e.stopPropagation();let i=this.contentNode.children;if(!(!t.dragActive&&!ee.dragExceeded(t,e))){if(!t.dragActive){let s=t.tab.getBoundingClientRect();this._orientation==="horizontal"?(t.tabPos=t.tab.offsetLeft,t.tabSize=s.width,t.tabPressPos=t.pressX-s.left):(t.tabPos=t.tab.offsetTop,t.tabSize=s.height,t.tabPressPos=t.pressY-s.top),t.tabPressOffset={x:t.pressX-s.left,y:t.pressY-s.top},t.tabLayout=ee.snapTabLayout(i,this._orientation),t.contentRect=this.contentNode.getBoundingClientRect(),t.override=K.overrideCursor("default"),t.tab.classList.add("lm-mod-dragging"),this.addClass("lm-mod-dragging"),t.dragActive=!0}if(!t.detachRequested&&ee.detachExceeded(t,e)){t.detachRequested=!0;let s=t.index,r=e.clientX,l=e.clientY,o=i[s],a=this._titles[s];if(this._tabDetachRequested.emit({index:s,title:a,tab:o,clientX:r,clientY:l,offset:t.tabPressOffset}),t.dragAborted)return}ee.layoutTabs(i,t,e,this._orientation)}}_evtPointerUp(e){if(e.button!==0&&e.button!==1)return;const t=this._dragData;if(!t)return;if(e.preventDefault(),e.stopPropagation(),this.document.removeEventListener("pointermove",this,!0),this.document.removeEventListener("pointerup",this,!0),this.document.removeEventListener("keydown",this,!0),this.document.removeEventListener("contextmenu",this,!0),!t.dragActive){if(this._dragData=null,this.addButtonEnabled&&this.addButtonNode.contains(e.target)){this._addRequested.emit(void 0);return}let r=this.contentNode.children,l=E.findFirstIndex(r,c=>H.hitTest(c,e.clientX,e.clientY));if(l!==t.index)return;let o=this._titles[l];if(!o.closable)return;if(e.button===1){this._tabCloseRequested.emit({index:l,title:o});return}let a=r[l].querySelector(this.renderer.closeIconSelector);if(a&&a.contains(e.target)){this._tabCloseRequested.emit({index:l,title:o});return}return}if(e.button!==0)return;ee.finalizeTabPosition(t,this._orientation),t.tab.classList.remove("lm-mod-dragging");let i=ee.parseTransitionDuration(t.tab);setTimeout(()=>{if(t.dragAborted)return;this._dragData=null,ee.resetTabPositions(this.contentNode.children,this._orientation),t.override.dispose(),this.removeClass("lm-mod-dragging");let s=t.index,r=t.targetIndex;r===-1||s===r||(E.move(this._titles,s,r),this._adjustCurrentForMove(s,r),this._tabMoved.emit({fromIndex:s,toIndex:r,title:this._titles[r]}),T.sendMessage(this,z.Msg.UpdateRequest))},i)}_releaseMouse(){let e=this._dragData;e&&(this._dragData=null,this.document.removeEventListener("pointermove",this,!0),this.document.removeEventListener("pointerup",this,!0),this.document.removeEventListener("keydown",this,!0),this.document.removeEventListener("contextmenu",this,!0),e.dragAborted=!0,e.dragActive&&(ee.resetTabPositions(this.contentNode.children,this._orientation),e.override.dispose(),e.tab.classList.remove("lm-mod-dragging"),this.removeClass("lm-mod-dragging")))}_adjustCurrentForInsert(e,t){let i=this.currentTitle,s=this._currentIndex,r=this.insertBehavior;if(r==="select-tab"||r==="select-tab-if-needed"&&s===-1){this._currentIndex=e,this._previousTitle=i,this._currentChanged.emit({previousIndex:s,previousTitle:i,currentIndex:e,currentTitle:t});return}s>=e&&this._currentIndex++}_adjustCurrentForMove(e,t){this._currentIndex===e?this._currentIndex=t:this._currentIndex<e&&this._currentIndex>=t?this._currentIndex++:this._currentIndex>e&&this._currentIndex<=t&&this._currentIndex--}_adjustCurrentForRemove(e,t){let i=this._currentIndex,s=this.removeBehavior;if(i!==e){i>e&&this._currentIndex--;return}if(this._titles.length===0){this._currentIndex=-1,this._currentChanged.emit({previousIndex:e,previousTitle:t,currentIndex:-1,currentTitle:null});return}if(s==="select-tab-after"){this._currentIndex=Math.min(e,this._titles.length-1),this._currentChanged.emit({previousIndex:e,previousTitle:t,currentIndex:this._currentIndex,currentTitle:this.currentTitle});return}if(s==="select-tab-before"){this._currentIndex=Math.max(0,e-1),this._currentChanged.emit({previousIndex:e,previousTitle:t,currentIndex:this._currentIndex,currentTitle:this.currentTitle});return}if(s==="select-previous-tab"){this._previousTitle?(this._currentIndex=this._titles.indexOf(this._previousTitle),this._previousTitle=null):this._currentIndex=Math.min(e,this._titles.length-1),this._currentChanged.emit({previousIndex:e,previousTitle:t,currentIndex:this._currentIndex,currentTitle:this.currentTitle});return}this._currentIndex=-1,this._currentChanged.emit({previousIndex:e,previousTitle:t,currentIndex:-1,currentTitle:null})}_onTitleChanged(e){this.update()}}(function(n){class e{constructor(){this.closeIconSelector=".lm-TabBar-tabCloseIcon",this._tabID=0,this._tabKeys=new WeakMap,this._uuid=++e._nInstance}renderTab(i){let s=i.title.caption,r=this.createTabKey(i),l=r,o=this.createTabStyle(i),a=this.createTabClass(i),c=this.createTabDataset(i),h=this.createTabARIA(i);return i.title.closable?R.li({id:l,key:r,className:a,title:s,style:o,dataset:c,...h},this.renderIcon(i),this.renderLabel(i),this.renderCloseIcon(i)):R.li({id:l,key:r,className:a,title:s,style:o,dataset:c,...h},this.renderIcon(i),this.renderLabel(i))}renderIcon(i){const{title:s}=i;let r=this.createIconClass(i);return R.div({className:r},s.icon,s.iconLabel)}renderLabel(i){return R.div({className:"lm-TabBar-tabLabel"},i.title.label)}renderCloseIcon(i){return R.div({className:"lm-TabBar-tabCloseIcon"})}createTabKey(i){let s=this._tabKeys.get(i.title);return s===void 0&&(s=`tab-key-${this._uuid}-${this._tabID++}`,this._tabKeys.set(i.title,s)),s}createTabStyle(i){return{zIndex:`${i.zIndex}`}}createTabClass(i){let s="lm-TabBar-tab";return i.title.className&&(s+=` ${i.title.className}`),i.title.closable&&(s+=" lm-mod-closable"),i.current&&(s+=" lm-mod-current"),s}createTabDataset(i){return i.title.dataset}createTabARIA(i){var s;return{role:"tab","aria-selected":i.current.toString(),tabindex:`${(s=i.tabIndex)!==null&&s!==void 0?s:"-1"}`}}createIconClass(i){let s="lm-TabBar-tabIcon",r=i.title.iconClass;return r?`${s} ${r}`:s}}e._nInstance=0,n.Renderer=e,n.defaultRenderer=new e,n.addButtonSelector=".lm-TabBar-addButton"})(Ae||(Ae={}));var ee;(function(n){n.DRAG_THRESHOLD=5,n.DETACH_THRESHOLD=20;function e(){let h=document.createElement("div"),m=document.createElement("ul");m.setAttribute("role","tablist"),m.className="lm-TabBar-content",h.appendChild(m);let f=document.createElement("div");return f.className="lm-TabBar-addButton lm-mod-hidden",f.setAttribute("tabindex","-1"),f.setAttribute("role","button"),h.appendChild(f),h}n.createNode=e;function t(h){return h instanceof _t?h:new _t(h)}n.asTitle=t;function i(h){let m=window.getComputedStyle(h);return 1e3*(parseFloat(m.transitionDuration)||0)}n.parseTransitionDuration=i;function s(h,m){let f=new Array(h.length);for(let d=0,u=h.length;d<u;++d){let p=h[d],g=window.getComputedStyle(p);m==="horizontal"?f[d]={pos:p.offsetLeft,size:p.offsetWidth,margin:parseFloat(g.marginLeft)||0}:f[d]={pos:p.offsetTop,size:p.offsetHeight,margin:parseFloat(g.marginTop)||0}}return f}n.snapTabLayout=s;function r(h,m){let f=Math.abs(m.clientX-h.pressX),d=Math.abs(m.clientY-h.pressY);return f>=n.DRAG_THRESHOLD||d>=n.DRAG_THRESHOLD}n.dragExceeded=r;function l(h,m){let f=h.contentRect;return m.clientX<f.left-n.DETACH_THRESHOLD||m.clientX>=f.right+n.DETACH_THRESHOLD||m.clientY<f.top-n.DETACH_THRESHOLD||m.clientY>=f.bottom+n.DETACH_THRESHOLD}n.detachExceeded=l;function o(h,m,f,d){let u,p,g,C;d==="horizontal"?(u=m.pressX,p=f.clientX-m.contentRect.left,g=f.clientX,C=m.contentRect.width):(u=m.pressY,p=f.clientY-m.contentRect.top,g=f.clientY,C=m.contentRect.height);let M=m.index,y=p-m.tabPressPos,x=y+m.tabSize;for(let S=0,I=h.length;S<I;++S){let w,v=m.tabLayout[S],_=v.pos+(v.size>>1);if(S<m.index&&y<_)w=`${m.tabSize+m.tabLayout[S+1].margin}px`,M=Math.min(M,S);else if(S>m.index&&x>_)w=`${-m.tabSize-v.margin}px`,M=Math.max(M,S);else if(S===m.index){let b=g-u,k=C-(m.tabPos+m.tabSize);w=`${Math.max(-m.tabPos,Math.min(b,k))}px`}else w="";d==="horizontal"?h[S].style.left=w:h[S].style.top=w}m.targetIndex=M}n.layoutTabs=o;function a(h,m){let f;m==="horizontal"?f=h.contentRect.width:f=h.contentRect.height;let d;if(h.targetIndex===h.index)d=0;else if(h.targetIndex>h.index){let g=h.tabLayout[h.targetIndex];d=g.pos+g.size-h.tabSize-h.tabPos}else d=h.tabLayout[h.targetIndex].pos-h.tabPos;let u=f-(h.tabPos+h.tabSize),p=Math.max(-h.tabPos,Math.min(d,u));m==="horizontal"?h.tab.style.left=`${p}px`:h.tab.style.top=`${p}px`}n.finalizeTabPosition=a;function c(h,m){for(const f of h)m==="horizontal"?f.style.left="":f.style.top=""}n.resetTabPositions=c})(ee||(ee={}));class Ki extends Me{constructor(e){super(),this._spacing=4,this._dirty=!1,this._root=null,this._box=null,this._items=new Map,this.renderer=e.renderer,e.spacing!==void 0&&(this._spacing=We.clampDimension(e.spacing)),this._document=e.document||document,this._hiddenMode=e.hiddenMode!==void 0?e.hiddenMode:z.HiddenMode.Display}dispose(){let e=this[Symbol.iterator]();this._items.forEach(t=>{t.dispose()}),this._box=null,this._root=null,this._items.clear();for(const t of e)t.dispose();super.dispose()}get hiddenMode(){return this._hiddenMode}set hiddenMode(e){if(this._hiddenMode!==e){this._hiddenMode=e;for(const t of this.tabBars())if(t.titles.length>1)for(const i of t.titles)i.owner.hiddenMode=this._hiddenMode}}get spacing(){return this._spacing}set spacing(e){e=We.clampDimension(e),this._spacing!==e&&(this._spacing=e,this.parent&&this.parent.fit())}get isEmpty(){return this._root===null}[Symbol.iterator](){return this._root?this._root.iterAllWidgets():Le()}widgets(){return this._root?this._root.iterUserWidgets():Le()}selectedWidgets(){return this._root?this._root.iterSelectedWidgets():Le()}tabBars(){return this._root?this._root.iterTabBars():Le()}handles(){return this._root?this._root.iterHandles():Le()}moveHandle(e,t,i){let s=e.classList.contains("lm-mod-hidden");if(!this._root||s)return;let r=this._root.findSplitNode(e);if(!r)return;let l;r.node.orientation==="horizontal"?l=t-e.offsetLeft:l=i-e.offsetTop,l!==0&&(r.node.holdSizes(),Z.adjust(r.node.sizers,r.index,l),this.parent&&this.parent.update())}saveLayout(){return this._root?(this._root.holdAllSizes(),{main:this._root.createConfig()}):{main:null}}restoreLayout(e){let t=new Set,i;e.main?i=q.normalizeAreaConfig(e.main,t):i=null;let s=this.widgets(),r=this.tabBars(),l=this.handles();this._root=null;for(const o of s)t.has(o)||(o.parent=null);for(const o of r)o.dispose();for(const o of l)o.parentNode&&o.parentNode.removeChild(o);for(const o of t)o.parent=this.parent;i?this._root=q.realizeAreaConfig(i,{createTabBar:o=>this._createTabBar(),createHandle:()=>this._createHandle()},this._document):this._root=null,this.parent&&(t.forEach(o=>{this.attachWidget(o)}),this.parent.fit())}addWidget(e,t={}){let i=t.ref||null,s=t.mode||"tab-after",r=null;if(this._root&&i&&(r=this._root.findTabNode(i)),i&&!r)throw new Error("Reference widget is not in the layout.");switch(e.parent=this.parent,s){case"tab-after":this._insertTab(e,i,r,!0);break;case"tab-before":this._insertTab(e,i,r,!1);break;case"split-top":this._insertSplit(e,i,r,"vertical",!1);break;case"split-left":this._insertSplit(e,i,r,"horizontal",!1);break;case"split-right":this._insertSplit(e,i,r,"horizontal",!0);break;case"split-bottom":this._insertSplit(e,i,r,"vertical",!0);break;case"merge-top":this._insertSplit(e,i,r,"vertical",!1,!0);break;case"merge-left":this._insertSplit(e,i,r,"horizontal",!1,!0);break;case"merge-right":this._insertSplit(e,i,r,"horizontal",!0,!0);break;case"merge-bottom":this._insertSplit(e,i,r,"vertical",!0,!0);break}this.parent&&(this.attachWidget(e),this.parent.fit())}removeWidget(e){this._removeWidget(e),this.parent&&(this.detachWidget(e),this.parent.fit())}hitTestTabAreas(e,t){if(!this._root||!this.parent||!this.parent.isVisible)return null;this._box||(this._box=H.boxSizing(this.parent.node));let i=this.parent.node.getBoundingClientRect(),s=e-i.left-this._box.borderLeft,r=t-i.top-this._box.borderTop,l=this._root.hitTestTabNodes(s,r);if(!l)return null;let{tabBar:o,top:a,left:c,width:h,height:m}=l,f=this._box.borderLeft+this._box.borderRight,d=this._box.borderTop+this._box.borderBottom,u=i.width-f-(c+h),p=i.height-d-(a+m);return{tabBar:o,x:s,y:r,top:a,left:c,right:u,bottom:p,width:h,height:m}}init(){super.init();for(const e of this)this.attachWidget(e);for(const e of this.handles())this.parent.node.appendChild(e);this.parent.fit()}attachWidget(e){this.parent.node!==e.node.parentNode&&(this._items.set(e,new qe(e)),this.parent.isAttached&&T.sendMessage(e,z.Msg.BeforeAttach),this.parent.node.appendChild(e.node),this.parent.isAttached&&T.sendMessage(e,z.Msg.AfterAttach))}detachWidget(e){if(this.parent.node!==e.node.parentNode)return;this.parent.isAttached&&T.sendMessage(e,z.Msg.BeforeDetach),this.parent.node.removeChild(e.node),this.parent.isAttached&&T.sendMessage(e,z.Msg.AfterDetach);let t=this._items.get(e);t&&(this._items.delete(e),t.dispose())}onBeforeShow(e){super.onBeforeShow(e),this.parent.update()}onBeforeAttach(e){super.onBeforeAttach(e),this.parent.fit()}onChildShown(e){this.parent.fit()}onChildHidden(e){this.parent.fit()}onResize(e){this.parent.isVisible&&this._update(e.width,e.height)}onUpdateRequest(e){this.parent.isVisible&&this._update(-1,-1)}onFitRequest(e){this.parent.isAttached&&this._fit()}_removeWidget(e){if(!this._root)return;let t=this._root.findTabNode(e);if(!t)return;if(q.removeAria(e),t.tabBar.titles.length>1){if(t.tabBar.removeTab(e.title),this._hiddenMode===z.HiddenMode.Scale&&t.tabBar.titles.length==1){const f=t.tabBar.titles[0].owner;f.hiddenMode=z.HiddenMode.Display}return}if(t.tabBar.dispose(),this._root===t){this._root=null;return}this._root.holdAllSizes();let i=t.parent;t.parent=null;let s=E.removeFirstOf(i.children,t),r=E.removeAt(i.handles,s);if(E.removeAt(i.sizers,s),r.parentNode&&r.parentNode.removeChild(r),i.children.length>1){i.syncHandles();return}let l=i.parent;i.parent=null;let o=i.children[0],a=i.handles[0];if(i.children.length=0,i.handles.length=0,i.sizers.length=0,a.parentNode&&a.parentNode.removeChild(a),this._root===i){o.parent=null,this._root=o;return}let c=l,h=c.children.indexOf(i);if(o instanceof q.TabLayoutNode){o.parent=c,c.children[h]=o;return}let m=E.removeAt(c.handles,h);E.removeAt(c.children,h),E.removeAt(c.sizers,h),m.parentNode&&m.parentNode.removeChild(m);for(let f=0,d=o.children.length;f<d;++f){let u=o.children[f],p=o.handles[f],g=o.sizers[f];E.insert(c.children,h+f,u),E.insert(c.handles,h+f,p),E.insert(c.sizers,h+f,g),u.parent=c}o.children.length=0,o.handles.length=0,o.sizers.length=0,o.parent=null,c.syncHandles()}_createTabNode(e){let t=new q.TabLayoutNode(this._createTabBar());return t.tabBar.addTab(e.title),q.addAria(e,t.tabBar),t}_insertTab(e,t,i,s){if(e===t)return;if(!this._root){let l=new q.TabLayoutNode(this._createTabBar());l.tabBar.addTab(e.title),this._root=l,q.addAria(e,l.tabBar);return}i||(i=this._root.findFirstTabNode()),i.tabBar.titles.indexOf(e.title)===-1&&(this._removeWidget(e),e.hide());let r;if(t?r=i.tabBar.titles.indexOf(t.title):r=i.tabBar.currentIndex,this._hiddenMode===z.HiddenMode.Scale)if(i.tabBar.titles.length===0)e.hiddenMode=z.HiddenMode.Display;else if(i.tabBar.titles.length==1){const l=i.tabBar.titles[0].owner;l.hiddenMode=z.HiddenMode.Scale}else e.hiddenMode=z.HiddenMode.Scale;else e.hiddenMode=this._hiddenMode;i.tabBar.insertTab(r+(s?1:0),e.title),q.addAria(e,i.tabBar)}_insertSplit(e,t,i,s,r,l=!1){if(e===t&&i&&i.tabBar.titles.length===1)return;if(this._removeWidget(e),!this._root){this._root=this._createTabNode(e);return}if(!i||!i.parent){let f=this._splitRoot(s),d=r?f.children.length:0;f.normalizeSizes();let u=q.createSizer(i?1:q.GOLDEN_RATIO),p=this._createTabNode(e);E.insert(f.children,d,p),E.insert(f.sizers,d,u),E.insert(f.handles,d,this._createHandle()),p.parent=f,f.normalizeSizes(),f.syncHandles();return}let o=i.parent;if(o.orientation===s){let f=o.children.indexOf(i);if(l){let g=f+(r?1:-1),C=o.children[g];if(C instanceof q.TabLayoutNode){this._insertTab(e,null,C,!0),++C.tabBar.currentIndex;return}}o.normalizeSizes();let d=o.sizers[f].sizeHint/=2,u=f+(r?1:0),p=this._createTabNode(e);E.insert(o.children,u,p),E.insert(o.sizers,u,q.createSizer(d)),E.insert(o.handles,u,this._createHandle()),p.parent=o,o.syncHandles();return}let a=E.removeFirstOf(o.children,i),c=new q.SplitLayoutNode(s);c.normalized=!0,c.children.push(i),c.sizers.push(q.createSizer(.5)),c.handles.push(this._createHandle()),i.parent=c;let h=r?1:0,m=this._createTabNode(e);E.insert(c.children,h,m),E.insert(c.sizers,h,q.createSizer(.5)),E.insert(c.handles,h,this._createHandle()),m.parent=c,c.syncHandles(),E.insert(o.children,a,c),c.parent=o}_splitRoot(e){let t=this._root;if(t instanceof q.SplitLayoutNode&&t.orientation===e)return t;let i=this._root=new q.SplitLayoutNode(e);return t&&(i.children.push(t),i.sizers.push(q.createSizer(0)),i.handles.push(this._createHandle()),t.parent=i),i}_fit(){let e=0,t=0;if(this._root){let r=this._root.fit(this._spacing,this._items);e=r.minWidth,t=r.minHeight}let i=this._box=H.boxSizing(this.parent.node);e+=i.horizontalSum,t+=i.verticalSum;let s=this.parent.node.style;s.minWidth=`${e}px`,s.minHeight=`${t}px`,this._dirty=!0,this.parent.parent&&T.sendMessage(this.parent.parent,z.Msg.FitRequest),this._dirty&&T.sendMessage(this.parent,z.Msg.UpdateRequest)}_update(e,t){if(this._dirty=!1,!this._root)return;e<0&&(e=this.parent.node.offsetWidth),t<0&&(t=this.parent.node.offsetHeight),this._box||(this._box=H.boxSizing(this.parent.node));let i=this._box.paddingTop,s=this._box.paddingLeft,r=e-this._box.horizontalSum,l=t-this._box.verticalSum;this._root.update(i,s,r,l,this._spacing,this._items)}_createTabBar(){let e=this.renderer.createTabBar(this._document);return e.orientation="horizontal",this.parent&&this.attachWidget(e),e}_createHandle(){let e=this.renderer.createHandle(),t=e.style;return t.position="absolute",t.contain="strict",t.top="0",t.left="0",t.width="0",t.height="0",this.parent&&this.parent.node.appendChild(e),e}}var q;(function(n){n.GOLDEN_RATIO=.618;function e(f){let d=new ge;return d.sizeHint=f,d.size=f,d}n.createSizer=e;function t(f,d){let u;return f.type==="tab-area"?u=a(f,d):u=c(f,d),u}n.normalizeAreaConfig=t;function i(f,d,u){let p;return f.type==="tab-area"?p=h(f,d,u):p=m(f,d,u),p}n.realizeAreaConfig=i;class s{constructor(d){this.parent=null,this._top=0,this._left=0,this._width=0,this._height=0;let u=new ge,p=new ge;u.stretch=0,p.stretch=1,this.tabBar=d,this.sizers=[u,p]}get top(){return this._top}get left(){return this._left}get width(){return this._width}get height(){return this._height}*iterAllWidgets(){yield this.tabBar,yield*this.iterUserWidgets()}*iterUserWidgets(){for(const d of this.tabBar.titles)yield d.owner}*iterSelectedWidgets(){let d=this.tabBar.currentTitle;d&&(yield d.owner)}*iterTabBars(){yield this.tabBar}*iterHandles(){}findTabNode(d){return this.tabBar.titles.indexOf(d.title)!==-1?this:null}findSplitNode(d){return null}findFirstTabNode(){return this}hitTestTabNodes(d,u){return d<this._left||d>=this._left+this._width||u<this._top||u>=this._top+this._height?null:this}createConfig(){let d=this.tabBar.titles.map(p=>p.owner),u=this.tabBar.currentIndex;return{type:"tab-area",widgets:d,currentIndex:u}}holdAllSizes(){}fit(d,u){let p=0,g=0,C=1/0,M=1/0,y=u.get(this.tabBar),x=this.tabBar.currentTitle,S=x?u.get(x.owner):void 0,[I,w]=this.sizers;return y&&y.fit(),S&&S.fit(),y&&!y.isHidden?(p=Math.max(p,y.minWidth),g+=y.minHeight,I.minSize=y.minHeight,I.maxSize=y.maxHeight):(I.minSize=0,I.maxSize=0),S&&!S.isHidden?(p=Math.max(p,S.minWidth),g+=S.minHeight,w.minSize=S.minHeight,w.maxSize=1/0):(w.minSize=0,w.maxSize=1/0),{minWidth:p,minHeight:g,maxWidth:C,maxHeight:M}}update(d,u,p,g,C,M){this._top=u,this._left=d,this._width=p,this._height=g;let y=M.get(this.tabBar),x=this.tabBar.currentTitle,S=x?M.get(x.owner):void 0;if(Z.calc(this.sizers,g),y&&!y.isHidden){let I=this.sizers[0].size;y.update(d,u,p,I),u+=I}if(S&&!S.isHidden){let I=this.sizers[1].size;S.update(d,u,p,I)}}}n.TabLayoutNode=s;class r{constructor(d){this.parent=null,this.normalized=!1,this.children=[],this.sizers=[],this.handles=[],this.orientation=d}*iterAllWidgets(){for(const d of this.children)yield*d.iterAllWidgets()}*iterUserWidgets(){for(const d of this.children)yield*d.iterUserWidgets()}*iterSelectedWidgets(){for(const d of this.children)yield*d.iterSelectedWidgets()}*iterTabBars(){for(const d of this.children)yield*d.iterTabBars()}*iterHandles(){yield*this.handles;for(const d of this.children)yield*d.iterHandles()}findTabNode(d){for(let u=0,p=this.children.length;u<p;++u){let g=this.children[u].findTabNode(d);if(g)return g}return null}findSplitNode(d){let u=this.handles.indexOf(d);if(u!==-1)return{index:u,node:this};for(let p=0,g=this.children.length;p<g;++p){let C=this.children[p].findSplitNode(d);if(C)return C}return null}findFirstTabNode(){return this.children.length===0?null:this.children[0].findFirstTabNode()}hitTestTabNodes(d,u){for(let p=0,g=this.children.length;p<g;++p){let C=this.children[p].hitTestTabNodes(d,u);if(C)return C}return null}createConfig(){let d=this.orientation,u=this.createNormalizedSizes(),p=this.children.map(g=>g.createConfig());return{type:"split-area",orientation:d,children:p,sizes:u}}syncHandles(){this.handles.forEach((d,u)=>{d.setAttribute("data-orientation",this.orientation),u===this.handles.length-1?d.classList.add("lm-mod-hidden"):d.classList.remove("lm-mod-hidden")})}holdSizes(){for(const d of this.sizers)d.sizeHint=d.size}holdAllSizes(){for(const d of this.children)d.holdAllSizes();this.holdSizes()}normalizeSizes(){let d=this.sizers.length;if(d===0)return;this.holdSizes();let u=this.sizers.reduce((p,g)=>p+g.sizeHint,0);if(u===0)for(const p of this.sizers)p.size=p.sizeHint=1/d;else for(const p of this.sizers)p.size=p.sizeHint/=u;this.normalized=!0}createNormalizedSizes(){let d=this.sizers.length;if(d===0)return[];let u=this.sizers.map(g=>g.size),p=u.reduce((g,C)=>g+C,0);if(p===0)for(let g=u.length-1;g>-1;g--)u[g]=1/d;else for(let g=u.length-1;g>-1;g--)u[g]/=p;return u}fit(d,u){let p=this.orientation==="horizontal",g=Math.max(0,this.children.length-1)*d,C=p?g:0,M=p?0:g,y=1/0,x=1/0;for(let S=0,I=this.children.length;S<I;++S){let w=this.children[S].fit(d,u);p?(M=Math.max(M,w.minHeight),C+=w.minWidth,this.sizers[S].minSize=w.minWidth):(C=Math.max(C,w.minWidth),M+=w.minHeight,this.sizers[S].minSize=w.minHeight)}return{minWidth:C,minHeight:M,maxWidth:y,maxHeight:x}}update(d,u,p,g,C,M){let y=this.orientation==="horizontal",x=Math.max(0,this.children.length-1)*C,S=Math.max(0,(y?p:g)-x);if(this.normalized){for(const I of this.sizers)I.sizeHint*=S;this.normalized=!1}Z.calc(this.sizers,S);for(let I=0,w=this.children.length;I<w;++I){let v=this.children[I],_=this.sizers[I].size,b=this.handles[I].style;y?(v.update(d,u,_,g,C,M),d+=_,b.top=`${u}px`,b.left=`${d}px`,b.width=`${C}px`,b.height=`${g}px`,d+=C):(v.update(d,u,p,_,C,M),u+=_,b.top=`${u}px`,b.left=`${d}px`,b.width=`${p}px`,b.height=`${C}px`,u+=C)}}}n.SplitLayoutNode=r;function l(f,d){f.node.setAttribute("role","tabpanel");let u=d.renderer;if(u instanceof Ae.Renderer){let p=u.createTabKey({title:f.title,current:!1,zIndex:0});f.node.setAttribute("aria-labelledby",p)}}n.addAria=l;function o(f){f.node.removeAttribute("role"),f.node.removeAttribute("aria-labelledby")}n.removeAria=o;function a(f,d){if(f.widgets.length===0)return null;let u=[];for(const g of f.widgets)d.has(g)||(d.add(g),u.push(g));if(u.length===0)return null;let p=f.currentIndex;return p!==-1&&(p<0||p>=u.length)&&(p=0),{type:"tab-area",widgets:u,currentIndex:p}}function c(f,d){let u=f.orientation,p=[],g=[];for(let C=0,M=f.children.length;C<M;++C){let y=t(f.children[C],d);y&&(y.type==="tab-area"||y.orientation!==u?(p.push(y),g.push(Math.abs(f.sizes[C]||0))):(p.push(...y.children),g.push(...y.sizes)))}return p.length===0?null:p.length===1?p[0]:{type:"split-area",orientation:u,children:p,sizes:g}}function h(f,d,u){let p=d.createTabBar(u);for(const g of f.widgets)g.hide(),p.addTab(g.title),n.addAria(g,p);return p.currentIndex=f.currentIndex,new s(p)}function m(f,d,u){let p=new r(f.orientation);return f.children.forEach((g,C)=>{let M=i(g,d,u),y=e(f.sizes[C]),x=d.createHandle();p.children.push(M),p.handles.push(x),p.sizers.push(y),M.parent=p}),p.syncHandles(),p.normalizeSizes(),p}})(q||(q={}));class Ee extends z{constructor(e={}){super(),this._drag=null,this._tabsMovable=!0,this._tabsConstrained=!1,this._addButtonEnabled=!1,this._pressData=null,this._layoutModified=new O(this),this._addRequested=new O(this),this.addClass("lm-DockPanel"),this._document=e.document||document,this._mode=e.mode||"multiple-document",this._renderer=e.renderer||Ee.defaultRenderer,this._edges=e.edges||F.DEFAULT_EDGES,e.tabsMovable!==void 0&&(this._tabsMovable=e.tabsMovable),e.tabsConstrained!==void 0&&(this._tabsConstrained=e.tabsConstrained),e.addButtonEnabled!==void 0&&(this._addButtonEnabled=e.addButtonEnabled),this.dataset.mode=this._mode;let t={createTabBar:()=>this._createTabBar(),createHandle:()=>this._createHandle()};this.layout=new Ki({document:this._document,renderer:t,spacing:e.spacing,hiddenMode:e.hiddenMode}),this.overlay=e.overlay||new Ee.Overlay,this.node.appendChild(this.overlay.node)}dispose(){this._releaseMouse(),this.overlay.hide(0),this._drag&&this._drag.dispose(),super.dispose()}get hiddenMode(){return this.layout.hiddenMode}set hiddenMode(e){this.layout.hiddenMode=e}get layoutModified(){return this._layoutModified}get addRequested(){return this._addRequested}get renderer(){return this.layout.renderer}get spacing(){return this.layout.spacing}set spacing(e){this.layout.spacing=e}get mode(){return this._mode}set mode(e){if(this._mode===e)return;this._mode=e,this.dataset.mode=e;let t=this.layout;switch(e){case"multiple-document":for(const i of t.tabBars())i.show();break;case"single-document":t.restoreLayout(F.createSingleDocumentConfig(this));break;default:throw"unreachable"}T.postMessage(this,F.LayoutModified)}get tabsMovable(){return this._tabsMovable}set tabsMovable(e){this._tabsMovable=e;for(const t of this.tabBars())t.tabsMovable=e}get tabsConstrained(){return this._tabsConstrained}set tabsConstrained(e){this._tabsConstrained=e}get addButtonEnabled(){return this._addButtonEnabled}set addButtonEnabled(e){this._addButtonEnabled=e;for(const t of this.tabBars())t.addButtonEnabled=e}get isEmpty(){return this.layout.isEmpty}*widgets(){yield*this.layout.widgets()}*selectedWidgets(){yield*this.layout.selectedWidgets()}*tabBars(){yield*this.layout.tabBars()}*handles(){yield*this.layout.handles()}selectWidget(e){let t=ht(this.tabBars(),i=>i.titles.indexOf(e.title)!==-1);if(!t)throw new Error("Widget is not contained in the dock panel.");t.currentTitle=e.title}activateWidget(e){this.selectWidget(e),e.activate()}saveLayout(){return this.layout.saveLayout()}restoreLayout(e){this._mode="multiple-document",this.layout.restoreLayout(e),(Y.IS_EDGE||Y.IS_IE)&&T.flush(),T.postMessage(this,F.LayoutModified)}addWidget(e,t={}){this._mode==="single-document"?this.layout.addWidget(e):this.layout.addWidget(e,t),T.postMessage(this,F.LayoutModified)}processMessage(e){e.type==="layout-modified"?this._layoutModified.emit(void 0):super.processMessage(e)}handleEvent(e){switch(e.type){case"lm-dragenter":this._evtDragEnter(e);break;case"lm-dragleave":this._evtDragLeave(e);break;case"lm-dragover":this._evtDragOver(e);break;case"lm-drop":this._evtDrop(e);break;case"pointerdown":this._evtPointerDown(e);break;case"pointermove":this._evtPointerMove(e);break;case"pointerup":this._evtPointerUp(e);break;case"keydown":this._evtKeyDown(e);break;case"contextmenu":e.preventDefault(),e.stopPropagation();break}}onBeforeAttach(e){this.node.addEventListener("lm-dragenter",this),this.node.addEventListener("lm-dragleave",this),this.node.addEventListener("lm-dragover",this),this.node.addEventListener("lm-drop",this),this.node.addEventListener("pointerdown",this)}onAfterDetach(e){this.node.removeEventListener("lm-dragenter",this),this.node.removeEventListener("lm-dragleave",this),this.node.removeEventListener("lm-dragover",this),this.node.removeEventListener("lm-drop",this),this.node.removeEventListener("pointerdown",this),this._releaseMouse()}onChildAdded(e){F.isGeneratedTabBarProperty.get(e.child)||e.child.addClass("lm-DockPanel-widget")}onChildRemoved(e){F.isGeneratedTabBarProperty.get(e.child)||(e.child.removeClass("lm-DockPanel-widget"),T.postMessage(this,F.LayoutModified))}_evtDragEnter(e){e.mimeData.hasData("application/vnd.lumino.widget-factory")&&(e.preventDefault(),e.stopPropagation())}_evtDragLeave(e){e.preventDefault(),!(this._tabsConstrained&&e.source!==this)&&(e.stopPropagation(),this.overlay.hide(1))}_evtDragOver(e){e.preventDefault(),this._tabsConstrained&&e.source!==this||this._showOverlay(e.clientX,e.clientY)==="invalid"?e.dropAction="none":(e.stopPropagation(),e.dropAction=e.proposedAction)}_evtDrop(e){if(e.preventDefault(),this.overlay.hide(0),e.proposedAction==="none"){e.dropAction="none";return}let{clientX:t,clientY:i}=e,{zone:s,target:r}=F.findDropTarget(this,t,i,this._edges);if(this._tabsConstrained&&e.source!==this||s==="invalid"){e.dropAction="none";return}let o=e.mimeData.getData("application/vnd.lumino.widget-factory");if(typeof o!="function"){e.dropAction="none";return}let a=o();if(!(a instanceof z)){e.dropAction="none";return}if(a.contains(this)){e.dropAction="none";return}let c=r?F.getDropRef(r.tabBar):null;switch(s){case"root-all":this.addWidget(a);break;case"root-top":this.addWidget(a,{mode:"split-top"});break;case"root-left":this.addWidget(a,{mode:"split-left"});break;case"root-right":this.addWidget(a,{mode:"split-right"});break;case"root-bottom":this.addWidget(a,{mode:"split-bottom"});break;case"widget-all":this.addWidget(a,{mode:"tab-after",ref:c});break;case"widget-top":this.addWidget(a,{mode:"split-top",ref:c});break;case"widget-left":this.addWidget(a,{mode:"split-left",ref:c});break;case"widget-right":this.addWidget(a,{mode:"split-right",ref:c});break;case"widget-bottom":this.addWidget(a,{mode:"split-bottom",ref:c});break;case"widget-tab":this.addWidget(a,{mode:"tab-after",ref:c});break;default:throw"unreachable"}e.dropAction=e.proposedAction,e.stopPropagation(),this.activateWidget(a)}_evtKeyDown(e){e.preventDefault(),e.stopPropagation(),e.keyCode===27&&(this._releaseMouse(),T.postMessage(this,F.LayoutModified))}_evtPointerDown(e){if(e.button!==0)return;let t=this.layout,i=e.target,s=ht(t.handles(),h=>h.contains(i));if(!s)return;e.preventDefault(),e.stopPropagation(),this._document.addEventListener("keydown",this,!0),this._document.addEventListener("pointerup",this,!0),this._document.addEventListener("pointermove",this,!0),this._document.addEventListener("contextmenu",this,!0);let r=s.getBoundingClientRect(),l=e.clientX-r.left,o=e.clientY-r.top,a=window.getComputedStyle(s),c=K.overrideCursor(a.cursor,this._document);this._pressData={handle:s,deltaX:l,deltaY:o,override:c}}_evtPointerMove(e){if(!this._pressData)return;e.preventDefault(),e.stopPropagation();let t=this.node.getBoundingClientRect(),i=e.clientX-t.left-this._pressData.deltaX,s=e.clientY-t.top-this._pressData.deltaY;this.layout.moveHandle(this._pressData.handle,i,s)}_evtPointerUp(e){e.button===0&&(e.preventDefault(),e.stopPropagation(),this._releaseMouse(),T.postMessage(this,F.LayoutModified))}_releaseMouse(){this._pressData&&(this._pressData.override.dispose(),this._pressData=null,this._document.removeEventListener("keydown",this,!0),this._document.removeEventListener("pointerup",this,!0),this._document.removeEventListener("pointermove",this,!0),this._document.removeEventListener("contextmenu",this,!0))}_showOverlay(e,t){let{zone:i,target:s}=F.findDropTarget(this,e,t,this._edges);if(i==="invalid")return this.overlay.hide(100),i;let r,l,o,a,c=H.boxSizing(this.node),h=this.node.getBoundingClientRect();switch(i){case"root-all":r=c.paddingTop,l=c.paddingLeft,o=c.paddingRight,a=c.paddingBottom;break;case"root-top":r=c.paddingTop,l=c.paddingLeft,o=c.paddingRight,a=h.height*F.GOLDEN_RATIO;break;case"root-left":r=c.paddingTop,l=c.paddingLeft,o=h.width*F.GOLDEN_RATIO,a=c.paddingBottom;break;case"root-right":r=c.paddingTop,l=h.width*F.GOLDEN_RATIO,o=c.paddingRight,a=c.paddingBottom;break;case"root-bottom":r=h.height*F.GOLDEN_RATIO,l=c.paddingLeft,o=c.paddingRight,a=c.paddingBottom;break;case"widget-all":r=s.top,l=s.left,o=s.right,a=s.bottom;break;case"widget-top":r=s.top,l=s.left,o=s.right,a=s.bottom+s.height/2;break;case"widget-left":r=s.top,l=s.left,o=s.right+s.width/2,a=s.bottom;break;case"widget-right":r=s.top,l=s.left+s.width/2,o=s.right,a=s.bottom;break;case"widget-bottom":r=s.top+s.height/2,l=s.left,o=s.right,a=s.bottom;break;case"widget-tab":{const m=s.tabBar.node.getBoundingClientRect().height;r=s.top,l=s.left,o=s.right,a=s.bottom+s.height-m;break}default:throw"unreachable"}return this.overlay.show({top:r,left:l,right:o,bottom:a}),i}_createTabBar(){let e=this._renderer.createTabBar(this._document);return F.isGeneratedTabBarProperty.set(e,!0),this._mode==="single-document"&&e.hide(),e.tabsMovable=this._tabsMovable,e.allowDeselect=!1,e.addButtonEnabled=this._addButtonEnabled,e.removeBehavior="select-previous-tab",e.insertBehavior="select-tab-if-needed",e.tabMoved.connect(this._onTabMoved,this),e.currentChanged.connect(this._onCurrentChanged,this),e.tabCloseRequested.connect(this._onTabCloseRequested,this),e.tabDetachRequested.connect(this._onTabDetachRequested,this),e.tabActivateRequested.connect(this._onTabActivateRequested,this),e.addRequested.connect(this._onTabAddRequested,this),e}_createHandle(){return this._renderer.createHandle()}_onTabMoved(){T.postMessage(this,F.LayoutModified)}_onCurrentChanged(e,t){let{previousTitle:i,currentTitle:s}=t;i&&i.owner.hide(),s&&s.owner.show(),(Y.IS_EDGE||Y.IS_IE)&&T.flush(),T.postMessage(this,F.LayoutModified)}_onTabAddRequested(e){this._addRequested.emit(e)}_onTabActivateRequested(e,t){t.title.owner.activate()}_onTabCloseRequested(e,t){t.title.owner.close()}_onTabDetachRequested(e,t){if(this._drag)return;e.releaseMouse();let{title:i,tab:s,clientX:r,clientY:l,offset:o}=t,a=new Wi,c=()=>i.owner;a.setData("application/vnd.lumino.widget-factory",c);let h=s.cloneNode(!0);o&&(h.style.top=`-${o.y}px`,h.style.left=`-${o.x}px`),this._drag=new K({document:this._document,mimeData:a,dragImage:h,proposedAction:"move",supportedActions:"move",source:this}),s.classList.add("lm-mod-hidden");let m=()=>{this._drag=null,s.classList.remove("lm-mod-hidden")};this._drag.start(r,l).then(m)}}(function(n){class e{constructor(){this._timer=-1,this._hidden=!0,this.node=document.createElement("div"),this.node.classList.add("lm-DockPanel-overlay"),this.node.classList.add("lm-mod-hidden"),this.node.style.position="absolute",this.node.style.contain="strict"}show(s){let r=this.node.style;r.top=`${s.top}px`,r.left=`${s.left}px`,r.right=`${s.right}px`,r.bottom=`${s.bottom}px`,clearTimeout(this._timer),this._timer=-1,this._hidden&&(this._hidden=!1,this.node.classList.remove("lm-mod-hidden"))}hide(s){if(!this._hidden){if(s<=0){clearTimeout(this._timer),this._timer=-1,this._hidden=!0,this.node.classList.add("lm-mod-hidden");return}this._timer===-1&&(this._timer=window.setTimeout(()=>{this._timer=-1,this._hidden=!0,this.node.classList.add("lm-mod-hidden")},s))}}}n.Overlay=e;class t{createTabBar(s){let r=new Ae({document:s});return r.addClass("lm-DockPanel-tabBar"),r}createHandle(){let s=document.createElement("div");return s.className="lm-DockPanel-handle",s}}n.Renderer=t,n.defaultRenderer=new t})(Ee||(Ee={}));var F;(function(n){n.GOLDEN_RATIO=.618,n.DEFAULT_EDGES={top:12,right:40,bottom:40,left:40},n.LayoutModified=new Ne("layout-modified"),n.isGeneratedTabBarProperty=new ie({name:"isGeneratedTabBar",create:()=>!1});function e(s){if(s.isEmpty)return{main:null};let r=Array.from(s.widgets()),l=s.selectedWidgets().next().value,o=l?r.indexOf(l):-1;return{main:{type:"tab-area",widgets:r,currentIndex:o}}}n.createSingleDocumentConfig=e;function t(s,r,l,o){if(!H.hitTest(s.node,r,l))return{zone:"invalid",target:null};let a=s.layout;if(a.isEmpty)return{zone:"root-all",target:null};if(s.mode==="multiple-document"){let y=s.node.getBoundingClientRect(),x=r-y.left+1,S=l-y.top+1,I=y.right-r,w=y.bottom-l;switch(Math.min(S,I,w,x)){case S:if(S<o.top)return{zone:"root-top",target:null};break;case I:if(I<o.right)return{zone:"root-right",target:null};break;case w:if(w<o.bottom)return{zone:"root-bottom",target:null};break;case x:if(x<o.left)return{zone:"root-left",target:null};break;default:throw"unreachable"}}let c=a.hitTestTabAreas(r,l);if(!c)return{zone:"invalid",target:null};if(s.mode==="single-document")return{zone:"widget-all",target:c};let h=c.x-c.left+1,m=c.y-c.top+1,f=c.left+c.width-c.x,d=c.top+c.height-c.y;const u=c.tabBar.node.getBoundingClientRect().height;if(m<u)return{zone:"widget-tab",target:c};let p=Math.round(c.width/3),g=Math.round(c.height/3);if(h>p&&f>p&&m>g&&d>g)return{zone:"widget-all",target:c};h/=p,m/=g,f/=p,d/=g;let C=Math.min(h,m,f,d),M;switch(C){case h:M="widget-left";break;case m:M="widget-top";break;case f:M="widget-right";break;case d:M="widget-bottom";break;default:throw"unreachable"}return{zone:M,target:c}}n.findDropTarget=t;function i(s){return s.titles.length===0?null:s.currentTitle?s.currentTitle.owner:s.titles[s.titles.length-1].owner}n.getDropRef=i})(F||(F={}));class xe extends Me{constructor(e={}){super(e),this._dirty=!1,this._rowSpacing=4,this._columnSpacing=4,this._items=[],this._rowStarts=[],this._columnStarts=[],this._rowSizers=[new ge],this._columnSizers=[new ge],this._box=null,e.rowCount!==void 0&&V.reallocSizers(this._rowSizers,e.rowCount),e.columnCount!==void 0&&V.reallocSizers(this._columnSizers,e.columnCount),e.rowSpacing!==void 0&&(this._rowSpacing=V.clampValue(e.rowSpacing)),e.columnSpacing!==void 0&&(this._columnSpacing=V.clampValue(e.columnSpacing))}dispose(){for(const e of this._items){let t=e.widget;e.dispose(),t.dispose()}this._box=null,this._items.length=0,this._rowStarts.length=0,this._rowSizers.length=0,this._columnStarts.length=0,this._columnSizers.length=0,super.dispose()}get rowCount(){return this._rowSizers.length}set rowCount(e){e!==this.rowCount&&(V.reallocSizers(this._rowSizers,e),this.parent&&this.parent.fit())}get columnCount(){return this._columnSizers.length}set columnCount(e){e!==this.columnCount&&(V.reallocSizers(this._columnSizers,e),this.parent&&this.parent.fit())}get rowSpacing(){return this._rowSpacing}set rowSpacing(e){e=V.clampValue(e),this._rowSpacing!==e&&(this._rowSpacing=e,this.parent&&this.parent.fit())}get columnSpacing(){return this._columnSpacing}set columnSpacing(e){e=V.clampValue(e),this._columnSpacing!==e&&(this._columnSpacing=e,this.parent&&this.parent.fit())}rowStretch(e){let t=this._rowSizers[e];return t?t.stretch:-1}setRowStretch(e,t){let i=this._rowSizers[e];i&&(t=V.clampValue(t),i.stretch!==t&&(i.stretch=t,this.parent&&this.parent.update()))}columnStretch(e){let t=this._columnSizers[e];return t?t.stretch:-1}setColumnStretch(e,t){let i=this._columnSizers[e];i&&(t=V.clampValue(t),i.stretch!==t&&(i.stretch=t,this.parent&&this.parent.update()))}*[Symbol.iterator](){for(const e of this._items)yield e.widget}addWidget(e){E.findFirstIndex(this._items,i=>i.widget===e)===-1&&(this._items.push(new qe(e)),this.parent&&this.attachWidget(e))}removeWidget(e){let t=E.findFirstIndex(this._items,s=>s.widget===e);if(t===-1)return;let i=E.removeAt(this._items,t);this.parent&&this.detachWidget(e),i.dispose()}init(){super.init();for(const e of this)this.attachWidget(e)}attachWidget(e){this.parent.isAttached&&T.sendMessage(e,z.Msg.BeforeAttach),this.parent.node.appendChild(e.node),this.parent.isAttached&&T.sendMessage(e,z.Msg.AfterAttach),this.parent.fit()}detachWidget(e){this.parent.isAttached&&T.sendMessage(e,z.Msg.BeforeDetach),this.parent.node.removeChild(e.node),this.parent.isAttached&&T.sendMessage(e,z.Msg.AfterDetach),this.parent.fit()}onBeforeShow(e){super.onBeforeShow(e),this.parent.update()}onBeforeAttach(e){super.onBeforeAttach(e),this.parent.fit()}onChildShown(e){this.parent.fit()}onChildHidden(e){this.parent.fit()}onResize(e){this.parent.isVisible&&this._update(e.width,e.height)}onUpdateRequest(e){this.parent.isVisible&&this._update(-1,-1)}onFitRequest(e){this.parent.isAttached&&this._fit()}_fit(){for(let a=0,c=this.rowCount;a<c;++a)this._rowSizers[a].minSize=0;for(let a=0,c=this.columnCount;a<c;++a)this._columnSizers[a].minSize=0;let e=this._items.filter(a=>!a.isHidden);for(let a=0,c=e.length;a<c;++a)e[a].fit();let t=this.rowCount-1,i=this.columnCount-1;e.sort(V.rowSpanCmp);for(let a=0,c=e.length;a<c;++a){let h=e[a],m=xe.getCellConfig(h.widget),f=Math.min(m.row,t),d=Math.min(m.row+m.rowSpan-1,t);V.distributeMin(this._rowSizers,f,d,h.minHeight)}e.sort(V.columnSpanCmp);for(let a=0,c=e.length;a<c;++a){let h=e[a],m=xe.getCellConfig(h.widget),f=Math.min(m.column,i),d=Math.min(m.column+m.columnSpan-1,i);V.distributeMin(this._columnSizers,f,d,h.minWidth)}if(this.fitPolicy==="set-no-constraint"){T.sendMessage(this.parent,z.Msg.UpdateRequest);return}let s=t*this._rowSpacing,r=i*this._columnSpacing;for(let a=0,c=this.rowCount;a<c;++a)s+=this._rowSizers[a].minSize;for(let a=0,c=this.columnCount;a<c;++a)r+=this._columnSizers[a].minSize;let l=this._box=H.boxSizing(this.parent.node);r+=l.horizontalSum,s+=l.verticalSum;let o=this.parent.node.style;o.minWidth=`${r}px`,o.minHeight=`${s}px`,this._dirty=!0,this.parent.parent&&T.sendMessage(this.parent.parent,z.Msg.FitRequest),this._dirty&&T.sendMessage(this.parent,z.Msg.UpdateRequest)}_update(e,t){this._dirty=!1,e<0&&(e=this.parent.node.offsetWidth),t<0&&(t=this.parent.node.offsetHeight),this._box||(this._box=H.boxSizing(this.parent.node));let i=this._box.paddingTop,s=this._box.paddingLeft,r=e-this._box.horizontalSum,l=t-this._box.verticalSum,o=this.rowCount-1,a=this.columnCount-1,c=o*this._rowSpacing,h=a*this._columnSpacing;Z.calc(this._rowSizers,Math.max(0,l-c)),Z.calc(this._columnSizers,Math.max(0,r-h));for(let m=0,f=i,d=this.rowCount;m<d;++m)this._rowStarts[m]=f,f+=this._rowSizers[m].size+this._rowSpacing;for(let m=0,f=s,d=this.columnCount;m<d;++m)this._columnStarts[m]=f,f+=this._columnSizers[m].size+this._columnSpacing;for(let m=0,f=this._items.length;m<f;++m){let d=this._items[m];if(d.isHidden)continue;let u=xe.getCellConfig(d.widget),p=Math.min(u.row,o),g=Math.min(u.column,a),C=Math.min(u.row+u.rowSpan-1,o),M=Math.min(u.column+u.columnSpan-1,a),y=this._columnStarts[g],x=this._rowStarts[p],S=this._columnStarts[M]+this._columnSizers[M].size-y,I=this._rowStarts[C]+this._rowSizers[C].size-x;d.update(y,x,S,I)}}}(function(n){function e(i){return V.cellConfigProperty.get(i)}n.getCellConfig=e;function t(i,s){V.cellConfigProperty.set(i,V.normalizeConfig(s))}n.setCellConfig=t})(xe||(xe={}));var V;(function(n){n.cellConfigProperty=new ie({name:"cellConfig",create:()=>({row:0,column:0,rowSpan:1,columnSpan:1}),changed:o});function e(a){let c=Math.max(0,Math.floor(a.row||0)),h=Math.max(0,Math.floor(a.column||0)),m=Math.max(1,Math.floor(a.rowSpan||0)),f=Math.max(1,Math.floor(a.columnSpan||0));return{row:c,column:h,rowSpan:m,columnSpan:f}}n.normalizeConfig=e;function t(a){return Math.max(0,Math.floor(a))}n.clampValue=t;function i(a,c){let h=n.cellConfigProperty.get(a.widget),m=n.cellConfigProperty.get(c.widget);return h.rowSpan-m.rowSpan}n.rowSpanCmp=i;function s(a,c){let h=n.cellConfigProperty.get(a.widget),m=n.cellConfigProperty.get(c.widget);return h.columnSpan-m.columnSpan}n.columnSpanCmp=s;function r(a,c){for(c=Math.max(1,Math.floor(c));a.length<c;)a.push(new ge);a.length>c&&(a.length=c)}n.reallocSizers=r;function l(a,c,h,m){if(h<c)return;if(c===h){let u=a[c];u.minSize=Math.max(u.minSize,m);return}let f=0;for(let u=c;u<=h;++u)f+=a[u].minSize;if(f>=m)return;let d=(m-f)/(h-c+1);for(let u=c;u<=h;++u)a[u].minSize+=d}n.distributeMin=l;function o(a){a.parent&&a.parent.layout instanceof xe&&a.parent.fit()}})(V||(V={}));class Ze extends z{constructor(e={}){super({node:Qe.createNode()}),this._activeIndex=-1,this._tabFocusIndex=0,this._menus=[],this._childMenu=null,this._overflowMenu=null,this._menuItemSizes=[],this._overflowIndex=-1,this.addClass("lm-MenuBar"),this.setFlag(z.Flag.DisallowLayout),this.renderer=e.renderer||Ze.defaultRenderer,this._forceItemsPosition=e.forceItemsPosition||{forceX:!0,forceY:!0},this._overflowMenuOptions=e.overflowMenuOptions||{isVisible:!0}}dispose(){this._closeChildMenu(),this._menus.length=0,super.dispose()}get childMenu(){return this._childMenu}get overflowIndex(){return this._overflowIndex}get overflowMenu(){return this._overflowMenu}get contentNode(){return this.node.getElementsByClassName("lm-MenuBar-content")[0]}get activeMenu(){return this._menus[this._activeIndex]||null}set activeMenu(e){this.activeIndex=e?this._menus.indexOf(e):-1}get activeIndex(){return this._activeIndex}set activeIndex(e){(e<0||e>=this._menus.length)&&(e=-1),e>-1&&this._menus[e].items.length===0&&(e=-1),this._activeIndex!==e&&(this._activeIndex=e,this.update())}get menus(){return this._menus}openActiveMenu(){this._activeIndex!==-1&&(this._openChildMenu(),this._childMenu&&(this._childMenu.activeIndex=-1,this._childMenu.activateNextItem()))}addMenu(e,t=!0){this.insertMenu(this._menus.length,e,t)}insertMenu(e,t,i=!0){this._closeChildMenu();let s=this._menus.indexOf(t),r=Math.max(0,Math.min(e,this._menus.length));if(s===-1){E.insert(this._menus,r,t),t.addClass("lm-MenuBar-menu"),t.aboutToClose.connect(this._onMenuAboutToClose,this),t.menuRequested.connect(this._onMenuMenuRequested,this),t.title.changed.connect(this._onTitleChanged,this),i&&this.update();return}r===this._menus.length&&r--,s!==r&&(E.move(this._menus,s,r),i&&this.update())}removeMenu(e,t=!0){this.removeMenuAt(this._menus.indexOf(e),t)}removeMenuAt(e,t=!0){this._closeChildMenu();let i=E.removeAt(this._menus,e);i&&(i.aboutToClose.disconnect(this._onMenuAboutToClose,this),i.menuRequested.disconnect(this._onMenuMenuRequested,this),i.title.changed.disconnect(this._onTitleChanged,this),i.removeClass("lm-MenuBar-menu"),t&&this.update())}clearMenus(){if(this._menus.length!==0){this._closeChildMenu();for(let e of this._menus)e.aboutToClose.disconnect(this._onMenuAboutToClose,this),e.menuRequested.disconnect(this._onMenuMenuRequested,this),e.title.changed.disconnect(this._onTitleChanged,this),e.removeClass("lm-MenuBar-menu");this._menus.length=0,this.update()}}handleEvent(e){switch(e.type){case"keydown":this._evtKeyDown(e);break;case"mousedown":this._evtMouseDown(e);break;case"mousemove":this._evtMouseMove(e);break;case"focusout":this._evtFocusOut(e);break;case"contextmenu":e.preventDefault(),e.stopPropagation();break}}onBeforeAttach(e){this.node.addEventListener("keydown",this),this.node.addEventListener("mousedown",this),this.node.addEventListener("mousemove",this),this.node.addEventListener("focusout",this),this.node.addEventListener("contextmenu",this)}onAfterDetach(e){this.node.removeEventListener("keydown",this),this.node.removeEventListener("mousedown",this),this.node.removeEventListener("mousemove",this),this.node.removeEventListener("focusout",this),this.node.removeEventListener("contextmenu",this),this._closeChildMenu()}onActivateRequest(e){this.isAttached&&this._focusItemAt(0)}onResize(e){this.update(),super.onResize(e)}onUpdateRequest(e){var t;let i=this._menus,s=this.renderer,r=this._activeIndex,l=this._tabFocusIndex>=0&&this._tabFocusIndex<i.length?this._tabFocusIndex:0,o=this._overflowIndex>-1?this._overflowIndex:i.length,a=0,c=!1;o=this._overflowMenu!==null?o-1:o;let h=new Array(o);for(let m=0;m<o;++m)h[m]=s.renderItem({title:i[m].title,active:m===r,tabbable:m===l,disabled:i[m].items.length===0,onfocus:()=>{this._tabFocusIndex=m,this.activeIndex=m}}),a+=this._menuItemSizes[m],i[m].title.label===this._overflowMenuOptions.title&&(c=!0,o--);if(this._overflowMenuOptions.isVisible){if(this._overflowIndex>-1&&!c){if(this._overflowMenu===null){const m=(t=this._overflowMenuOptions.title)!==null&&t!==void 0?t:"...";this._overflowMenu=new _e({commands:new me}),this._overflowMenu.title.label=m,this._overflowMenu.title.mnemonic=0,this.addMenu(this._overflowMenu,!1)}for(let m=i.length-2;m>=o;m--){const f=this.menus[m];f.title.mnemonic=0,this._overflowMenu.insertItem(0,{type:"submenu",submenu:f}),this.removeMenu(f,!1)}h[o]=s.renderItem({title:this._overflowMenu.title,active:o===r&&i[o].items.length!==0,tabbable:o===l,disabled:i[o].items.length===0,onfocus:()=>{this._tabFocusIndex=o,this.activeIndex=o}}),o++}else if(this._overflowMenu!==null){let m=this._overflowMenu.items,f=this.node.offsetWidth,d=this._overflowMenu.items.length;for(let u=0;u<d;++u){let p=i.length-1-u;if(f-a>this._menuItemSizes[p]){let g=m[0].submenu;this._overflowMenu.removeItemAt(0),this.insertMenu(o,g,!1),h[o]=s.renderItem({title:g.title,active:!1,tabbable:o===l,disabled:i[o].items.length===0,onfocus:()=>{this._tabFocusIndex=o,this.activeIndex=o}}),o++}}this._overflowMenu.items.length===0&&(this.removeMenu(this._overflowMenu,!1),h.pop(),this._overflowMenu=null,this._overflowIndex=-1)}}fe.render(h,this.contentNode),this._updateOverflowIndex()}_updateOverflowIndex(){if(!this._overflowMenuOptions.isVisible)return;const e=this.contentNode.childNodes;let t=this.node.offsetWidth,i=0,s=-1,r=e.length;if(this._menuItemSizes.length==0)for(let l=0;l<r;l++){let o=e[l];i+=o.offsetWidth,this._menuItemSizes.push(o.offsetWidth),i>t&&s===-1&&(s=l)}else for(let l=0;l<this._menuItemSizes.length;l++)if(i+=this._menuItemSizes[l],i>t){s=l;break}this._overflowIndex=s}_evtKeyDown(e){let t=e.keyCode;if(t===9){this.activeIndex=-1;return}if(e.preventDefault(),e.stopPropagation(),t===13||t===32||t===38||t===40){if(this.activeIndex=this._tabFocusIndex,this.activeIndex!==this._tabFocusIndex)return;this.openActiveMenu();return}if(t===27){this._closeChildMenu(),this._focusItemAt(this.activeIndex);return}if(t===37||t===39){let l=t===37?-1:1,o=this._tabFocusIndex+l,a=this._menus.length;for(let c=0;c<a;c++){let h=(a+o+l*c)%a;if(this._menus[h].items.length){this._focusItemAt(h);return}}return}let i=Ue().keyForKeydownEvent(e);if(!i)return;let s=this._activeIndex+1,r=Qe.findMnemonic(this._menus,i,s);r.index!==-1&&!r.multiple?(this.activeIndex=r.index,this.openActiveMenu()):r.index!==-1?(this.activeIndex=r.index,this._focusItemAt(this.activeIndex)):r.auto!==-1&&(this.activeIndex=r.auto,this._focusItemAt(this.activeIndex))}_evtMouseDown(e){if(!H.hitTest(this.node,e.clientX,e.clientY))return;e.stopPropagation(),e.stopImmediatePropagation();let t=E.findFirstIndex(this.contentNode.children,i=>H.hitTest(i,e.clientX,e.clientY));if(t===-1){this._closeChildMenu();return}if(e.button===0)if(this._childMenu)this._closeChildMenu(),this.activeIndex=t;else{e.preventDefault();const i=this._positionForMenu(t);_e.saveWindowData(),this.activeIndex=t,this._openChildMenu(i)}}_evtMouseMove(e){let t=E.findFirstIndex(this.contentNode.children,s=>H.hitTest(s,e.clientX,e.clientY));if(t===this._activeIndex||t===-1&&this._childMenu)return;const i=t>=0&&this._childMenu?this._positionForMenu(t):null;_e.saveWindowData(),this.activeIndex=t,i&&this._openChildMenu(i)}_positionForMenu(e){let t=this.contentNode.children[e],{left:i,bottom:s}=t.getBoundingClientRect();return{top:s,left:i}}_evtFocusOut(e){!this._childMenu&&!this.node.contains(e.relatedTarget)&&(this.activeIndex=-1)}_focusItemAt(e){const t=this.contentNode.childNodes[e];t&&t.focus()}_openChildMenu(e={}){let t=this.activeMenu;if(!t){this._closeChildMenu();return}let i=this._childMenu;if(i===t)return;this._childMenu=t,i?i.close():document.addEventListener("mousedown",this,!0),this._tabFocusIndex=this.activeIndex,T.sendMessage(this,z.Msg.UpdateRequest);let{left:s,top:r}=e;(typeof s>"u"||typeof r>"u")&&({left:s,top:r}=this._positionForMenu(this._activeIndex)),i||this.addClass("lm-mod-active"),t.items.length>0&&t.open(s,r,this._forceItemsPosition)}_closeChildMenu(){if(!this._childMenu)return;this.removeClass("lm-mod-active"),document.removeEventListener("mousedown",this,!0);let e=this._childMenu;this._childMenu=null,e.close(),this.activeIndex=-1}_onMenuAboutToClose(e){e===this._childMenu&&(this.removeClass("lm-mod-active"),document.removeEventListener("mousedown",this,!0),this._childMenu=null,this.activeIndex=-1)}_onMenuMenuRequested(e,t){if(e!==this._childMenu)return;let i=this._activeIndex,s=this._menus.length;switch(t){case"next":this.activeIndex=i===s-1?0:i+1;break;case"previous":this.activeIndex=i===0?s-1:i-1;break}this.openActiveMenu()}_onTitleChanged(){this.update()}}(function(n){class e{renderItem(i){let s=this.createItemClass(i),r=this.createItemDataset(i),l=this.createItemARIA(i);return R.li({className:s,dataset:r,...i.disabled?{}:{tabindex:i.tabbable?"0":"-1"},onfocus:i.onfocus,...l},this.renderIcon(i),this.renderLabel(i))}renderIcon(i){let s=this.createIconClass(i);return R.div({className:s},i.title.icon,i.title.iconLabel)}renderLabel(i){let s=this.formatLabel(i);return R.div({className:"lm-MenuBar-itemLabel"},s)}createItemClass(i){let s="lm-MenuBar-item";return i.title.className&&(s+=` ${i.title.className}`),i.active&&!i.disabled&&(s+=" lm-mod-active"),s}createItemDataset(i){return i.title.dataset}createItemARIA(i){return{role:"menuitem","aria-haspopup":"true","aria-disabled":i.disabled?"true":"false"}}createIconClass(i){let s="lm-MenuBar-itemIcon",r=i.title.iconClass;return r?`${s} ${r}`:s}formatLabel(i){let{label:s,mnemonic:r}=i.title;if(r<0||r>=s.length)return s;let l=s.slice(0,r),o=s.slice(r+1),a=s[r],c=R.span({className:"lm-MenuBar-itemMnemonic"},a);return[l,c,o]}}n.Renderer=e,n.defaultRenderer=new e})(Ze||(Ze={}));var Qe;(function(n){function e(){let i=document.createElement("div"),s=document.createElement("ul");return s.className="lm-MenuBar-content",i.appendChild(s),s.setAttribute("role","menubar"),i}n.createNode=e;function t(i,s,r){let l=-1,o=-1,a=!1,c=s.toUpperCase();for(let h=0,m=i.length;h<m;++h){let f=(h+r)%m,d=i[f].title;if(d.label.length===0)continue;let u=d.mnemonic;if(u>=0&&u<d.label.length){d.label[u].toUpperCase()===c&&(l===-1?l=f:a=!0);continue}o===-1&&d.label[0].toUpperCase()===c&&(o=f)}return{index:l,multiple:a,auto:o}}n.findMnemonic=t})(Qe||(Qe={}));var Tt;(function(n){function e(){let i=document.createElement("div"),s=document.createElement("div"),r=document.createElement("div"),l=document.createElement("div"),o=document.createElement("div");return s.className="lm-ScrollBar-button",r.className="lm-ScrollBar-button",s.dataset.action="decrement",r.dataset.action="increment",l.className="lm-ScrollBar-track",o.className="lm-ScrollBar-thumb",l.appendChild(o),i.appendChild(s),i.appendChild(l),i.appendChild(r),i}n.createNode=e;function t(i,s){return i.thumbNode.contains(s)?"thumb":i.trackNode.contains(s)?"track":i.decrementNode.contains(s)?"decrement":i.incrementNode.contains(s)?"increment":null}n.findPart=t})(Tt||(Tt={}));class Ui extends Je{constructor(e={}){super(e),this._dirty=!1,this._items=[],this._box=null,this._hiddenMode=e.hiddenMode!==void 0?e.hiddenMode:z.HiddenMode.Display}get hiddenMode(){return this._hiddenMode}set hiddenMode(e){this._hiddenMode!==e&&(this._hiddenMode=e,this.widgets.length>1&&this.widgets.forEach(t=>{t.hiddenMode=this._hiddenMode}))}dispose(){for(const e of this._items)e.dispose();this._box=null,this._items.length=0,super.dispose()}attachWidget(e,t){this._hiddenMode===z.HiddenMode.Scale&&this._items.length>0?(this._items.length===1&&(this.widgets[0].hiddenMode=z.HiddenMode.Scale),t.hiddenMode=z.HiddenMode.Scale):t.hiddenMode=z.HiddenMode.Display,E.insert(this._items,e,new qe(t)),this.parent.isAttached&&T.sendMessage(t,z.Msg.BeforeAttach),this.parent.node.appendChild(t.node),this.parent.isAttached&&T.sendMessage(t,z.Msg.AfterAttach),this.parent.fit()}moveWidget(e,t,i){E.move(this._items,e,t),this.parent.update()}detachWidget(e,t){let i=E.removeAt(this._items,e);this.parent.isAttached&&T.sendMessage(t,z.Msg.BeforeDetach),this.parent.node.removeChild(t.node),this.parent.isAttached&&T.sendMessage(t,z.Msg.AfterDetach),i.widget.node.style.zIndex="",this._hiddenMode===z.HiddenMode.Scale&&(t.hiddenMode=z.HiddenMode.Display,this._items.length===1&&(this._items[0].widget.hiddenMode=z.HiddenMode.Display)),i.dispose(),this.parent.fit()}onBeforeShow(e){super.onBeforeShow(e),this.parent.update()}onBeforeAttach(e){super.onBeforeAttach(e),this.parent.fit()}onChildShown(e){this.parent.fit()}onChildHidden(e){this.parent.fit()}onResize(e){this.parent.isVisible&&this._update(e.width,e.height)}onUpdateRequest(e){this.parent.isVisible&&this._update(-1,-1)}onFitRequest(e){this.parent.isAttached&&this._fit()}_fit(){let e=0,t=0;for(let r=0,l=this._items.length;r<l;++r){let o=this._items[r];o.isHidden||(o.fit(),e=Math.max(e,o.minWidth),t=Math.max(t,o.minHeight))}let i=this._box=H.boxSizing(this.parent.node);e+=i.horizontalSum,t+=i.verticalSum;let s=this.parent.node.style;s.minWidth=`${e}px`,s.minHeight=`${t}px`,this._dirty=!0,this.parent.parent&&T.sendMessage(this.parent.parent,z.Msg.FitRequest),this._dirty&&T.sendMessage(this.parent,z.Msg.UpdateRequest)}_update(e,t){this._dirty=!1;let i=0;for(let a=0,c=this._items.length;a<c;++a)i+=+!this._items[a].isHidden;if(i===0)return;e<0&&(e=this.parent.node.offsetWidth),t<0&&(t=this.parent.node.offsetHeight),this._box||(this._box=H.boxSizing(this.parent.node));let s=this._box.paddingTop,r=this._box.paddingLeft,l=e-this._box.horizontalSum,o=t-this._box.verticalSum;for(let a=0,c=this._items.length;a<c;++a){let h=this._items[a];h.isHidden||(h.widget.node.style.zIndex=`${a}`,h.update(r,s,l,o))}}}var Dt;(function(n){function e(t){return t.layout||new Ui}n.createLayout=e})(Dt||(Dt={}));var Lt;(function(n){function e(r){return i[r]}n.orientationFromPlacement=e;function t(r){return s[r]}n.directionFromPlacement=t;const i={top:"horizontal",left:"vertical",right:"vertical",bottom:"horizontal"},s={top:"top-to-bottom",left:"left-to-right",right:"right-to-left",bottom:"bottom-to-top"}})(Lt||(Lt={}));class Pe extends z{constructor(e,t,i=!0){super({node:Pe.createNode(e)}),this.id=e,this.name=t,this.closable=i,this.setFlag(z.Flag.DisallowLayout),this.addClass("content")}static createNode(e){const t=document.createElement("div");return t.setAttribute("id",e),t}onBeforeAttach(e){this.title.label=this.name,this.title.closable=this.closable,super.onBeforeAttach(e)}onCloseRequest(e){X.emit("lumino:deleted",this.id),super.onCloseRequest(e)}onAfterShow(e){X.emit(`lumino:show:${this.id}`),super.onAfterShow(e)}toJSON(){return{name:this.name,id:this.id,closable:this.closable}}static layoutReviver(e,t){return e==="widgets"?t.map(i=>new Pe(i.id,i.name,i.closable)):t}}function ji(n,e){return e instanceof Map?{_jsonType:"Map",_val:Array.from(e)}:e instanceof Set?{_jsonType:"Set",_val:Array.from(e)}:e}function Yi(n,e){return e?._jsonType==="Map"?new Map(e._val):e?._jsonType==="Set"?new Set(e._val):e}const Be=new Map;function Xi(){return window.caches?.open("cylc-workspace-layouts")??Promise.resolve({async match(n){return console.error("Cache API not available; falling back to non-persistent store for workspace layouts."),Be.get(n)?.clone()},async put(n,e){Be.delete(n),Be.set(n,e)},async delete(n){Be.delete(n)},async keys(){return Array.from(Be.keys())}})}const Gi={__name:"Lumino",props:{workflowName:{type:String,required:!0},allViews:{type:Map,required:!0}},emits:["emptied"],setup(n,{emit:e}){const t=n,i=e,s=lt(null),r=lt(new Map),l=Kt(),o=new Xe({direction:"left-to-right",spacing:0}),a=new Ee;o.addWidget(a),Xe.setStretch(a,1);const c=new ResizeObserver(()=>{o.update()}),h=Xi(),m=Ut(r,p,{deep:!0});jt(async()=>{const x=[];X.on("add-view",S=>x.push(S)),z.attach(o,s.value),c.observe(s.value),await u(),a.layoutModified.connect(()=>m.trigger()),X.off("add-view"),X.on("add-view",f),x.forEach(S=>f(S)),X.on("lumino:deleted",y),X.on("reset-workspace-layout",M)}),Bt(()=>{c.disconnect(),X.off("add-view",f),X.off("lumino:deleted",y),X.off("reset-workspace-layout",M),a.dispose()});async function f({name:x,initialOptions:S={}},I=!0){m.pause();const w=Yt("widget"),v=new Pe(w,Nt(x),!0);a.addWidget(v,{mode:"tab-after"}),I&&a.selectWidget(v),await nt(),r.value.set(w,{name:x,initialOptions:S}),m.resume(),m.trigger()}async function d(){for(const x of Array.from(a.widgets()))x.close();await nt()}async function u(){await C()||await f({name:l.value})}async function p(){const x=JSON.stringify({layout:a.saveLayout(),views:r.value},ji),S=await h;await S.put(t.workflowName,new Response(x,{headers:{"Content-Type":"application/json"}}));const I=await S.keys();I.length>100&&await S.delete(I[0])}async function g(){const S=await(await h).match(t.workflowName).then(I=>I?.text());if(S)return JSON.parse(S,(I,w)=>Yi(I,Pe.layoutReviver(I,w)))}async function C(){const x=await g();return x?(m.pause(),a.restoreLayout(x.layout),await nt(),r.value=x.views,m.resume(),!0):!1}async function M(){await m.ignore(d),await f({name:l.value})}function y(x){m.ignore(()=>{r.value.delete(x),r.value.size||i("emptied")})}return(x,S)=>($(),Ie(Ke,null,[Re("div",{ref_key:"mainDiv",ref:s,class:"main pa-2 fill-height"},null,512),($(!0),Ie(Ke,null,Rt(r.value,([I,{name:w}])=>($(),te(Bi,{key:I,id:I},{default:B(()=>[($(),te(Xt(t.allViews.get(w).component),{"workflow-name":n.workflowName,"initial-options":r.value.get(I).initialOptions,"onUpdate:initialOptions":v=>r.value.get(I).initialOptions=v,class:"h-100"},null,40,["workflow-name","initial-options","onUpdate:initialOptions"]))]),_:2},1032,["id"]))),128))],64))}},Zi=ci(`
subscription Workflow ($workflowId: ID) {
  deltas(workflows: [$workflowId]) {
    added {
      ...AddedDelta
    }
    updated (stripNull: true) {
      ...UpdatedDelta
    }
    pruned {
      ...PrunedDelta
    }
  }
}

fragment WorkflowData on Workflow {
  id
  status
  statusMsg
  nEdgeDistance
  cylcVersion
}

fragment AddedDelta on Added {
  workflow {
    ...WorkflowData
  }
}

fragment UpdatedDelta on Updated {
  workflow {
    ...WorkflowData
  }
}

fragment PrunedDelta on Pruned {
  workflow
}
`),Qi={name:"Toolbar",setup(){const{showNavBtn:n}=ui(),{toggleDrawer:e}=fi();return{eventBus:X,showNavBtn:n,toggleDrawer:e,toolbarHeight:Ot}},components:{WarningIcon:ai},mixins:[Wt,oi],props:{views:{type:Map,required:!0}},data:()=>({expecting:{play:null,paused:null,stop:null},changingNWindow:!1}),computed:{...st("app",["title"]),...st("user",["user"]),...st("workflows",["cylcTree"]),query(){return new hi(Zi,this.variables,"workflow",[],!0,!0)},currentWorkflow(){return this.cylcTree.$index[this.workflowId]},isRunning(){return this.currentWorkflow&&(this.currentWorkflow.node.status===be.RUNNING.name||this.currentWorkflow.node.status===be.PAUSED.name||this.currentWorkflow.node.status===be.STOPPING.name)},isPaused(){return this.currentWorkflow&&this.currentWorkflow.node.status===be.PAUSED.name},isStopped(){return!this.currentWorkflow||this.currentWorkflow.node.status===be.STOPPED.name},statusAndVersion(){let n=di(this.currentWorkflow.node.statusMsg||"");return this.currentWorkflow.node.cylcVersion&&(n+=` • Cylc ${this.currentWorkflow.node.cylcVersion}`),n},enabled(){return{playToggle:this.isStopped&&(this.expecting.play===null||this.expecting.play===this.isRunning),pauseToggle:!this.isStopped&&!this.expecting.stop&&this.currentWorkflow.node.status!==be.STOPPING.name&&(this.expecting.paused===null||this.expecting.paused===this.isPaused),stopToggle:!this.isStopped&&(this.expecting.stop===null||this.expecting.stop===this.isStopped)}},nWindow:{get(){return this.currentWorkflow?.node?.nEdgeDistance??1},async set(n){n==null||this.isStopped||(this.changingNWindow=!0,await this.setGraphWindow(n)&&await li(()=>this.currentWorkflow?.node?.nEdgeDistance===n),this.changingNWindow=!1)}}},watch:{isRunning(){this.expecting.play=null},isPaused(){this.expecting.paused=null},isStopped(){this.expecting.stop=null}},methods:{onClickPlay(){this.$workflowService.mutate("play",this.currentWorkflow.id).then(n=>{n[0]===Ve.SUCCEEDED&&(this.expecting.play=!this.isRunning)})},onClickReleaseHold(){this.$workflowService.mutate(this.isPaused?"resume":"pause",this.currentWorkflow.id).then(n=>{n.status===Ve.SUCCEEDED&&(this.expecting.paused=!this.isPaused)})},onClickStop(){this.$workflowService.mutate("stop",this.currentWorkflow.id).then(n=>{n.status===Ve.SUCCEEDED&&(this.expecting.stop=be.STOPPING)})},async setGraphWindow(n){const{status:e}=await this.$workflowService.mutate("setGraphWindowExtent",this.currentWorkflow.id,{nEdgeDistance:n});return e===Ve.SUCCEEDED},startCase:Nt},icons:{add:ri,hold:si,list:ni,menu:ii,run:ti,stop:ei,mdiCog:Jt,mdiAccount:Qt,mdiChevronDown:Zt,mdiArrowULeftTop:Gt}},Ji={class:"c-workflow-controls flex-shrink-0"},en={class:"status-msg text-body-2"},tn={class:"label"},nn={key:0};function sn(n,e,t,i,s,r){const l=dt("WarningIcon"),o=mi("command-menu");return $(),te(zi,{id:"core-app-bar",height:i.toolbarHeight,flat:"",class:"c-toolbar",color:"grey-lighten-4"},{default:B(()=>[i.showNavBtn?($(),te(oe,{key:0,icon:"",onClick:pi(i.toggleDrawer,["stop"]),id:"toggle-drawer"},{default:B(()=>[N(De,null,{default:B(()=>[ae(le(n.$options.icons.list),1)]),_:1})]),_:1},8,["onClick"])):Se("",!0),N(gi,{class:_i(["c-toolbar-title text-md-h6 text-subtitle-1 font-weight-medium text-primary",i.showNavBtn?"ml-0":null])},{default:B(()=>[ae(le(n.title),1)]),_:1},8,["class"]),r.currentWorkflow?($(),Ie(Ke,{key:1},[Re("div",Ji,[N(l,{workflow:r.currentWorkflow,style:{"font-size":"120%","padding-right":"0.3em"}},null,8,["workflow"]),bi(N(oe,{id:"workflow-mutate-button",icon:n.$options.icons.menu,size:"small",density:"comfortable"},null,8,["icon"]),[[o,r.currentWorkflow]]),r.isRunning?Se("",!0):($(),te(oe,{key:0,id:"workflow-play-button",icon:n.$options.icons.run,disabled:!r.enabled.playToggle,onClick:r.onClickPlay,size:"small",density:"comfortable"},null,8,["icon","disabled","onClick"])),r.isRunning?($(),te(oe,{key:1,id:"workflow-play-pause-button",icon:r.isPaused?n.$options.icons.run:n.$options.icons.hold,disabled:!r.enabled.pauseToggle,onClick:r.onClickReleaseHold,size:"small",density:"comfortable"},null,8,["icon","disabled","onClick"])):Se("",!0),N(oe,{id:"workflow-stop-button",icon:n.$options.icons.stop,disabled:!r.enabled.stopToggle,onClick:r.onClickStop,size:"small",density:"comfortable"},null,8,["icon","disabled","onClick"])]),N(oe,{disabled:r.isStopped,variant:"tonal",rounded:"",size:"small","data-cy":"n-win-selector"},{append:B(()=>[N(De,{icon:n.$options.icons.mdiChevronDown,class:"mx-n1"},null,8,["icon"])]),default:B(()=>[ae(" N="+le(r.nWindow)+" ",1),N(rt,{activator:"parent","close-on-content-click":!1,"max-width":"400","data-cy":"n-win-popup"},{default:B(()=>[N(St,{title:"Graph Window Depth"},{default:B(()=>[N(ot,null,{default:B(()=>e[2]||(e[2]=[ae(" This changes the number of tasks which are displayed. Higher values may impact performance. ",-1)])),_:1,__:[2]}),N(ot,null,{default:B(()=>[N(yi,{modelValue:r.nWindow,"onUpdate:modelValue":e[0]||(e[0]=a=>r.nWindow=a),items:[0,1,2,3],disabled:!n.user.permissions?.includes("setGraphWindowExtent")},{"append-inner":B(()=>[n.changingNWindow?($(),te(wi,{key:0,indeterminate:"",size:"20",width:"2"})):Se("",!0)]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled"]),Re("span",en,le(r.statusAndVersion),1),N(vi,{class:"mx-0"}),n.$route.name==="Workspace"?($(),te(oe,{key:0,class:"add-view",color:"primary","data-cy":"add-view-btn"},{default:B(()=>[N(De,{class:"icon"},{default:B(()=>[ae(le(n.$options.icons.add),1)]),_:1}),Re("span",tn,le(n.$t("Toolbar.addView")),1),N(rt,{activator:"parent",location:"bottom"},{default:B(()=>[N(xi,null,{default:B(()=>[($(!0),Ie(Ke,null,Rt(t.views,([a,c])=>($(),te(Mi,{id:`toolbar-add-${a}-view`,key:a,onClick:h=>i.eventBus.emit("add-view",{name:a})},{prepend:B(()=>[N(De,null,{default:B(()=>[ae(le(c.icon),1)]),_:2},1024)]),default:B(()=>[N(Ci,null,{default:B(()=>[ae(le(r.startCase(a)),1)]),_:2},1024)]),_:2},1032,["id","onClick"]))),128)),N(Si),N(ki,{class:"mb-n2"},{default:B(()=>[N(oe,{onClick:e[1]||(e[1]=a=>i.eventBus.emit("reset-workspace-layout")),"prepend-icon":n.$options.icons.mdiArrowULeftTop,class:"flex-grow-1","data-cy":"reset-layout-btn"},{default:B(()=>e[3]||(e[3]=[ae(" Reset layout ",-1)])),_:1,__:[3]},8,["prepend-icon"])]),_:1})]),_:1})]),_:1})]),_:1})):Se("",!0),N(oe,{icon:"",size:"small"},{default:B(()=>[N(Ii,{color:"primary",size:"small"},{default:B(()=>[n.user.initials?($(),Ie("div",nn,le(n.user.initials),1)):($(),te(De,{key:1,icon:n.$options.icons.mdiAccount},null,8,["icon"]))]),_:1}),N(rt,{activator:"parent"},{default:B(()=>[N(St,{title:n.user.username},{default:B(()=>[N(ot,null,{default:B(()=>[N(oe,{to:"/user-profile",variant:"tonal","prepend-icon":n.$options.icons.mdiCog},{default:B(()=>e[4]||(e[4]=[ae(" Settings ",-1)])),_:1,__:[4]},8,["prepend-icon"])]),_:1})]),_:1},8,["title"])]),_:1})]),_:1})],64)):Se("",!0)]),_:1},8,["height"])}const rn=Ht(Qi,[["render",sn]]),on={name:"Workspace",mixins:[Wt,Ai],components:{Lumino:Gi,Toolbar:rn},setup(){return{allViews:Li,workflowViews:Di}},methods:{onEmptied(){this.viewState=Ti.NO_STATE}},panelStyle:{height:`calc(100vh - ${Ot}px)`}},an={"data-cy":"workspace-view"};function ln(n,e,t,i,s,r){const l=dt("Toolbar"),o=dt("Lumino");return $(),Ie("div",an,[N(l,{views:i.workflowViews,"workflow-name":n.workflowName},null,8,["views","workflow-name"]),Re("div",{class:"workflow-panel",style:Ei(n.$options.panelStyle)},[($(),te(o,{key:n.workflowName,onEmptied:r.onEmptied,"workflow-name":n.workflowName,allViews:i.allViews},null,8,["onEmptied","workflow-name","allViews"]))],4)])}const cn=Ht(on,[["render",ln]]);export{cn as default};
