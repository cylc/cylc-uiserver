Improve the logic for handling closed connections. This results in better memory management.
